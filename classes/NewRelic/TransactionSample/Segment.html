<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NewRelic::TransactionSample::Segment</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            NewRelic::TransactionSample::Segment 
            
                <span class="parent">&lt; 
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/new_relic/transaction_sample_rb.html">lib/new_relic/transaction_sample.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M001306">[]</a>,</li>
                
                <li><a href="#M001305">[]=</a></li>
                
            </ul>
        </dd>
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M001284">add_called_segment</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M001300">called_segments</a>,</li>
                
                <li><a href="#M001313">called_segments=</a>,</li>
                
                <li><a href="#M001303">count_segments</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M001301">duration</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M001308">each_segment</a>,</li>
                
                <li><a href="#M001283">end_trace</a>,</li>
                
                <li><a href="#M001302">exclusive_duration</a>,</li>
                
                <li><a href="#M001310">explain_sql</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M001309">find_segment</a>,</li>
                
                <li><a href="#M001287">from_json</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M001311">handle_exception_in_explain</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M001282">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M001312">obfuscated_sql</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M001307">params</a>,</li>
                
                <li><a href="#M001315">params=</a>,</li>
                
                <li><a href="#M001314">parent_segment=</a>,</li>
                
                <li><a href="#M001293">path_string</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M001299">to_debug_str</a>,</li>
                
                <li><a href="#M001286">to_json</a>,</li>
                
                <li><a href="#M001285">to_s</a>,</li>
                
                <li><a href="#M001298">to_s_compact</a>,</li>
                
                <li><a href="#M001304">truncate</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>entry_timestamp</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>exit_timestamp</td>
            <td class='attr-desc'><p>
The exit timestamp will be relative except for the outermost sample which
will have a timestamp.
</p></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>parent_segment</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>metric_name</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>segment_id</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M001287">
                    
                    <a name="M001287"></a><b>from_json</b>(json, id_generator)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001287_source')" id="l_M001287_source">show</a>
                        
                    </p>
                    <div id="M001287_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 69</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">json</span>, <span class="ruby-identifier">id_generator</span>)
        <span class="ruby-identifier">json</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>.<span class="ruby-identifier">decode</span>(<span class="ruby-identifier">json</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">json</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">json</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
          <span class="ruby-identifier">entry_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-value">1000</span>
          <span class="ruby-identifier">exit_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-value">1000</span>
          <span class="ruby-identifier">metric_name</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">2</span>]
          <span class="ruby-identifier">params</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">3</span>]
          <span class="ruby-identifier">called_segments</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">4</span>]
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">entry_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;entry_timestamp&quot;</span>].<span class="ruby-identifier">to_f</span>
          <span class="ruby-identifier">exit_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;exit_timestamp&quot;</span>].<span class="ruby-identifier">to_f</span>
          <span class="ruby-identifier">metric_name</span> =  <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;metric_name&quot;</span>]       
          <span class="ruby-identifier">params</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;params&quot;</span>]
          
          <span class="ruby-identifier">called_segments</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;called_segments&quot;</span>]
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">segment</span> = <span class="ruby-constant">Segment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">entry_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">id_generator</span>.<span class="ruby-identifier">next_id</span>)
        <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">end_trace</span> <span class="ruby-identifier">exit_timestamp</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>
          <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:params=</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">called_segments</span>
          <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">add_called_segment</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">child</span>, <span class="ruby-identifier">id_generator</span>))
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">segment</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001282">
                    
                    <a name="M001282"></a><b>new</b>(timestamp, metric_name, segment_id)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001282_source')" id="l_M001282_source">show</a>
                        
                    </p>
                    <div id="M001282_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 35</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span>)
        <span class="ruby-ivar">@entry_timestamp</span> = <span class="ruby-identifier">timestamp</span>
        <span class="ruby-ivar">@metric_name</span> = <span class="ruby-identifier">metric_name</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'&lt;unknown&gt;'</span>
        <span class="ruby-ivar">@segment_id</span> = <span class="ruby-identifier">segment_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">object_id</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M001306">
                    
                    <a name="M001306"></a><b>[]</b>(key)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001306_source')" id="l_M001306_source">show</a>
                        
                    </p>
                    <div id="M001306_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 179</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)
        <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>]
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001305">
                    
                    <a name="M001305"></a><b>[]=</b>(key, value)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001305_source')" id="l_M001305_source">show</a>
                        
                    </p>
                    <div id="M001305_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 173</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
        <span class="ruby-comment cmt"># only create a parameters field if a parameter is set; this will save</span>
        <span class="ruby-comment cmt"># bandwidth etc as most segments have no parameters</span>
        <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001284">
                    
                    <a name="M001284"></a><b>add_called_segment</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001284_source')" id="l_M001284_source">show</a>
                        
                    </p>
                    <div id="M001284_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 45</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_called_segment</span>(<span class="ruby-identifier">s</span>)
        <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">||=</span> []
        <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>
        <span class="ruby-identifier">s</span>.<span class="ruby-identifier">parent_segment</span> = <span class="ruby-keyword kw">self</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001300">
                    
                    <a name="M001300"></a><b>called_segments</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001300_source')" id="l_M001300_source">show</a>
                        
                    </p>
                    <div id="M001300_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 130</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">called_segments</span>
        <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">||</span> <span class="ruby-constant">EMPTY_ARRAY</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001313">
                    
                    <a name="M001313"></a><b>called_segments=</b>(segments)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001313_source')" id="l_M001313_source">show</a>
                        
                    </p>
                    <div id="M001313_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 263</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">called_segments=</span>(<span class="ruby-identifier">segments</span>)
        <span class="ruby-ivar">@called_segments</span> = <span class="ruby-identifier">segments</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001303">
                    
                    <a name="M001303"></a><b>count_segments</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001303_source')" id="l_M001303_source">show</a>
                        
                    </p>
                    <div id="M001303_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 151</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_segments</span>
        <span class="ruby-identifier">count</span> = <span class="ruby-value">1</span>
        <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">seg</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">count</span>  <span class="ruby-operator">+=</span> <span class="ruby-identifier">seg</span>.<span class="ruby-identifier">count_segments</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
        <span class="ruby-identifier">count</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001301">
                    
                    <a name="M001301"></a><b>duration</b>()
                    
                </div>
                
                <div class="description">
                  <p>
return the total duration of this segment
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001301_source')" id="l_M001301_source">show</a>
                        
                    </p>
                    <div id="M001301_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 135</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">duration</span>
        (<span class="ruby-ivar">@exit_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@entry_timestamp</span>).<span class="ruby-identifier">to_f</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001308">
                    
                    <a name="M001308"></a><b>each_segment</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
call the provided block for this segment and each of the called segments
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001308_source')" id="l_M001308_source">show</a>
                        
                    </p>
                    <div id="M001308_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 189</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword kw">self</span>
        
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
          <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001283">
                    
                    <a name="M001283"></a><b>end_trace</b>(timestamp)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001283_source')" id="l_M001283_source">show</a>
                        
                    </p>
                    <div id="M001283_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 41</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">end_trace</span>(<span class="ruby-identifier">timestamp</span>)
        <span class="ruby-ivar">@exit_timestamp</span> = <span class="ruby-identifier">timestamp</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001302">
                    
                    <a name="M001302"></a><b>exclusive_duration</b>()
                    
                </div>
                
                <div class="description">
                  <p>
return the duration of this segment without including the time in the
called segments
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001302_source')" id="l_M001302_source">show</a>
                        
                    </p>
                    <div id="M001302_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 141</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exclusive_duration</span>
        <span class="ruby-identifier">d</span> = <span class="ruby-identifier">duration</span>
        
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
          <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">d</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">duration</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">d</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001310">
                    
                    <a name="M001310"></a><b>explain_sql</b>()
                    
                </div>
                
                <div class="description">
                  <p>
perform this in the runtime environment of a managed application, to
explain the sql statement(s) executed within a segment of a transaction
sample. returns an array of explanations (which is an array rows consisting
of an array of strings for each column returned by the the explain query)
Note this happens only for statements whose execution time exceeds a
threshold (e.g. 500ms) and only within the slowest transaction in a report
period, selected for shipment to RPM
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001310_source')" id="l_M001310_source">show</a>
                        
                    </p>
                    <div id="M001310_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 214</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">explain_sql</span>        
        <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sql</span>]
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:connection_config</span>]
        <span class="ruby-identifier">statements</span> = <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;;\n&quot;</span>)
        <span class="ruby-identifier">explanations</span> = []
        <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">statement</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">$;</span>, <span class="ruby-value">2</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'SELECT'</span>
            <span class="ruby-identifier">explain_resultset</span> = []
            <span class="ruby-keyword kw">begin</span>
              <span class="ruby-identifier">connection</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:connection_config</span>])    
              <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>
                <span class="ruby-comment cmt"># The resultset type varies for different drivers.  Only thing you can count on is</span>
                <span class="ruby-comment cmt"># that it implements each.  Also: can't use select_rows because the native postgres</span>
                <span class="ruby-comment cmt"># driver doesn't know that method.</span>
                <span class="ruby-identifier">explain_resultset</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;EXPLAIN #{statement}&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>
                <span class="ruby-identifier">rows</span> = []
                <span class="ruby-comment cmt"># Note: we can't use map.</span>
                <span class="ruby-comment cmt"># Note: have to convert from native column element types to string so we can</span>
                <span class="ruby-comment cmt"># serialize.  Esp. for postgresql.</span>
                <span class="ruby-comment cmt"># Can't use map.  Suck it up.</span>
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">explain_resultset</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:each</span>)
                  <span class="ruby-identifier">explain_resultset</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">row</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_s</span>) }
                <span class="ruby-keyword kw">else</span>
                  <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-identifier">explain_resultset</span> ]
                <span class="ruby-keyword kw">end</span>
                <span class="ruby-identifier">explanations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rows</span>
                <span class="ruby-comment cmt"># sleep for a very short period of time in order to yield to the main thread</span>
                <span class="ruby-comment cmt"># this is because a remote database call will likely hang the VM</span>
                <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.05</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
              <span class="ruby-identifier">handle_exception_in_explain</span>(<span class="ruby-identifier">e</span>)
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>

        <span class="ruby-identifier">explanations</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001309">
                    
                    <a name="M001309"></a><b>find_segment</b>(id)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001309_source')" id="l_M001309_source">show</a>
                        
                    </p>
                    <div id="M001309_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 199</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@segment_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">id</span>
        <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">found</span> = <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
          <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">found</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">found</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001311">
                    
                    <a name="M001311"></a><b>handle_exception_in_explain</b>(e)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001311_source')" id="l_M001311_source">show</a>
                        
                    </p>
                    <div id="M001311_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 253</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_exception_in_explain</span>(<span class="ruby-identifier">e</span>)
        <span class="ruby-identifier">x</span> = <span class="ruby-value">1</span> <span class="ruby-comment cmt"># this is here so that code coverage knows we've entered this block</span>
        <span class="ruby-comment cmt"># swallow failed attempts to run an explain.  One example of a failure is the</span>
        <span class="ruby-comment cmt"># connection for the sql statement is to a different db than the default connection</span>
        <span class="ruby-comment cmt"># specified in AR::Base</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001312">
                    
                    <a name="M001312"></a><b>obfuscated_sql</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001312_source')" id="l_M001312_source">show</a>
                        
                    </p>
                    <div id="M001312_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 259</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">obfuscated_sql</span>
        <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">obfuscate_sql</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sql</span>])
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001307">
                    
                    <a name="M001307"></a><b>params</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001307_source')" id="l_M001307_source">show</a>
                        
                    </p>
                    <div id="M001307_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 183</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params</span>
        <span class="ruby-ivar">@params</span> <span class="ruby-operator">||=</span> {}
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001293">
                    
                    <a name="M001293"></a><b>path_string</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001293_source')" id="l_M001293_source">show</a>
                        
                    </p>
                    <div id="M001293_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 98</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path_string</span>
        <span class="ruby-node">&quot;#{metric_name}[#{called_segments.collect {|segment| segment.path_string }.join('')}]&quot;</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001299">
                    
                    <a name="M001299"></a><b>to_debug_str</b>(depth)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001299_source')" id="l_M001299_source">show</a>
                        
                    </p>
                    <div id="M001299_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 109</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_debug_str</span>(<span class="ruby-identifier">depth</span>)
        <span class="ruby-identifier">tab</span> = <span class="ruby-value str">&quot;  &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">depth</span> 
        <span class="ruby-identifier">s</span> = <span class="ruby-identifier">tab</span>.<span class="ruby-identifier">clone</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&gt;&gt; #{'%3i ms' % (@entry_timestamp*1000)} [#{self.class.name.split(&quot;::&quot;).last}] #{metric_name} \n&quot;</span>
        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{tab}    -#{'%-16s' % k}: #{v.to_s[0..80]}\n&quot;</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cs</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cs</span>.<span class="ruby-identifier">to_debug_str</span>(<span class="ruby-identifier">depth</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tab</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;&lt;&lt; &quot;</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@exit_timestamp</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">' n/a'</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Numeric</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'%3i ms'</span> <span class="ruby-operator">%</span> (<span class="ruby-ivar">@exit_timestamp</span><span class="ruby-operator">*</span><span class="ruby-value">1000</span>)
          <span class="ruby-keyword kw">else</span> <span class="ruby-ivar">@exit_timestamp</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; #{metric_name}\n&quot;</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001286">
                    
                    <a name="M001286"></a><b>to_json</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001286_source')" id="l_M001286_source">show</a>
                        
                    </p>
                    <div id="M001286_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 55</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_json</span>
        <span class="ruby-identifier">map</span> = {<span class="ruby-identifier">:entry_timestamp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@entry_timestamp</span>,
          <span class="ruby-identifier">:exit_timestamp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@exit_timestamp</span>,
          <span class="ruby-identifier">:metric_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@metric_name</span>,
          <span class="ruby-identifier">:segment_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@segment_id</span>}
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">map</span>[<span class="ruby-identifier">:called_segments</span>] = <span class="ruby-ivar">@called_segments</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@params</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@params</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">map</span>[<span class="ruby-identifier">:params</span>] = <span class="ruby-ivar">@params</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_json</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001285">
                    
                    <a name="M001285"></a><b>to_s</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001285_source')" id="l_M001285_source">show</a>
                        
                    </p>
                    <div id="M001285_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 51</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
        <span class="ruby-identifier">to_debug_str</span>(<span class="ruby-value">0</span>)
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001298">
                    
                    <a name="M001298"></a><b>to_s_compact</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001298_source')" id="l_M001298_source">show</a>
                        
                    </p>
                    <div id="M001298_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 101</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s_compact</span>
        <span class="ruby-identifier">str</span> = <span class="ruby-value str">&quot;&quot;</span>
        <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">metric_name</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">any?</span>
          <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;{#{called_segments.map { | cs | cs.to_s_compact }.join(&quot;,&quot;)}}&quot;</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">str</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001304">
                    
                    <a name="M001304"></a><b>truncate</b>(max)
                    
                </div>
                
                <div class="description">
                  <p>
Walk through the tree and truncate the segments
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001304_source')" id="l_M001304_source">show</a>
                        
                    </p>
                    <div id="M001304_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 157</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">max</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@called_segments</span>
        <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>
        <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">segment</span> <span class="ruby-operator">|</span>
          <span class="ruby-identifier">max</span> = <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span>)
          <span class="ruby-identifier">max</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">max</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
            <span class="ruby-ivar">@called_segments</span> = <span class="ruby-ivar">@called_segments</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">i</span>]
            <span class="ruby-keyword kw">break</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">max</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Protected methods</div>
            
            <div class="method">
                <div class="title" id="M001315">
                    
                    <a name="M001315"></a><b>params=</b>(p)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001315_source')" id="l_M001315_source">show</a>
                        
                    </p>
                    <div id="M001315_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 271</span>
        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params=</span>(<span class="ruby-identifier">p</span>)
          <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">p</span>
        <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M001314">
                    
                    <a name="M001314"></a><b>parent_segment=</b>(s)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M001314_source')" id="l_M001314_source">show</a>
                        
                    </p>
                    <div id="M001314_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 268</span>
        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parent_segment=</span>(<span class="ruby-identifier">s</span>)
          <span class="ruby-ivar">@parent_segment</span> = <span class="ruby-identifier">s</span>
        <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    