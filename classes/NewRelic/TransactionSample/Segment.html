<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: NewRelic::TransactionSample::Segment</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">NewRelic::TransactionSample::Segment</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/new_relic/transaction_sample_rb.html">
                lib/new_relic/transaction_sample.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000440">[]</a>&nbsp;&nbsp;
      <a href="#M000439">[]=</a>&nbsp;&nbsp;
      <a href="#M000428">add_called_segment</a>&nbsp;&nbsp;
      <a href="#M000435">called_segments</a>&nbsp;&nbsp;
      <a href="#M000447">called_segments=</a>&nbsp;&nbsp;
      <a href="#M000437">duration</a>&nbsp;&nbsp;
      <a href="#M000442">each_segment</a>&nbsp;&nbsp;
      <a href="#M000427">end_trace</a>&nbsp;&nbsp;
      <a href="#M000438">exclusive_duration</a>&nbsp;&nbsp;
      <a href="#M000444">explain_sql</a>&nbsp;&nbsp;
      <a href="#M000443">find_segment</a>&nbsp;&nbsp;
      <a href="#M000436">freeze</a>&nbsp;&nbsp;
      <a href="#M000431">from_json</a>&nbsp;&nbsp;
      <a href="#M000445">handle_exception_in_explain</a>&nbsp;&nbsp;
      <a href="#M000426">new</a>&nbsp;&nbsp;
      <a href="#M000446">obfuscated_sql</a>&nbsp;&nbsp;
      <a href="#M000441">params</a>&nbsp;&nbsp;
      <a href="#M000449">params=</a>&nbsp;&nbsp;
      <a href="#M000448">parent_segment=</a>&nbsp;&nbsp;
      <a href="#M000432">path_string</a>&nbsp;&nbsp;
      <a href="#M000434">to_debug_str</a>&nbsp;&nbsp;
      <a href="#M000430">to_json</a>&nbsp;&nbsp;
      <a href="#M000429">to_s</a>&nbsp;&nbsp;
      <a href="#M000433">to_s_compact</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">entry_timestamp</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">exit_timestamp</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">metric_name</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">parent_segment</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">segment_id</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000431" class="method-detail">
        <a name="M000431"></a>

        <div class="method-heading">
          <a href="#M000431" class="method-signature">
          <span class="method-name">from_json</span><span class="method-args">(json)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000431-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000431-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 67</span>
67:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">json</span>)
68:         <span class="ruby-identifier">json</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>.<span class="ruby-identifier">decode</span>(<span class="ruby-identifier">json</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">json</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
69:         <span class="ruby-identifier">segment</span> = <span class="ruby-constant">Segment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;entry_timestamp&quot;</span>].<span class="ruby-identifier">to_f</span>, <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;metric_name&quot;</span>], <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;segment_id&quot;</span>])
70:         <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">end_trace</span> <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;exit_timestamp&quot;</span>].<span class="ruby-identifier">to_f</span>
71:         <span class="ruby-identifier">params</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;params&quot;</span>]
72:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>
73:           <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:params=</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>)
74:         <span class="ruby-keyword kw">end</span>
75:         <span class="ruby-identifier">called_segments</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;called_segments&quot;</span>]
76:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">called_segments</span>
77:           <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
78:             <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">add_called_segment</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">child</span>))
79:           <span class="ruby-keyword kw">end</span>
80:         <span class="ruby-keyword kw">end</span>
81:         <span class="ruby-identifier">segment</span>
82:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000426" class="method-detail">
        <a name="M000426"></a>

        <div class="method-heading">
          <a href="#M000426" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(timestamp, metric_name, segment_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000426-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000426-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 33</span>
33:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span>)
34:         <span class="ruby-ivar">@entry_timestamp</span> = <span class="ruby-identifier">timestamp</span>
35:         <span class="ruby-ivar">@metric_name</span> = <span class="ruby-identifier">metric_name</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'&lt;unknown&gt;'</span>
36:         <span class="ruby-ivar">@segment_id</span> = <span class="ruby-identifier">segment_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">object_id</span>
37:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000440" class="method-detail">
        <a name="M000440"></a>

        <div class="method-heading">
          <a href="#M000440" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000440-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000440-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 154</span>
154:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)
155:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>]
156:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000439" class="method-detail">
        <a name="M000439"></a>

        <div class="method-heading">
          <a href="#M000439" class="method-signature">
          <span class="method-name">[]=</span><span class="method-args">(key, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000439-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000439-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 148</span>
148:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
149:         <span class="ruby-comment cmt"># only create a parameters field if a parameter is set; this will save</span>
150:         <span class="ruby-comment cmt"># bandwidth etc as most segments have no parameters</span>
151:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
152:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000428" class="method-detail">
        <a name="M000428"></a>

        <div class="method-heading">
          <a href="#M000428" class="method-signature">
          <span class="method-name">add_called_segment</span><span class="method-args">(s)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000428-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000428-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 43</span>
43:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_called_segment</span>(<span class="ruby-identifier">s</span>)
44:         <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">||=</span> []
45:         <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>
46:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">parent_segment</span> = <span class="ruby-keyword kw">self</span>
47:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000435" class="method-detail">
        <a name="M000435"></a>

        <div class="method-heading">
          <a href="#M000435" class="method-signature">
          <span class="method-name">called_segments</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000435-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000435-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 116</span>
116:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">called_segments</span>
117:         <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">||</span> <span class="ruby-constant">EMPTY_ARRAY</span>
118:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000447" class="method-detail">
        <a name="M000447"></a>

        <div class="method-heading">
          <a href="#M000447" class="method-signature">
          <span class="method-name">called_segments=</span><span class="method-args">(segments)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000447-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000447-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 238</span>
238:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">called_segments=</span>(<span class="ruby-identifier">segments</span>)
239:         <span class="ruby-ivar">@called_segments</span> = <span class="ruby-identifier">segments</span>
240:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000437" class="method-detail">
        <a name="M000437"></a>

        <div class="method-heading">
          <a href="#M000437" class="method-signature">
          <span class="method-name">duration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return the total <a href="Segment.html#M000437">duration</a> of this
segment
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000437-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000437-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 131</span>
131:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">duration</span>
132:         <span class="ruby-ivar">@exit_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@entry_timestamp</span>
133:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000442" class="method-detail">
        <a name="M000442"></a>

        <div class="method-heading">
          <a href="#M000442" class="method-signature">
          <span class="method-name">each_segment</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
call the provided block for this segment and each of the called segments
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000442-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000442-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 164</span>
164:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
165:         <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword kw">self</span>
166:         
167:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
168:           <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
169:             <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
170:           <span class="ruby-keyword kw">end</span>
171:         <span class="ruby-keyword kw">end</span>
172:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000427" class="method-detail">
        <a name="M000427"></a>

        <div class="method-heading">
          <a href="#M000427" class="method-signature">
          <span class="method-name">end_trace</span><span class="method-args">(timestamp)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000427-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000427-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 39</span>
39:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">end_trace</span>(<span class="ruby-identifier">timestamp</span>)
40:         <span class="ruby-ivar">@exit_timestamp</span> = <span class="ruby-identifier">timestamp</span>
41:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000438" class="method-detail">
        <a name="M000438"></a>

        <div class="method-heading">
          <a href="#M000438" class="method-signature">
          <span class="method-name">exclusive_duration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return the <a href="Segment.html#M000437">duration</a> of this segment
without including the time in the called segments
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000438-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000438-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 137</span>
137:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exclusive_duration</span>
138:         <span class="ruby-identifier">d</span> = <span class="ruby-identifier">duration</span>
139:         
140:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
141:           <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
142:             <span class="ruby-identifier">d</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">duration</span>
143:           <span class="ruby-keyword kw">end</span>
144:         <span class="ruby-keyword kw">end</span>
145:         <span class="ruby-identifier">d</span>
146:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000444" class="method-detail">
        <a name="M000444"></a>

        <div class="method-heading">
          <a href="#M000444" class="method-signature">
          <span class="method-name">explain_sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
perform this in the runtime environment of a managed application, to
explain the sql statement(s) executed within a segment of a transaction
sample. returns an array of explanations (which is an array rows consisting
of an array of strings for each column returned by the the explain query)
Note this happens only for statements whose execution time exceeds a
threshold (e.g. 500ms) and only within the slowest transaction in a report
period, selected for shipment to RPM
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000444-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000444-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 189</span>
189:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">explain_sql</span>        
190:         <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sql</span>]
191:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:connection_config</span>]
192:         <span class="ruby-identifier">statements</span> = <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;;\n&quot;</span>)
193:         <span class="ruby-identifier">explanations</span> = []
194:         <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">statement</span><span class="ruby-operator">|</span>
195:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">$;</span>, <span class="ruby-value">2</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'SELECT'</span>
196:             <span class="ruby-identifier">explain_resultset</span> = []
197:             <span class="ruby-keyword kw">begin</span>
198:               <span class="ruby-identifier">connection</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:connection_config</span>])    
199:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>
200:                 <span class="ruby-comment cmt"># The resultset type varies for different drivers.  Only thing you can count on is</span>
201:                 <span class="ruby-comment cmt"># that it implements each.  Also: can't use select_rows because the native postgres</span>
202:                 <span class="ruby-comment cmt"># driver doesn't know that method.</span>
203:                 <span class="ruby-identifier">explain_resultset</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;EXPLAIN #{statement}&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>
204:                 <span class="ruby-identifier">rows</span> = []
205:                 <span class="ruby-comment cmt"># Note: we can't use map.</span>
206:                 <span class="ruby-comment cmt"># Note: have to convert from native column element types to string so we can</span>
207:                 <span class="ruby-comment cmt"># serialize.  Esp. for postgresql.</span>
208:                 <span class="ruby-comment cmt"># Can't use map.  Suck it up.</span>
209:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">explain_resultset</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:each</span>)
210:                   <span class="ruby-identifier">explain_resultset</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">row</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_s</span>) }
211:                 <span class="ruby-keyword kw">else</span>
212:                   <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-identifier">explain_resultset</span> ]
213:                 <span class="ruby-keyword kw">end</span>
214:                 <span class="ruby-identifier">explanations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rows</span>
215:                 <span class="ruby-comment cmt"># sleep for a very short period of time in order to yield to the main thread</span>
216:                 <span class="ruby-comment cmt"># this is because a remote database call will likely hang the VM</span>
217:                 <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.05</span>
218:               <span class="ruby-keyword kw">end</span>
219:             <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
220:               <span class="ruby-identifier">handle_exception_in_explain</span>(<span class="ruby-identifier">e</span>)
221:             <span class="ruby-keyword kw">end</span>
222:           <span class="ruby-keyword kw">end</span>
223:         <span class="ruby-keyword kw">end</span>
224: 
225:         <span class="ruby-identifier">explanations</span>
226:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000443" class="method-detail">
        <a name="M000443"></a>

        <div class="method-heading">
          <a href="#M000443" class="method-signature">
          <span class="method-name">find_segment</span><span class="method-args">(id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000443-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000443-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 174</span>
174:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
175:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@segment_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">id</span>
176:         <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
177:           <span class="ruby-identifier">found</span> = <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
178:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">found</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">found</span>
179:         <span class="ruby-keyword kw">end</span>
180:         <span class="ruby-keyword kw">nil</span>
181:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000436" class="method-detail">
        <a name="M000436"></a>

        <div class="method-heading">
          <a href="#M000436" class="method-signature">
          <span class="method-name">freeze</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000436-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000436-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 120</span>
120:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">freeze</span>
121:         <span class="ruby-identifier">params</span>.<span class="ruby-identifier">freeze</span>
122:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
123:           <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
124:             <span class="ruby-identifier">s</span>.<span class="ruby-identifier">freeze</span>
125:           <span class="ruby-keyword kw">end</span>
126:         <span class="ruby-keyword kw">end</span>
127:         <span class="ruby-keyword kw">super</span>
128:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000445" class="method-detail">
        <a name="M000445"></a>

        <div class="method-heading">
          <a href="#M000445" class="method-signature">
          <span class="method-name">handle_exception_in_explain</span><span class="method-args">(e)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000445-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000445-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 228</span>
228:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_exception_in_explain</span>(<span class="ruby-identifier">e</span>)
229:         <span class="ruby-identifier">x</span> = <span class="ruby-value">1</span> <span class="ruby-comment cmt"># this is here so that code coverage knows we've entered this block</span>
230:         <span class="ruby-comment cmt"># swallow failed attempts to run an explain.  One example of a failure is the</span>
231:         <span class="ruby-comment cmt"># connection for the sql statement is to a different db than the default connection</span>
232:         <span class="ruby-comment cmt"># specified in AR::Base</span>
233:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000446" class="method-detail">
        <a name="M000446"></a>

        <div class="method-heading">
          <a href="#M000446" class="method-signature">
          <span class="method-name">obfuscated_sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000446-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000446-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 234</span>
234:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">obfuscated_sql</span>
235:         <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">obfuscate_sql</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sql</span>])
236:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000441" class="method-detail">
        <a name="M000441"></a>

        <div class="method-heading">
          <a href="#M000441" class="method-signature">
          <span class="method-name">params</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000441-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000441-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 158</span>
158:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params</span>
159:         <span class="ruby-ivar">@params</span> <span class="ruby-operator">||=</span> {}
160:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000432" class="method-detail">
        <a name="M000432"></a>

        <div class="method-heading">
          <a href="#M000432" class="method-signature">
          <span class="method-name">path_string</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000432-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000432-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 84</span>
84:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path_string</span>
85:         <span class="ruby-node">&quot;#{metric_name}[#{called_segments.collect {|segment| segment.path_string }.join('')}]&quot;</span>
86:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000434" class="method-detail">
        <a name="M000434"></a>

        <div class="method-heading">
          <a href="#M000434" class="method-signature">
          <span class="method-name">to_debug_str</span><span class="method-args">(depth)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000434-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000434-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 95</span>
 95:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_debug_str</span>(<span class="ruby-identifier">depth</span>)
 96:         <span class="ruby-identifier">tab</span> = <span class="ruby-value str">&quot;&quot;</span> 
 97:         <span class="ruby-identifier">depth</span>.<span class="ruby-identifier">times</span> {<span class="ruby-identifier">tab</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  &quot;</span>}
 98:         
 99:         <span class="ruby-identifier">s</span> = <span class="ruby-identifier">tab</span>.<span class="ruby-identifier">clone</span>
100:         <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&gt;&gt; #{metric_name}: #{(@entry_timestamp*1000).round}\n&quot;</span>
101:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">empty?</span>
102:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{tab}#{tab}{\n&quot;</span>
103:           <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
104:             <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{tab}#{tab}#{k}: #{v}\n&quot;</span>
105:           <span class="ruby-keyword kw">end</span>
106:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{tab}#{tab}}\n&quot;</span>
107:         <span class="ruby-keyword kw">end</span>
108:         <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cs</span><span class="ruby-operator">|</span>
109:           <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cs</span>.<span class="ruby-identifier">to_debug_str</span>(<span class="ruby-identifier">depth</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
110:         <span class="ruby-keyword kw">end</span>
111:         <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tab</span>
112:         <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;&lt; #{metric_name}: #{@exit_timestamp ? (@exit_timestamp*1000).round : 'n/a'}\n&quot;</span>
113:         <span class="ruby-identifier">s</span>
114:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000430" class="method-detail">
        <a name="M000430"></a>

        <div class="method-heading">
          <a href="#M000430" class="method-signature">
          <span class="method-name">to_json</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000430-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000430-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 53</span>
53:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_json</span>
54:         <span class="ruby-identifier">map</span> = {<span class="ruby-identifier">:entry_timestamp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@entry_timestamp</span>,
55:           <span class="ruby-identifier">:exit_timestamp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@exit_timestamp</span>,
56:           <span class="ruby-identifier">:metric_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@metric_name</span>,
57:           <span class="ruby-identifier">:segment_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@segment_id</span>}
58:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">empty?</span>
59:           <span class="ruby-identifier">map</span>[<span class="ruby-identifier">:called_segments</span>] = <span class="ruby-ivar">@called_segments</span>
60:         <span class="ruby-keyword kw">end</span>
61:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@params</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@params</span>.<span class="ruby-identifier">empty?</span>
62:           <span class="ruby-identifier">map</span>[<span class="ruby-identifier">:params</span>] = <span class="ruby-ivar">@params</span>
63:         <span class="ruby-keyword kw">end</span>
64:         <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_json</span>
65:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000429" class="method-detail">
        <a name="M000429"></a>

        <div class="method-heading">
          <a href="#M000429" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000429-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000429-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 49</span>
49:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
50:         <span class="ruby-identifier">to_debug_str</span>(<span class="ruby-value">0</span>)
51:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000433" class="method-detail">
        <a name="M000433"></a>

        <div class="method-heading">
          <a href="#M000433" class="method-signature">
          <span class="method-name">to_s_compact</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000433-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000433-source">
<pre>
    <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 87</span>
87:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s_compact</span>
88:         <span class="ruby-identifier">str</span> = <span class="ruby-value str">&quot;&quot;</span>
89:         <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">metric_name</span>
90:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">any?</span>
91:           <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;{#{called_segments.map { | cs | cs.to_s_compact }.join(&quot;,&quot;)}}&quot;</span>
92:         <span class="ruby-keyword kw">end</span>
93:         <span class="ruby-identifier">str</span>
94:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000449" class="method-detail">
        <a name="M000449"></a>

        <div class="method-heading">
          <a href="#M000449" class="method-signature">
          <span class="method-name">params=</span><span class="method-args">(p)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000449-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000449-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 246</span>
246:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params=</span>(<span class="ruby-identifier">p</span>)
247:           <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">p</span>
248:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000448" class="method-detail">
        <a name="M000448"></a>

        <div class="method-heading">
          <a href="#M000448" class="method-signature">
          <span class="method-name">parent_segment=</span><span class="method-args">(s)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000448-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000448-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 243</span>
243:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parent_segment=</span>(<span class="ruby-identifier">s</span>)
244:           <span class="ruby-ivar">@parent_segment</span> = <span class="ruby-identifier">s</span>
245:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>