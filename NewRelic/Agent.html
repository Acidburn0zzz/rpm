<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>Module: NewRelic::Agent</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/new_relic/agent/agent.rb
    <li>lib/new_relic/agent/beacon_configuration.rb
    <li>lib/new_relic/agent/browser_monitoring.rb
    <li>lib/new_relic/agent/busy_calculator.rb
    <li>lib/new_relic/agent/database.rb
    <li>lib/new_relic/agent/error_collector.rb
    <li>lib/new_relic/agent/instrumentation/controller_instrumentation.rb
    <li>lib/new_relic/agent/instrumentation/data_mapper.rb
    <li>lib/new_relic/agent/instrumentation/memcache.rb
    <li>lib/new_relic/agent/instrumentation/metric_frame/pop.rb
    <li>lib/new_relic/agent/instrumentation/metric_frame.rb
    <li>lib/new_relic/agent/instrumentation/queue_time.rb
    <li>lib/new_relic/agent/instrumentation/rack.rb
    <li>lib/new_relic/agent/instrumentation/rails/active_record_instrumentation.rb
    <li>lib/new_relic/agent/instrumentation/rails3/action_controller.rb
    <li>lib/new_relic/agent/instrumentation/rails3/active_record_instrumentation.rb
    <li>lib/new_relic/agent/instrumentation/rails3/errors.rb
    <li>lib/new_relic/agent/instrumentation/sinatra.rb
    <li>lib/new_relic/agent/instrumentation.rb
    <li>lib/new_relic/agent/method_tracer.rb
    <li>lib/new_relic/agent/sampler.rb
    <li>lib/new_relic/agent/samplers/cpu_sampler.rb
    <li>lib/new_relic/agent/samplers/delayed_job_lock_sampler.rb
    <li>lib/new_relic/agent/samplers/memory_sampler.rb
    <li>lib/new_relic/agent/samplers/object_sampler.rb
    <li>lib/new_relic/agent/shim_agent.rb
    <li>lib/new_relic/agent/sql_sampler.rb
    <li>lib/new_relic/agent/stats_engine/gc_profiler.rb
    <li>lib/new_relic/agent/stats_engine/metric_stats.rb
    <li>lib/new_relic/agent/stats_engine/samplers.rb
    <li>lib/new_relic/agent/stats_engine/transactions.rb
    <li>lib/new_relic/agent/stats_engine.rb
    <li>lib/new_relic/agent/transaction_info.rb
    <li>lib/new_relic/agent/transaction_sample_builder.rb
    <li>lib/new_relic/agent/transaction_sampler.rb
    <li>lib/new_relic/agent/worker_loop.rb
    <li>lib/new_relic/agent.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-abort_transaction-21">#abort_transaction!</a>
    
    <li><a href="#method-i-add_custom_parameters">#add_custom_parameters</a>
    
    <li><a href="#method-i-add_instrumentation">#add_instrumentation</a>
    
    <li><a href="#method-i-add_request_parameters">#add_request_parameters</a>
    
    <li><a href="#method-i-after_fork">#after_fork</a>
    
    <li><a href="#method-i-browser_timing_footer">#browser_timing_footer</a>
    
    <li><a href="#method-i-browser_timing_header">#browser_timing_header</a>
    
    <li><a href="#method-i-disable_all_tracing">#disable_all_tracing</a>
    
    <li><a href="#method-i-disable_sql_recording">#disable_sql_recording</a>
    
    <li><a href="#method-i-disable_transaction_tracing">#disable_transaction_tracing</a>
    
    <li><a href="#method-i-get_stats">#get_stats</a>
    
    <li><a href="#method-i-get_stats_no_scope">#get_stats_no_scope</a>
    
    <li><a href="#method-i-ignore_error_filter">#ignore_error_filter</a>
    
    <li><a href="#method-i-is_execution_traced-3F">#is_execution_traced?</a>
    
    <li><a href="#method-i-is_sql_recorded-3F">#is_sql_recorded?</a>
    
    <li><a href="#method-i-is_transaction_traced-3F">#is_transaction_traced?</a>
    
    <li><a href="#method-i-load_data">#load_data</a>
    
    <li><a href="#method-i-logger">#logger</a>
    
    <li><a href="#method-i-manual_start">#manual_start</a>
    
    <li><a href="#method-i-notice_error">#notice_error</a>
    
    <li><a href="#method-i-record_transaction">#record_transaction</a>
    
    <li><a href="#method-i-reset_stats">#reset_stats</a>
    
    <li><a href="#method-i-save_data">#save_data</a>
    
    <li><a href="#method-i-set_sql_obfuscator">#set_sql_obfuscator</a>
    
    <li><a href="#method-i-set_user_attributes">#set_user_attributes</a>
    
    <li><a href="#method-i-shutdown">#shutdown</a>
    
    <li><a href="#method-i-with_database_metric_name">#with_database_metric_name</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../CHANGELOG.html">CHANGELOG</a>
  
    <li class="file"><a href="../LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../README_rdoc.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../NewRelic.html">NewRelic</a>
  
    <li><a href="../NewRelic/Agent.html">NewRelic::Agent</a>
  
    <li><a href="../NewRelic/Agent/Agent.html">NewRelic::Agent::Agent</a>
  
    <li><a href="../NewRelic/Agent/Agent/ClassMethods.html">NewRelic::Agent::Agent::ClassMethods</a>
  
    <li><a href="../NewRelic/Agent/Agent/InstanceMethods.html">NewRelic::Agent::Agent::InstanceMethods</a>
  
    <li><a href="../NewRelic/Agent/Agent/InstanceMethods/Connect.html">NewRelic::Agent::Agent::InstanceMethods::Connect</a>
  
    <li><a href="../NewRelic/Agent/Agent/InstanceMethods/Start.html">NewRelic::Agent::Agent::InstanceMethods::Start</a>
  
    <li><a href="../NewRelic/Agent/Agent/InstanceMethods/StartWorkerThread.html">NewRelic::Agent::Agent::InstanceMethods::StartWorkerThread</a>
  
    <li><a href="../NewRelic/Agent/BackgroundLoadingError.html">NewRelic::Agent::BackgroundLoadingError</a>
  
    <li><a href="../NewRelic/Agent/BeaconConfiguration.html">NewRelic::Agent::BeaconConfiguration</a>
  
    <li><a href="../NewRelic/Agent/BrowserMonitoring.html">NewRelic::Agent::BrowserMonitoring</a>
  
    <li><a href="../NewRelic/Agent/BrowserMonitoring/DummyMetricFrame.html">NewRelic::Agent::BrowserMonitoring::DummyMetricFrame</a>
  
    <li><a href="../NewRelic/Agent/BusyCalculator.html">NewRelic::Agent::BusyCalculator</a>
  
    <li><a href="../NewRelic/Agent/Database.html">NewRelic::Agent::Database</a>
  
    <li><a href="../NewRelic/Agent/Database/ConnectionManager.html">NewRelic::Agent::Database::ConnectionManager</a>
  
    <li><a href="../NewRelic/Agent/Database/Obfuscator.html">NewRelic::Agent::Database::Obfuscator</a>
  
    <li><a href="../NewRelic/Agent/ErrorCollector.html">NewRelic::Agent::ErrorCollector</a>
  
    <li><a href="../NewRelic/Agent/ErrorCollector/NoticeError.html">NewRelic::Agent::ErrorCollector::NoticeError</a>
  
    <li><a href="../NewRelic/Agent/ForceDisconnectException.html">NewRelic::Agent::ForceDisconnectException</a>
  
    <li><a href="../NewRelic/Agent/ForceRestartException.html">NewRelic::Agent::ForceRestartException</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation.html">NewRelic::Agent::Instrumentation</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/ActiveRecordInstrumentation.html">NewRelic::Agent::Instrumentation::ActiveRecordInstrumentation</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/ControllerInstrumentation.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/ControllerInstrumentation/ClassMethods.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation::ClassMethods</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/DataMapperInstrumentation.html">NewRelic::Agent::Instrumentation::DataMapperInstrumentation</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Memcache.html">NewRelic::Agent::Instrumentation::Memcache</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/MetricFrame.html">NewRelic::Agent::Instrumentation::MetricFrame</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/MetricFrame/Pop.html">NewRelic::Agent::Instrumentation::MetricFrame::Pop</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/QueueTime.html">NewRelic::Agent::Instrumentation::QueueTime</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Rack.html">NewRelic::Agent::Instrumentation::Rack</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Rails3.html">NewRelic::Agent::Instrumentation::Rails3</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Rails3/ActionController.html">NewRelic::Agent::Instrumentation::Rails3::ActionController</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Rails3/ActionView.html">NewRelic::Agent::Instrumentation::Rails3::ActionView</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Rails3/ActionView/PartialRenderer.html">NewRelic::Agent::Instrumentation::Rails3::ActionView::PartialRenderer</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Rails3/Errors.html">NewRelic::Agent::Instrumentation::Rails3::Errors</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/Sinatra.html">NewRelic::Agent::Instrumentation::Sinatra</a>
  
    <li><a href="../NewRelic/Agent/LicenseException.html">NewRelic::Agent::LicenseException</a>
  
    <li><a href="../NewRelic/Agent/MethodTracer.html">NewRelic::Agent::MethodTracer</a>
  
    <li><a href="../NewRelic/Agent/MethodTracer/ClassMethods.html">NewRelic::Agent::MethodTracer::ClassMethods</a>
  
    <li><a href="../NewRelic/Agent/MethodTracer/ClassMethods/AddMethodTracer.html">NewRelic::Agent::MethodTracer::ClassMethods::AddMethodTracer</a>
  
    <li><a href="../NewRelic/Agent/MethodTracer/InstanceMethods.html">NewRelic::Agent::MethodTracer::InstanceMethods</a>
  
    <li><a href="../NewRelic/Agent/MethodTracer/InstanceMethods/TraceExecutionScoped.html">NewRelic::Agent::MethodTracer::InstanceMethods::TraceExecutionScoped</a>
  
    <li><a href="../NewRelic/Agent/PostTooBigException.html">NewRelic::Agent::PostTooBigException</a>
  
    <li><a href="../NewRelic/Agent/Sampler.html">NewRelic::Agent::Sampler</a>
  
    <li><a href="../NewRelic/Agent/Sampler/Unsupported.html">NewRelic::Agent::Sampler::Unsupported</a>
  
    <li><a href="../NewRelic/Agent/Samplers.html">NewRelic::Agent::Samplers</a>
  
    <li><a href="../NewRelic/Agent/Samplers/CpuSampler.html">NewRelic::Agent::Samplers::CpuSampler</a>
  
    <li><a href="../NewRelic/Agent/Samplers/DelayedJobLockSampler.html">NewRelic::Agent::Samplers::DelayedJobLockSampler</a>
  
    <li><a href="../NewRelic/Agent/Samplers/MemorySampler.html">NewRelic::Agent::Samplers::MemorySampler</a>
  
    <li><a href="../NewRelic/Agent/Samplers/MemorySampler/Base.html">NewRelic::Agent::Samplers::MemorySampler::Base</a>
  
    <li><a href="../NewRelic/Agent/Samplers/MemorySampler/JavaHeapSampler.html">NewRelic::Agent::Samplers::MemorySampler::JavaHeapSampler</a>
  
    <li><a href="../NewRelic/Agent/Samplers/MemorySampler/ProcStatus.html">NewRelic::Agent::Samplers::MemorySampler::ProcStatus</a>
  
    <li><a href="../NewRelic/Agent/Samplers/MemorySampler/ShellPS.html">NewRelic::Agent::Samplers::MemorySampler::ShellPS</a>
  
    <li><a href="../NewRelic/Agent/Samplers/ObjectSampler.html">NewRelic::Agent::Samplers::ObjectSampler</a>
  
    <li><a href="../NewRelic/Agent/ServerConnectionException.html">NewRelic::Agent::ServerConnectionException</a>
  
    <li><a href="../NewRelic/Agent/ServerError.html">NewRelic::Agent::ServerError</a>
  
    <li><a href="../NewRelic/Agent/ShimAgent.html">NewRelic::Agent::ShimAgent</a>
  
    <li><a href="../NewRelic/Agent/SlowSql.html">NewRelic::Agent::SlowSql</a>
  
    <li><a href="../NewRelic/Agent/SqlSampler.html">NewRelic::Agent::SqlSampler</a>
  
    <li><a href="../NewRelic/Agent/SqlTrace.html">NewRelic::Agent::SqlTrace</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine.html">NewRelic::Agent::StatsEngine</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/GCProfiler.html">NewRelic::Agent::StatsEngine::GCProfiler</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/GCProfiler/Profiler.html">NewRelic::Agent::StatsEngine::GCProfiler::Profiler</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/GCProfiler/RailsBench.html">NewRelic::Agent::StatsEngine::GCProfiler::RailsBench</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/GCProfiler/Rubinius.html">NewRelic::Agent::StatsEngine::GCProfiler::Rubinius</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/GCProfiler/Ruby19.html">NewRelic::Agent::StatsEngine::GCProfiler::Ruby19</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/MetricStats.html">NewRelic::Agent::StatsEngine::MetricStats</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/MetricStats/Harvest.html">NewRelic::Agent::StatsEngine::MetricStats::Harvest</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/MetricStats/SynchronizedHash.html">NewRelic::Agent::StatsEngine::MetricStats::SynchronizedHash</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/Samplers.html">NewRelic::Agent::StatsEngine::Samplers</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/ScopeStackElement.html">NewRelic::Agent::StatsEngine::ScopeStackElement</a>
  
    <li><a href="../NewRelic/Agent/StatsEngine/Transactions.html">NewRelic::Agent::StatsEngine::Transactions</a>
  
    <li><a href="../NewRelic/Agent/TransactionInfo.html">NewRelic::Agent::TransactionInfo</a>
  
    <li><a href="../NewRelic/Agent/TransactionSampleBuilder.html">NewRelic::Agent::TransactionSampleBuilder</a>
  
    <li><a href="../NewRelic/Agent/TransactionSampler.html">NewRelic::Agent::TransactionSampler</a>
  
    <li><a href="../NewRelic/Agent/TransactionSqlData.html">NewRelic::Agent::TransactionSqlData</a>
  
    <li><a href="../NewRelic/Agent/WorkerLoop.html">NewRelic::Agent::WorkerLoop</a>
  
    <li><a href="../NewRelic/ApdexStats.html">NewRelic::ApdexStats</a>
  
    <li><a href="../NewRelic/BasicStats.html">NewRelic::BasicStats</a>
  
    <li><a href="../NewRelic/ChainedCall.html">NewRelic::ChainedCall</a>
  
    <li><a href="../NewRelic/CollectionHelper.html">NewRelic::CollectionHelper</a>
  
    <li><a href="../NewRelic/Command.html">NewRelic::Command</a>
  
    <li><a href="../NewRelic/Command/CommandFailure.html">NewRelic::Command::CommandFailure</a>
  
    <li><a href="../NewRelic/Command/Deployments.html">NewRelic::Command::Deployments</a>
  
    <li><a href="../NewRelic/Command/Install.html">NewRelic::Command::Install</a>
  
    <li><a href="../NewRelic/Control.html">NewRelic::Control</a>
  
    <li><a href="../NewRelic/Control/ClassMethods.html">NewRelic::Control::ClassMethods</a>
  
    <li><a href="../NewRelic/Control/Configuration.html">NewRelic::Control::Configuration</a>
  
    <li><a href="../NewRelic/Control/Frameworks.html">NewRelic::Control::Frameworks</a>
  
    <li><a href="../NewRelic/Control/Frameworks/External.html">NewRelic::Control::Frameworks::External</a>
  
    <li><a href="../NewRelic/Control/Frameworks/Merb.html">NewRelic::Control::Frameworks::Merb</a>
  
    <li><a href="../NewRelic/Control/Frameworks/Rails.html">NewRelic::Control::Frameworks::Rails</a>
  
    <li><a href="../NewRelic/Control/Frameworks/Rails3.html">NewRelic::Control::Frameworks::Rails3</a>
  
    <li><a href="../NewRelic/Control/Frameworks/Ruby.html">NewRelic::Control::Frameworks::Ruby</a>
  
    <li><a href="../NewRelic/Control/Frameworks/Sinatra.html">NewRelic::Control::Frameworks::Sinatra</a>
  
    <li><a href="../NewRelic/Control/InstanceMethods.html">NewRelic::Control::InstanceMethods</a>
  
    <li><a href="../NewRelic/Control/Instrumentation.html">NewRelic::Control::Instrumentation</a>
  
    <li><a href="../NewRelic/Control/LoggingMethods.html">NewRelic::Control::LoggingMethods</a>
  
    <li><a href="../NewRelic/Control/Profiling.html">NewRelic::Control::Profiling</a>
  
    <li><a href="../NewRelic/Control/ServerMethods.html">NewRelic::Control::ServerMethods</a>
  
    <li><a href="../NewRelic/DataSerialization.html">NewRelic::DataSerialization</a>
  
    <li><a href="../NewRelic/DataSerialization/ClassMethods.html">NewRelic::DataSerialization::ClassMethods</a>
  
    <li><a href="../NewRelic/DelayedJobInjection.html">NewRelic::DelayedJobInjection</a>
  
    <li><a href="../NewRelic/Instrumentation.html">NewRelic::Instrumentation</a>
  
    <li><a href="../NewRelic/Instrumentation/ActsAsSolrInstrumentation.html">NewRelic::Instrumentation::ActsAsSolrInstrumentation</a>
  
    <li><a href="../NewRelic/Instrumentation/ActsAsSolrInstrumentation/ParserMethodsInstrumentation.html">NewRelic::Instrumentation::ActsAsSolrInstrumentation::ParserMethodsInstrumentation</a>
  
    <li><a href="../NewRelic/LanguageSupport.html">NewRelic::LanguageSupport</a>
  
    <li><a href="../NewRelic/LanguageSupport/Control.html">NewRelic::LanguageSupport::Control</a>
  
    <li><a href="../NewRelic/LanguageSupport/DataSerialization.html">NewRelic::LanguageSupport::DataSerialization</a>
  
    <li><a href="../NewRelic/LanguageSupport/SynchronizedHash.html">NewRelic::LanguageSupport::SynchronizedHash</a>
  
    <li><a href="../NewRelic/LocalEnvironment.html">NewRelic::LocalEnvironment</a>
  
    <li><a href="../NewRelic/MerbBootLoader.html">NewRelic::MerbBootLoader</a>
  
    <li><a href="../NewRelic/MethodTraceStats.html">NewRelic::MethodTraceStats</a>
  
    <li><a href="../NewRelic/MetricData.html">NewRelic::MetricData</a>
  
    <li><a href="../NewRelic/MetricSpec.html">NewRelic::MetricSpec</a>
  
    <li><a href="../NewRelic/Metrics.html">NewRelic::Metrics</a>
  
    <li><a href="../NewRelic/NoticedError.html">NewRelic::NoticedError</a>
  
    <li><a href="../NewRelic/Rack.html">NewRelic::Rack</a>
  
    <li><a href="../NewRelic/Rack/BrowserMonitoring.html">NewRelic::Rack::BrowserMonitoring</a>
  
    <li><a href="../NewRelic/Rack/DeveloperMode.html">NewRelic::Rack::DeveloperMode</a>
  
    <li><a href="../NewRelic/Railtie.html">NewRelic::Railtie</a>
  
    <li><a href="../NewRelic/ScopedMethodTraceStats.html">NewRelic::ScopedMethodTraceStats</a>
  
    <li><a href="../NewRelic/Stats.html">NewRelic::Stats</a>
  
    <li><a href="../NewRelic/StatsBase.html">NewRelic::StatsBase</a>
  
    <li><a href="../NewRelic/TransactionAnalysis.html">NewRelic::TransactionAnalysis</a>
  
    <li><a href="../NewRelic/TransactionAnalysis/SegmentSummary.html">NewRelic::TransactionAnalysis::SegmentSummary</a>
  
    <li><a href="../NewRelic/TransactionSample.html">NewRelic::TransactionSample</a>
  
    <li><a href="../NewRelic/TransactionSample/CompositeSegment.html">NewRelic::TransactionSample::CompositeSegment</a>
  
    <li><a href="../NewRelic/TransactionSample/FakeSegment.html">NewRelic::TransactionSample::FakeSegment</a>
  
    <li><a href="../NewRelic/TransactionSample/Segment.html">NewRelic::TransactionSample::Segment</a>
  
    <li><a href="../NewRelic/TransactionSample/SummarySegment.html">NewRelic::TransactionSample::SummarySegment</a>
  
    <li><a href="../NewRelic/UrlRule.html">NewRelic::UrlRule</a>
  
    <li><a href="../NewRelic/UrlRule/RuleSet.html">NewRelic::UrlRule::RuleSet</a>
  
    <li><a href="../NewRelic/VersionNumber.html">NewRelic::VersionNumber</a>
  
    <li><a href="../ActionView.html">ActionView</a>
  
    <li><a href="../ActionView/Base.html">ActionView::Base</a>
  
    <li><a href="../ActionView/Partials.html">ActionView::Partials</a>
  
    <li><a href="../ActionView/Partials/PartialRenderer.html">ActionView::Partials::PartialRenderer</a>
  
    <li><a href="../ActionController.html">ActionController</a>
  
    <li><a href="../ActionController/Base.html">ActionController::Base</a>
  
    <li><a href="../Object.html">Object</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module NewRelic::Agent</h1>

  <div id="description" class="description">
    
<h2 id="label-Ruby+Agent+APIs">Ruby <a href="Agent/Agent.html">Agent</a> APIs</h2>

<p>This module contains the public API methods for the Ruby <a
href="Agent/Agent.html">Agent</a>.</p>

<p>For adding custom instrumentation to method invocations, refer to the docs
in the class <a
href="Agent/MethodTracer.html">NewRelic::Agent::MethodTracer</a>.</p>

<p>For information on how to customize the controller instrumentation, or to
instrument something other than Rails so that high level dispatcher actions
or background tasks show up as first class operations in New Relic, refer
to <a
href="Agent/Instrumentation/ControllerInstrumentation.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation</a>
and <a
href="Agent/Instrumentation/ControllerInstrumentation/ClassMethods.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation::ClassMethods</a>.</p>

<p>Methods in this module as well as documented methods in <a
href="Agent/MethodTracer.html">NewRelic::Agent::MethodTracer</a> and <a
href="Agent/Instrumentation/ControllerInstrumentation.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation</a>
are available to applications.  When the agent is not enabled the method
implementations are stubbed into no-ops to reduce overhead.</p>

<p>Methods and classes in other parts of the agent are not guaranteed to be
available between releases.</p>

<p>Refer to the online docs at support.newrelic.com to see how to access the
data collected by custom instrumentation, or e-mail support at New Relic
for help.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-abort_transaction-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">abort_transaction!</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Cancel the collection of the current transaction in progress, if any.  Only
affects the transaction started on this thread once it has started and
before it has completed.</p>
          

          
          <div class="method-source-code" id="abort_transaction-21-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 321</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">abort_transaction!</span>
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">abort_transaction!</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- abort_transaction-21-source -->
          
        </div>

        

        
      </div><!-- abort_transaction-21-method -->

    
      <div id="method-i-add_custom_parameters" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_custom_parameters</span><span
            class="method-args">(params)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Add parameters to the current transaction trace (and traced error if any)
on the call stack.</p>
          

          
          <div class="method-source-code" id="add_custom_parameters-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 388</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_custom_parameters</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">add_custom_parameters</span>(<span class="ruby-identifier">params</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_custom_parameters-source -->
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Agent.html#method-i-add_request_parameters">add_request_parameters</a>
        </div>
        

        
      </div><!-- add_custom_parameters-method -->

    
      <div id="method-i-add_instrumentation" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_instrumentation</span><span
            class="method-args">(file_pattern)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Add instrumentation files to the agent.  The argument should be a glob
matching ruby scripts which will be executed at the time instrumentation is
loaded.  Since instrumentation is not loaded when the agent is not running
it’s better to use this method to register instrumentation than just
loading the files directly, although that probably also works.</p>
          

          
          <div class="method-source-code" id="add_instrumentation-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 266</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_instrumentation</span>(<span class="ruby-identifier">file_pattern</span>)
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">add_instrumentation</span> <span class="ruby-identifier">file_pattern</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_instrumentation-source -->
          
        </div>

        

        
      </div><!-- add_instrumentation-method -->

    
      <div id="method-i-add_request_parameters" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">add_request_parameters</span><span
            class="method-args">(params)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>The <a
href="Agent.html#method-i-add_request_parameters">#add_request_parameters</a>
method is aliased to <a
href="Agent.html#method-i-add_custom_parameters">#add_custom_parameters</a>
and is now deprecated.</p>
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Agent.html#method-i-add_custom_parameters">add_custom_parameters</a>
        </div>
        
      </div><!-- add_request_parameters-method -->

    
      <div id="method-i-after_fork" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">after_fork</span><span
            class="method-args">(options={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Register this method as a callback for processes that fork jobs.</p>

<p>If the master/parent connects to the agent prior to forking the agent in
the forked process will use that agent_run.  Otherwise the forked process
will establish a new connection with the server.</p>

<p>Use this especially when you fork the process to run background jobs or
other work.  If you are doing this with a web dispatcher that forks worker
processes then you will need to force the agent to reconnect, which it
won’t do by default.  Passenger and Unicorn are already handled, nothing
special needed for them.</p>

<p>Options:</p>
<ul><li>
<p><code>:force_reconnect =&gt; true</code> to force the spawned process to
establish a new connection, such as when forking a long running process.
The default is false–it will only connect to the server if the parent had
not connected.</p>
</li><li>
<p><code>:keep_retrying =&gt; false</code> if we try to initiate a new
connection, this tells me to only try it once so this method returns
quickly if there is some kind of latency with the server.</p>
</li></ul>
          

          
          <div class="method-source-code" id="after_fork-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">after_fork</span>(<span class="ruby-identifier">options</span>={})
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">after_fork</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- after_fork-source -->
          
        </div>

        

        
      </div><!-- after_fork-method -->

    
      <div id="method-i-browser_timing_footer" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">browser_timing_footer</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns a Javascript string which should be injected into the very bottom
of the response body</p>
          

          
          <div class="method-source-code" id="browser_timing_footer-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 463</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">browser_timing_footer</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">browser_timing_footer</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- browser_timing_footer-source -->
          
        </div>

        

        
      </div><!-- browser_timing_footer-method -->

    
      <div id="method-i-browser_timing_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">browser_timing_header</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns a Javascript string which should be injected into the very top of
the response body</p>
          

          
          <div class="method-source-code" id="browser_timing_header-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 457</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">browser_timing_header</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">browser_timing_header</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- browser_timing_header-source -->
          
        </div>

        

        
      </div><!-- browser_timing_header-method -->

    
      <div id="method-i-disable_all_tracing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">disable_all_tracing</span><span
            class="method-args">() { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Yield to the block without collecting any metrics or traces in any of the
subsequent calls.  If executed recursively, will keep track of the first
entry point and turn on tracing again after leaving that block.  This uses
the thread local <code>newrelic_untrace</code></p>
          

          
          <div class="method-source-code" id="disable_all_tracing-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">disable_all_tracing</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">push_trace_execution_flag</span>(<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">pop_trace_execution_flag</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- disable_all_tracing-source -->
          
        </div>

        

        
      </div><!-- disable_all_tracing-method -->

    
      <div id="method-i-disable_sql_recording" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">disable_sql_recording</span><span
            class="method-args">() { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>This method sets the state of sql recording in the transaction sampler
feature. Within the given block, no sql will be recorded</p>

<p>usage:</p>

<pre>NewRelic::Agent.disable_sql_recording do
  ...
end</pre>
          

          
          <div class="method-source-code" id="disable_sql_recording-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 298</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">disable_sql_recording</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_sql</span>(<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_sql</span>(<span class="ruby-identifier">state</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- disable_sql_recording-source -->
          
        </div>

        

        
      </div><!-- disable_sql_recording-method -->

    
      <div id="method-i-disable_transaction_tracing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">disable_transaction_tracing</span><span
            class="method-args">() { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>This method disables the recording of transaction traces in the given
block.  See also <a
href="Agent.html#method-i-disable_all_tracing">#disable_all_tracing</a></p>
          

          
          <div class="method-source-code" id="disable_transaction_tracing-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">disable_transaction_tracing</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_tt</span>(<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_tt</span>(<span class="ruby-identifier">state</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- disable_transaction_tracing-source -->
          
        </div>

        

        
      </div><!-- disable_transaction_tracing-method -->

    
      <div id="method-i-get_stats" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_stats</span><span
            class="method-args">(metric_name, use_scope=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Get or create a statistics gatherer that will aggregate numerical data
under a metric name.</p>

<p><code>metric_name</code> should follow a slash separated path convention.
Application specific metrics should begin with “Custom/”.</p>

<p>Return a <a href="Stats.html">NewRelic::Stats</a> that accepts data via
calls to add_data_point(value).</p>
          

          
          <div class="method-source-code" id="get_stats-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_stats</span>(<span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">use_scope</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">get_stats</span>(<span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">use_scope</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_stats-source -->
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Agent.html#method-i-get_stats_no_scope">get_stats_no_scope</a>
        </div>
        

        
      </div><!-- get_stats-method -->

    
      <div id="method-i-get_stats_no_scope" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">get_stats_no_scope</span><span
            class="method-args">(metric_name, use_scope=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Agent.html#method-i-get_stats">get_stats</a>
        </div>
        
      </div><!-- get_stats_no_scope-method -->

    
      <div id="method-i-ignore_error_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ignore_error_filter</span><span
            class="method-args">(&block)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Set a filter to be applied to errors that the Ruby <a
href="Agent/Agent.html">Agent</a> will track.  The block should evalute to
the exception to track (which could be different from the original
exception) or nil to ignore this exception.</p>

<p>The block is yielded to with the exception to filter.</p>

<p>Return the new block or the existing filter Proc if no block is passed.</p>
          

          
          <div class="method-source-code" id="ignore_error_filter-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 363</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ignore_error_filter</span>(&amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">error_collector</span>.<span class="ruby-identifier">ignore_error_filter</span>(&amp;<span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- ignore_error_filter-source -->
          
        </div>

        

        
      </div><!-- ignore_error_filter-method -->

    
      <div id="method-i-is_execution_traced-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_execution_traced?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Check to see if we are capturing metrics currently on this thread.</p>
          

          
          <div class="method-source-code" id="is_execution_traced-3F-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 338</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_execution_traced?</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-value">:newrelic_untraced</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-value">:newrelic_untraced</span>].<span class="ruby-identifier">last</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_execution_traced-3F-source -->
          
        </div>

        

        
      </div><!-- is_execution_traced-3F-method -->

    
      <div id="method-i-is_sql_recorded-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_sql_recorded?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>helper method to check the thread local to determine whether sql is being
recorded or not</p>
          

          
          <div class="method-source-code" id="is_sql_recorded-3F-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_sql_recorded?</span>
  <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-identifier">current</span>[<span class="ruby-value">:record_sql</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_sql_recorded-3F-source -->
          
        </div>

        

        
      </div><!-- is_sql_recorded-3F-method -->

    
      <div id="method-i-is_transaction_traced-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_transaction_traced?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>helper method to check the thread local to determine whether the
transaction in progress is traced or not</p>
          

          
          <div class="method-source-code" id="is_transaction_traced-3F-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 344</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_transaction_traced?</span>
  <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-identifier">current</span>[<span class="ruby-value">:record_tt</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_transaction_traced-3F-source -->
          
        </div>

        

        
      </div><!-- is_transaction_traced-3F-method -->

    
      <div id="method-i-load_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_data</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Note that only one transaction trace will be sent even if many are
serialized, since the slowest is sent.</p>

<p>See also the complement to this method, <a
href="Agent.html#method-i-save_data">#save_data</a> - used when a process
is shutting down</p>
          

          
          <div class="method-source-code" id="load_data-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_data</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>[<span class="ruby-string">'disable_serialization'</span>]
    <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">DataSerialization</span>.<span class="ruby-identifier">read_and_write_to_file</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">old_data</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">merge_data_from</span>(<span class="ruby-identifier">old_data</span>)
      <span class="ruby-keyword">nil</span> <span class="ruby-comment"># return nil so nothing is written to the file</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">DataSerialization</span>.<span class="ruby-identifier">update_last_sent!</span>
  <span class="ruby-keyword">end</span>
  
  {
    <span class="ruby-value">:metrics</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">metrics</span>.<span class="ruby-identifier">length</span>,
    <span class="ruby-value">:traces</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">unsent_traces_size</span>,
    <span class="ruby-value">:errors</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">unsent_errors_size</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- load_data-source -->
          
        </div>

        

        
      </div><!-- load_data-method -->

    
      <div id="method-i-logger" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">logger</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Get the logger for the agent.  Available after the agent has initialized.
This sends output to the agent log file.  If the agent has not initialized
a standard output logger is returned.</p>
          

          
          <div class="method-source-code" id="logger-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 154</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">logger</span>
  <span class="ruby-identifier">control</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>(<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">control</span>
    <span class="ruby-identifier">control</span>.<span class="ruby-identifier">log</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">'logger'</span>
    <span class="ruby-ivar">@stdoutlog</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">$stdout</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- logger-source -->
          
        </div>

        

        
      </div><!-- logger-method -->

    
      <div id="method-i-manual_start" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">manual_start</span><span
            class="method-args">(options={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Call this to manually start the <a href="Agent/Agent.html">Agent</a> in
situations where the <a href="Agent/Agent.html">Agent</a> does not
auto-start.</p>

<p>When the app environment loads, so does the <a
href="Agent/Agent.html">Agent</a>. However, the <a
href="Agent/Agent.html">Agent</a> will only connect to the service if a web
front-end is found. If you want to selectively monitor ruby processes that
don’t use web plugins, then call this method in your code and the <a
href="Agent/Agent.html">Agent</a> will fire up and start reporting to the
service.</p>

<p>Options are passed in as overrides for values in the newrelic.yml, such as
app_name.  In addition, the option <code>log</code> will take a logger that
will be used instead of the standard file logger.  The setting for the
newrelic.yml section to use (ie, RAILS_ENV) can be overridden with an :env
argument.</p>
          

          
          <div class="method-source-code" id="manual_start-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">manual_start</span>(<span class="ruby-identifier">options</span>={})
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Options must be a hash&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">options</span>
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">init_plugin</span>({ <span class="ruby-value">:agent_enabled</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:sync_startup</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- manual_start-source -->
          
        </div>

        

        
      </div><!-- manual_start-method -->

    
      <div id="method-i-notice_error" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">notice_error</span><span
            class="method-args">(exception, options={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Record the given error.  It will be passed through the <a
href="Agent.html#method-i-ignore_error_filter">#ignore_error_filter</a> if
there is one.</p>
<ul><li>
<p><code>exception</code> is the exception which will be recorded.  May also
be an error message.</p>
</li></ul>

<p>Options:</p>
<ul><li>
<p><code>:uri</code> =&gt; The request path, minus any request params or query
string.</p>
</li><li>
<p><code>:referer</code> =&gt; The URI of the referer</p>
</li><li>
<p><code>:metric</code> =&gt; The metric name associated with the transaction</p>
</li><li>
<p><code>:request_params</code> =&gt; Request parameters, already filtered if
necessary</p>
</li><li>
<p><code>:custom_params</code> =&gt; Custom parameters</p>
</li></ul>

<p>Anything left over is treated as custom params.</p>
          

          
          <div class="method-source-code" id="notice_error-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 381</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notice_error</span>(<span class="ruby-identifier">exception</span>, <span class="ruby-identifier">options</span>={})
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">notice_error</span>(<span class="ruby-identifier">exception</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- notice_error-source -->
          
        </div>

        

        
      </div><!-- notice_error-method -->

    
      <div id="method-i-record_transaction" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">record_transaction</span><span
            class="method-args">(response_sec, options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Record a web transaction from an external source.  This will process the
response time, error, and score an apdex value.</p>

<p>First argument is a float value, time in seconds.  Option keys are strings.</p>

<h2 id="method-i-record_transaction-label-Identifying+the+transaction">Identifying the transaction</h2>
<ul><li>
<p><code>'uri' =&gt; uri</code> to record the value for a given web request.
If not provided, just record the aggregate dispatcher and apdex scores.</p>
</li><li>
<p><code>'metric' =&gt; metric_name</code> to record with a general metric
name like <code>OtherTransaction/Background/Class/method</code>.  Ignored
if <code>uri</code> is provided.</p>
</li></ul>

<h2 id="method-i-record_transaction-label-Error+options">Error options</h2>

<p>Provide one of the following:</p>
<ul><li>
<p><code>'is_error' =&gt; true</code> if an unknown error occurred</p>
</li><li>
<p><code>'error_message' =&gt; msg</code> if an error message is available</p>
</li><li>
<p><code>'exception' =&gt; exception</code> if a ruby exception is recorded</p>
</li></ul>

<h2 id="method-i-record_transaction-label-Misc+options">Misc options</h2>

<p>Additional information captured in errors</p>
<ul><li>
<p><code>'referer' =&gt; referer_url</code></p>
</li><li>
<p><code>'request_params' =&gt; hash</code> to record a set of name/value
pairs as the request parameters.</p>
</li><li>
<p><code>'custom_params' =&gt; hash</code> to record extra information in
traced errors</p>
</li></ul>
          

          
          <div class="method-source-code" id="record_transaction-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 451</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">record_transaction</span>(<span class="ruby-identifier">response_sec</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">record_transaction</span>(<span class="ruby-identifier">response_sec</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- record_transaction-source -->
          
        </div>

        

        
      </div><!-- record_transaction-method -->

    
      <div id="method-i-reset_stats" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_stats</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Clear out any unsent metric data. See <a
href="Agent/Agent/InstanceMethods.html#method-i-reset_stats">NewRelic::Agent::Agent::InstanceMethods#reset_stats</a></p>
          

          
          <div class="method-source-code" id="reset_stats-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_stats</span>
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">reset_stats</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reset_stats-source -->
          
        </div>

        

        
      </div><!-- reset_stats-method -->

    
      <div id="method-i-save_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_data</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>a method used to serialize short-running processes to disk, so we don’t
incur the overhead of reporting to the server for every fork/invocation of
a small job.</p>

<p>Functionally, this loads the data from the file into the agent (to avoid
losing data by overwriting) and then serializes the agent data to the file
again. See also <a href="Agent.html#method-i-load_data">#load_data</a></p>
          

          
          <div class="method-source-code" id="save_data-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_data</span>
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">DataSerialization</span>.<span class="ruby-identifier">read_and_write_to_file</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">old_data</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">merge_data_from</span>(<span class="ruby-identifier">old_data</span>)
    <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">serialize</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- save_data-source -->
          
        </div>

        

        
      </div><!-- save_data-method -->

    
      <div id="method-i-set_sql_obfuscator" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_sql_obfuscator</span><span
            class="method-args">(type = :replace, &block)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>This method sets the block sent to this method as a sql obfuscator.  The
block will be called with a single String SQL statement to obfuscate.  The
method must return the obfuscated String SQL.  If chaining of obfuscators
is required, use type = :before or :after</p>

<p>type = :before, :replace, :after</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">set_sql_obfuscator</span>(:<span class="ruby-identifier">replace</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sql</span><span class="ruby-operator">|</span>
   <span class="ruby-identifier">my_obfuscator</span>(<span class="ruby-identifier">sql</span>)
<span class="ruby-keyword">end</span>
</pre>
          

          
          <div class="method-source-code" id="set_sql_obfuscator-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 284</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">type</span> = <span class="ruby-value">:replace</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Database</span>.<span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">type</span>, &amp;<span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_sql_obfuscator-source -->
          
        </div>

        

        
      </div><!-- set_sql_obfuscator-method -->

    
      <div id="method-i-set_user_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_user_attributes</span><span
            class="method-args">(attributes)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Set attributes about the user making this request. These attributes will be
automatically appended to any Transaction Trace or Error that is collected.
These attributes will also be collected for RUM requests.</p>

<p>Attributes (hash)</p>
<ul><li>
<p><code>:user</code> =&gt; user name or ID</p>
</li><li>
<p><code>:account</code> =&gt; account name or ID</p>
</li><li>
<p><code>:product</code> =&gt; product name or level</p>
</li></ul>
          

          
          <div class="method-source-code" id="set_user_attributes-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 401</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_user_attributes</span>(<span class="ruby-identifier">attributes</span>)
  <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">set_user_attributes</span>(<span class="ruby-identifier">attributes</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_user_attributes-source -->
          
        </div>

        

        
      </div><!-- set_user_attributes-method -->

    
      <div id="method-i-shutdown" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shutdown</span><span
            class="method-args">(options={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Shutdown the agent.  Call this before exiting.  Sends any queued data and
kills the background thread.</p>
          

          
          <div class="method-source-code" id="shutdown-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shutdown</span>(<span class="ruby-identifier">options</span>={})
  <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">shutdown</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- shutdown-source -->
          
        </div>

        

        
      </div><!-- shutdown-method -->

    
      <div id="method-i-with_database_metric_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_database_metric_name</span><span
            class="method-args">(model, method) { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Yield to a block that is run with a database metric name context.  This
means the <a href="Agent/Database.html">Database</a> instrumentation will
use this for the metric name if it does not otherwise know about a model.
This is re-entrant.</p>
<ul><li>
<p><code>model</code> is the DB model class</p>
</li><li>
<p><code>method</code> is the name of the finder method or other method to
identify the operation with.</p>
</li></ul>
          

          
          <div class="method-source-code" id="with_database_metric_name-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent.rb, line 417</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">with_database_metric_name</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">method</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">frame</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">current</span>
    <span class="ruby-identifier">frame</span>.<span class="ruby-identifier">with_database_metric_name</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">method</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- with_database_metric_name-source -->
          
        </div>

        

        
      </div><!-- with_database_metric_name-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

