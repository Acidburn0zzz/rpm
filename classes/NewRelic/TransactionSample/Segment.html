<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: NewRelic::TransactionSample::Segment</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">NewRelic::TransactionSample::Segment</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/new_relic/transaction_sample_rb.html">
                lib/new_relic/transaction_sample.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000486">[]</a>&nbsp;&nbsp;
      <a href="#M000485">[]=</a>&nbsp;&nbsp;
      <a href="#M000472">add_called_segment</a>&nbsp;&nbsp;
      <a href="#M000479">called_segments</a>&nbsp;&nbsp;
      <a href="#M000493">called_segments=</a>&nbsp;&nbsp;
      <a href="#M000483">count_segments</a>&nbsp;&nbsp;
      <a href="#M000481">duration</a>&nbsp;&nbsp;
      <a href="#M000488">each_segment</a>&nbsp;&nbsp;
      <a href="#M000471">end_trace</a>&nbsp;&nbsp;
      <a href="#M000482">exclusive_duration</a>&nbsp;&nbsp;
      <a href="#M000490">explain_sql</a>&nbsp;&nbsp;
      <a href="#M000489">find_segment</a>&nbsp;&nbsp;
      <a href="#M000480">freeze</a>&nbsp;&nbsp;
      <a href="#M000475">from_json</a>&nbsp;&nbsp;
      <a href="#M000491">handle_exception_in_explain</a>&nbsp;&nbsp;
      <a href="#M000470">new</a>&nbsp;&nbsp;
      <a href="#M000492">obfuscated_sql</a>&nbsp;&nbsp;
      <a href="#M000487">params</a>&nbsp;&nbsp;
      <a href="#M000495">params=</a>&nbsp;&nbsp;
      <a href="#M000494">parent_segment=</a>&nbsp;&nbsp;
      <a href="#M000476">path_string</a>&nbsp;&nbsp;
      <a href="#M000478">to_debug_str</a>&nbsp;&nbsp;
      <a href="#M000474">to_json</a>&nbsp;&nbsp;
      <a href="#M000473">to_s</a>&nbsp;&nbsp;
      <a href="#M000477">to_s_compact</a>&nbsp;&nbsp;
      <a href="#M000484">truncate</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">entry_timestamp</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">exit_timestamp</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The exit timestamp will be relative except for the outermost sample which
will have a timestamp.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">metric_name</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">parent_segment</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">segment_id</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000475" class="method-detail">
        <a name="M000475"></a>

        <div class="method-heading">
          <a href="#M000475" class="method-signature">
          <span class="method-name">from_json</span><span class="method-args">(json, id_generator)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000475-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000475-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 69</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">json</span>, <span class="ruby-identifier">id_generator</span>)
        <span class="ruby-identifier">json</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>.<span class="ruby-identifier">decode</span>(<span class="ruby-identifier">json</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">json</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">json</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
          <span class="ruby-identifier">entry_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-value">1000</span>
          <span class="ruby-identifier">exit_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-value">1000</span>
          <span class="ruby-identifier">metric_name</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">2</span>]
          <span class="ruby-identifier">params</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">3</span>]
          <span class="ruby-identifier">called_segments</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value">4</span>]
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">entry_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;entry_timestamp&quot;</span>].<span class="ruby-identifier">to_f</span>
          <span class="ruby-identifier">exit_timestamp</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;exit_timestamp&quot;</span>].<span class="ruby-identifier">to_f</span>
          <span class="ruby-identifier">metric_name</span> =  <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;metric_name&quot;</span>]       
          <span class="ruby-identifier">params</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;params&quot;</span>]
          
          <span class="ruby-identifier">called_segments</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;called_segments&quot;</span>]
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">segment</span> = <span class="ruby-constant">Segment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">entry_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">id_generator</span>.<span class="ruby-identifier">next_id</span>)
        <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">end_trace</span> <span class="ruby-identifier">exit_timestamp</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>
          <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:params=</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">called_segments</span>
          <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">add_called_segment</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">child</span>, <span class="ruby-identifier">id_generator</span>))
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">segment</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000470" class="method-detail">
        <a name="M000470"></a>

        <div class="method-heading">
          <a href="#M000470" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(timestamp, metric_name, segment_id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000470-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000470-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 35</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span>)
        <span class="ruby-ivar">@entry_timestamp</span> = <span class="ruby-identifier">timestamp</span>
        <span class="ruby-ivar">@metric_name</span> = <span class="ruby-identifier">metric_name</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'&lt;unknown&gt;'</span>
        <span class="ruby-ivar">@segment_id</span> = <span class="ruby-identifier">segment_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">object_id</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000486" class="method-detail">
        <a name="M000486"></a>

        <div class="method-heading">
          <a href="#M000486" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000486-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000486-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 189</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)
        <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000485" class="method-detail">
        <a name="M000485"></a>

        <div class="method-heading">
          <a href="#M000485" class="method-signature">
          <span class="method-name">[]=</span><span class="method-args">(key, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000485-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000485-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 183</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
        <span class="ruby-comment cmt"># only create a parameters field if a parameter is set; this will save</span>
        <span class="ruby-comment cmt"># bandwidth etc as most segments have no parameters</span>
        <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000472" class="method-detail">
        <a name="M000472"></a>

        <div class="method-heading">
          <a href="#M000472" class="method-signature">
          <span class="method-name">add_called_segment</span><span class="method-args">(s)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000472-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000472-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 45</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_called_segment</span>(<span class="ruby-identifier">s</span>)
        <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">||=</span> []
        <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>
        <span class="ruby-identifier">s</span>.<span class="ruby-identifier">parent_segment</span> = <span class="ruby-keyword kw">self</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000479" class="method-detail">
        <a name="M000479"></a>

        <div class="method-heading">
          <a href="#M000479" class="method-signature">
          <span class="method-name">called_segments</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000479-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000479-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 130</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">called_segments</span>
        <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">||</span> <span class="ruby-constant">EMPTY_ARRAY</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000493" class="method-detail">
        <a name="M000493"></a>

        <div class="method-heading">
          <a href="#M000493" class="method-signature">
          <span class="method-name">called_segments=</span><span class="method-args">(segments)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000493-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000493-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 273</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">called_segments=</span>(<span class="ruby-identifier">segments</span>)
        <span class="ruby-ivar">@called_segments</span> = <span class="ruby-identifier">segments</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000483" class="method-detail">
        <a name="M000483"></a>

        <div class="method-heading">
          <a href="#M000483" class="method-signature">
          <span class="method-name">count_segments</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000483-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000483-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 161</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_segments</span>
        <span class="ruby-identifier">count</span> = <span class="ruby-value">1</span>
        <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">seg</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">count</span>  <span class="ruby-operator">+=</span> <span class="ruby-identifier">seg</span>.<span class="ruby-identifier">count_segments</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
        <span class="ruby-identifier">count</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000481" class="method-detail">
        <a name="M000481"></a>

        <div class="method-heading">
          <a href="#M000481" class="method-signature">
          <span class="method-name">duration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return the total <a href="Segment.html#M000481">duration</a> of this
segment
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000481-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000481-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 145</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">duration</span>
        (<span class="ruby-ivar">@exit_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@entry_timestamp</span>).<span class="ruby-identifier">to_f</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000488" class="method-detail">
        <a name="M000488"></a>

        <div class="method-heading">
          <a href="#M000488" class="method-signature">
          <span class="method-name">each_segment</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
call the provided block for this segment and each of the called segments
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000488-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000488-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 199</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword kw">self</span>
        
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
          <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000471" class="method-detail">
        <a name="M000471"></a>

        <div class="method-heading">
          <a href="#M000471" class="method-signature">
          <span class="method-name">end_trace</span><span class="method-args">(timestamp)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000471-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000471-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 41</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">end_trace</span>(<span class="ruby-identifier">timestamp</span>)
        <span class="ruby-ivar">@exit_timestamp</span> = <span class="ruby-identifier">timestamp</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000482" class="method-detail">
        <a name="M000482"></a>

        <div class="method-heading">
          <a href="#M000482" class="method-signature">
          <span class="method-name">exclusive_duration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return the <a href="Segment.html#M000481">duration</a> of this segment
without including the time in the called segments
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000482-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000482-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 151</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exclusive_duration</span>
        <span class="ruby-identifier">d</span> = <span class="ruby-identifier">duration</span>
        
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
          <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">d</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">duration</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">d</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000490" class="method-detail">
        <a name="M000490"></a>

        <div class="method-heading">
          <a href="#M000490" class="method-signature">
          <span class="method-name">explain_sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
perform this in the runtime environment of a managed application, to
explain the sql statement(s) executed within a segment of a transaction
sample. returns an array of explanations (which is an array rows consisting
of an array of strings for each column returned by the the explain query)
Note this happens only for statements whose execution time exceeds a
threshold (e.g. 500ms) and only within the slowest transaction in a report
period, selected for shipment to RPM
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000490-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000490-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 224</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">explain_sql</span>        
        <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sql</span>]
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:connection_config</span>]
        <span class="ruby-identifier">statements</span> = <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;;\n&quot;</span>)
        <span class="ruby-identifier">explanations</span> = []
        <span class="ruby-identifier">statements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">statement</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">$;</span>, <span class="ruby-value">2</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'SELECT'</span>
            <span class="ruby-identifier">explain_resultset</span> = []
            <span class="ruby-keyword kw">begin</span>
              <span class="ruby-identifier">connection</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:connection_config</span>])    
              <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>
                <span class="ruby-comment cmt"># The resultset type varies for different drivers.  Only thing you can count on is</span>
                <span class="ruby-comment cmt"># that it implements each.  Also: can't use select_rows because the native postgres</span>
                <span class="ruby-comment cmt"># driver doesn't know that method.</span>
                <span class="ruby-identifier">explain_resultset</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;EXPLAIN #{statement}&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>
                <span class="ruby-identifier">rows</span> = []
                <span class="ruby-comment cmt"># Note: we can't use map.</span>
                <span class="ruby-comment cmt"># Note: have to convert from native column element types to string so we can</span>
                <span class="ruby-comment cmt"># serialize.  Esp. for postgresql.</span>
                <span class="ruby-comment cmt"># Can't use map.  Suck it up.</span>
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">explain_resultset</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:each</span>)
                  <span class="ruby-identifier">explain_resultset</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">row</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_s</span>) }
                <span class="ruby-keyword kw">else</span>
                  <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> [ <span class="ruby-identifier">explain_resultset</span> ]
                <span class="ruby-keyword kw">end</span>
                <span class="ruby-identifier">explanations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rows</span>
                <span class="ruby-comment cmt"># sleep for a very short period of time in order to yield to the main thread</span>
                <span class="ruby-comment cmt"># this is because a remote database call will likely hang the VM</span>
                <span class="ruby-identifier">sleep</span> <span class="ruby-value">0</span><span class="ruby-value">.05</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
              <span class="ruby-identifier">handle_exception_in_explain</span>(<span class="ruby-identifier">e</span>)
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>

        <span class="ruby-identifier">explanations</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000489" class="method-detail">
        <a name="M000489"></a>

        <div class="method-heading">
          <a href="#M000489" class="method-signature">
          <span class="method-name">find_segment</span><span class="method-args">(id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000489-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000489-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 209</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@segment_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">id</span>
        <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">found</span> = <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
          <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">found</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">found</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000480" class="method-detail">
        <a name="M000480"></a>

        <div class="method-heading">
          <a href="#M000480" class="method-signature">
          <span class="method-name">freeze</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000480-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000480-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 134</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">freeze</span>
        <span class="ruby-identifier">params</span>.<span class="ruby-identifier">freeze</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span>
          <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">s</span>.<span class="ruby-identifier">freeze</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">super</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000491" class="method-detail">
        <a name="M000491"></a>

        <div class="method-heading">
          <a href="#M000491" class="method-signature">
          <span class="method-name">handle_exception_in_explain</span><span class="method-args">(e)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000491-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000491-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 263</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_exception_in_explain</span>(<span class="ruby-identifier">e</span>)
        <span class="ruby-identifier">x</span> = <span class="ruby-value">1</span> <span class="ruby-comment cmt"># this is here so that code coverage knows we've entered this block</span>
        <span class="ruby-comment cmt"># swallow failed attempts to run an explain.  One example of a failure is the</span>
        <span class="ruby-comment cmt"># connection for the sql statement is to a different db than the default connection</span>
        <span class="ruby-comment cmt"># specified in AR::Base</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000492" class="method-detail">
        <a name="M000492"></a>

        <div class="method-heading">
          <a href="#M000492" class="method-signature">
          <span class="method-name">obfuscated_sql</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000492-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000492-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 269</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">obfuscated_sql</span>
        <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">obfuscate_sql</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sql</span>])
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000487" class="method-detail">
        <a name="M000487"></a>

        <div class="method-heading">
          <a href="#M000487" class="method-signature">
          <span class="method-name">params</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000487-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000487-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 193</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params</span>
        <span class="ruby-ivar">@params</span> <span class="ruby-operator">||=</span> {}
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000476" class="method-detail">
        <a name="M000476"></a>

        <div class="method-heading">
          <a href="#M000476" class="method-signature">
          <span class="method-name">path_string</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000476-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000476-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 98</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path_string</span>
        <span class="ruby-node">&quot;#{metric_name}[#{called_segments.collect {|segment| segment.path_string }.join('')}]&quot;</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000478" class="method-detail">
        <a name="M000478"></a>

        <div class="method-heading">
          <a href="#M000478" class="method-signature">
          <span class="method-name">to_debug_str</span><span class="method-args">(depth)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000478-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000478-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 109</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_debug_str</span>(<span class="ruby-identifier">depth</span>)
        <span class="ruby-identifier">tab</span> = <span class="ruby-value str">&quot;  &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">depth</span> 
        <span class="ruby-identifier">s</span> = <span class="ruby-identifier">tab</span>.<span class="ruby-identifier">clone</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&gt;&gt; #{'%3i ms' % (@entry_timestamp*1000)} [#{self.class.name.split(&quot;::&quot;).last}] #{metric_name} \n&quot;</span>
        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{tab}    -#{'%-16s' % k}: #{v.to_s[0..80]}\n&quot;</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cs</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cs</span>.<span class="ruby-identifier">to_debug_str</span>(<span class="ruby-identifier">depth</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tab</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;&lt;&lt; &quot;</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@exit_timestamp</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">' n/a'</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Numeric</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'%3i ms'</span> <span class="ruby-operator">%</span> (<span class="ruby-ivar">@exit_timestamp</span><span class="ruby-operator">*</span><span class="ruby-value">1000</span>)
          <span class="ruby-keyword kw">else</span> <span class="ruby-ivar">@exit_timestamp</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; #{metric_name}\n&quot;</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000474" class="method-detail">
        <a name="M000474"></a>

        <div class="method-heading">
          <a href="#M000474" class="method-signature">
          <span class="method-name">to_json</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000474-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000474-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 55</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_json</span>
        <span class="ruby-identifier">map</span> = {<span class="ruby-identifier">:entry_timestamp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@entry_timestamp</span>,
          <span class="ruby-identifier">:exit_timestamp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@exit_timestamp</span>,
          <span class="ruby-identifier">:metric_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@metric_name</span>,
          <span class="ruby-identifier">:segment_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@segment_id</span>}
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@called_segments</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">map</span>[<span class="ruby-identifier">:called_segments</span>] = <span class="ruby-ivar">@called_segments</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@params</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@params</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">map</span>[<span class="ruby-identifier">:params</span>] = <span class="ruby-ivar">@params</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_json</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000473" class="method-detail">
        <a name="M000473"></a>

        <div class="method-heading">
          <a href="#M000473" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000473-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000473-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 51</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
        <span class="ruby-identifier">to_debug_str</span>(<span class="ruby-value">0</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000477" class="method-detail">
        <a name="M000477"></a>

        <div class="method-heading">
          <a href="#M000477" class="method-signature">
          <span class="method-name">to_s_compact</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000477-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000477-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 101</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s_compact</span>
        <span class="ruby-identifier">str</span> = <span class="ruby-value str">&quot;&quot;</span>
        <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">metric_name</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">called_segments</span>.<span class="ruby-identifier">any?</span>
          <span class="ruby-identifier">str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;{#{called_segments.map { | cs | cs.to_s_compact }.join(&quot;,&quot;)}}&quot;</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">str</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000484" class="method-detail">
        <a name="M000484"></a>

        <div class="method-heading">
          <a href="#M000484" class="method-signature">
          <span class="method-name">truncate</span><span class="method-args">(max)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Walk through the tree and <a href="Segment.html#M000484">truncate</a> the
segments
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000484-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000484-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 167</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">max</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@called_segments</span>
        <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>
        <span class="ruby-ivar">@called_segments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">segment</span> <span class="ruby-operator">|</span>
          <span class="ruby-identifier">max</span> = <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span>)
          <span class="ruby-identifier">max</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">max</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
            <span class="ruby-ivar">@called_segments</span> = <span class="ruby-ivar">@called_segments</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">i</span>]
            <span class="ruby-keyword kw">break</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">max</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000495" class="method-detail">
        <a name="M000495"></a>

        <div class="method-heading">
          <a href="#M000495" class="method-signature">
          <span class="method-name">params=</span><span class="method-args">(p)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000495-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000495-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 281</span>
        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params=</span>(<span class="ruby-identifier">p</span>)
          <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">p</span>
        <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000494" class="method-detail">
        <a name="M000494"></a>

        <div class="method-heading">
          <a href="#M000494" class="method-signature">
          <span class="method-name">parent_segment=</span><span class="method-args">(s)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000494-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000494-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 278</span>
        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parent_segment=</span>(<span class="ruby-identifier">s</span>)
          <span class="ruby-ivar">@parent_segment</span> = <span class="ruby-identifier">s</span>
        <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>