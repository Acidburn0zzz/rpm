<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NewRelic::TransactionSample</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            NewRelic::TransactionSample 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/new_relic/transaction_sample_rb.html">lib/new_relic/transaction_sample.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000791">analyze</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000774">close_connections</a>,</li>
                
                <li><a href="#M000776">count_segments</a>,</li>
                
                <li><a href="#M000783">create_segment</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000784">duration</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M000785">each_segment</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M000787">find_segment</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000773">get_connection</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000775">new</a></li>
                
            </ul>
        </dd>
    
        <dt>O</dt>
        <dd>
            <ul>
                
                <li><a href="#M000772">obfuscate_sql</a>,</li>
                
                <li><a href="#M000789">omit_segments_with</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M000792">params=</a>,</li>
                
                <li><a href="#M000782">path_string</a>,</li>
                
                <li><a href="#M000790">prepare_to_send</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000781">start_time</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000779">timestamp</a>,</li>
                
                <li><a href="#M000788">to_s</a>,</li>
                
                <li><a href="#M000786">to_s_compact</a>,</li>
                
                <li><a href="#M000777">truncate</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="DelayedJobInjection.html">NewRelic::DelayedJobInjection</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/CompositeSegment.html">NewRelic::TransactionSample::CompositeSegment</a></li>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/FakeSegment.html">NewRelic::TransactionSample::FakeSegment</a></li>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/Segment.html">NewRelic::TransactionSample::Segment</a></li>
        
        <li><span class="type">CLASS</span> <a href="TransactionSample/SummarySegment.html">NewRelic::TransactionSample::SummarySegment</a></li>
        
    </ul>
    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">EMPTY_ARRAY</td>
            <td>=</td>
            <td class="attr-value">[].freeze</td>
        </tr>
        
        
    </table>
    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>params</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>root_segment</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [RW]
            </td>
            <td class='attr-name'>profile</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>root_segment</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>params</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>sample_id</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000774">
                    
                    <a name="M000774"></a><b>close_connections</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000774_source')" id="l_M000774_source">show</a>
                        
                    </p>
                    <div id="M000774_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 317</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_connections</span>
        <span class="ruby-ivar">@@connections</span> <span class="ruby-operator">||=</span> {}
        <span class="ruby-ivar">@@connections</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">begin</span>
            <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">disconnect!</span>
          <span class="ruby-keyword kw">rescue</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>

        <span class="ruby-ivar">@@connections</span> = {}
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000773">
                    
                    <a name="M000773"></a><b>get_connection</b>(config)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000773_source')" id="l_M000773_source">show</a>
                        
                    </p>
                    <div id="M000773_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 300</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">config</span>)
        <span class="ruby-ivar">@@connections</span> <span class="ruby-operator">||=</span> {}

        <span class="ruby-identifier">connection</span> = <span class="ruby-ivar">@@connections</span>[<span class="ruby-identifier">config</span>]

        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">connection</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>

        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-identifier">connection</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{config[:adapter]}_connection&quot;</span>, <span class="ruby-identifier">config</span>)
          <span class="ruby-ivar">@@connections</span>[<span class="ruby-identifier">config</span>] = <span class="ruby-identifier">connection</span>
        <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
          <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Caught exception #{e} trying to get connection to DB for explain. Control: #{config}&quot;</span>)
          <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
          <span class="ruby-keyword kw">nil</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000775">
                    
                    <a name="M000775"></a><b>new</b>(time = Time.now.to_f, sample_id = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000775_source')" id="l_M000775_source">show</a>
                        
                    </p>
                    <div id="M000775_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 336</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>, <span class="ruby-identifier">sample_id</span> = <span class="ruby-keyword kw">nil</span>)
      <span class="ruby-ivar">@sample_id</span> = <span class="ruby-identifier">sample_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">object_id</span>
      <span class="ruby-ivar">@start_time</span> = <span class="ruby-identifier">time</span>
      <span class="ruby-ivar">@root_segment</span> = <span class="ruby-identifier">create_segment</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-value str">&quot;ROOT&quot;</span>
      <span class="ruby-ivar">@params</span> = {}
      <span class="ruby-ivar">@params</span>[<span class="ruby-identifier">:request_params</span>] = {}
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000772">
                    
                    <a name="M000772"></a><b>obfuscate_sql</b>(sql)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000772_source')" id="l_M000772_source">show</a>
                        
                    </p>
                    <div id="M000772_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 296</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">obfuscate_sql</span>(<span class="ruby-identifier">sql</span>)
        <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">obfuscator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">sql</span>)
      <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000791">
                    
                    <a name="M000791"></a><b>analyze</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000791_source')" id="l_M000791_source">show</a>
                        
                    </p>
                    <div id="M000791_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 468</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">analyze</span>
      <span class="ruby-identifier">sample</span> = <span class="ruby-keyword kw">self</span>
      <span class="ruby-identifier">original_path_string</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
        <span class="ruby-identifier">original_path_string</span> = <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">path_string</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-identifier">new_sample</span> = <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">dup</span>
        <span class="ruby-identifier">new_sample</span>.<span class="ruby-identifier">root_segment</span> = <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">dup</span>
        <span class="ruby-identifier">new_sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">called_segments</span> = <span class="ruby-identifier">analyze_called_segments</span>(<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">called_segments</span>)
        <span class="ruby-identifier">sample</span> = <span class="ruby-identifier">new_sample</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sample</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">path_string</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">original_path_string</span>
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000776">
                    
                    <a name="M000776"></a><b>count_segments</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000776_source')" id="l_M000776_source">show</a>
                        
                    </p>
                    <div id="M000776_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 344</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_segments</span>
      <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">count_segments</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>    <span class="ruby-comment cmt"># don't count the root segment</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000783">
                    
                    <a name="M000783"></a><b>create_segment</b>(relative_timestamp, metric_name, segment_id = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000783_source')" id="l_M000783_source">show</a>
                        
                    </p>
                    <div id="M000783_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 386</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_segment</span>(<span class="ruby-identifier">relative_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span> = <span class="ruby-keyword kw">nil</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Frozen Transaction Sample&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frozen?</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSample</span><span class="ruby-operator">::</span><span class="ruby-constant">Segment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">relative_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000784">
                    
                    <a name="M000784"></a><b>duration</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000784_source')" id="l_M000784_source">show</a>
                        
                    </p>
                    <div id="M000784_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 391</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">duration</span>
      <span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">duration</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000785">
                    
                    <a name="M000785"></a><b>each_segment</b>(&amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000785_source')" id="l_M000785_source">show</a>
                        
                    </p>
                    <div id="M000785_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 395</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
      <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000787">
                    
                    <a name="M000787"></a><b>find_segment</b>(id)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000787_source')" id="l_M000787_source">show</a>
                        
                    </p>
                    <div id="M000787_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 403</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
      <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000789">
                    
                    <a name="M000789"></a><b>omit_segments_with</b>(regex)
                    
                </div>
                
                <div class="description">
                  <p>
return a new transaction sample that treats segments with the given regular
expression in their name as if they were never called at all. This allows
us to strip out segments from traces captured in development environment
that would not normally show up in production (like Rails/Application Code
Loading)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000789_source')" id="l_M000789_source">show</a>
                        
                    </p>
                    <div id="M000789_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 433</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">omit_segments_with</span>(<span class="ruby-identifier">regex</span>)
      <span class="ruby-identifier">regex</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">regex</span>)

      <span class="ruby-identifier">sample</span> = <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@start_time</span>, <span class="ruby-identifier">sample_id</span>)

      <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>}

      <span class="ruby-identifier">delta</span> = <span class="ruby-identifier">build_segment_with_omissions</span>(<span class="ruby-identifier">sample</span>, <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-ivar">@root_segment</span>, <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>, <span class="ruby-identifier">regex</span>)
      <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">exit_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">delta</span>)
      <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">profile</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">profile</span>
      <span class="ruby-identifier">sample</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000792">
                    
                    <a name="M000792"></a><b>params=</b>(params)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000792_source')" id="l_M000792_source">show</a>
                        
                    </p>
                    <div id="M000792_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 482</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params=</span>(<span class="ruby-identifier">params</span>)
      <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">params</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000782">
                    
                    <a name="M000782"></a><b>path_string</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000782_source')" id="l_M000782_source">show</a>
                        
                    </p>
                    <div id="M000782_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 382</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path_string</span>
      <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">path_string</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000790">
                    
                    <a name="M000790"></a><b>prepare_to_send</b>(options={})
                    
                </div>
                
                <div class="description">
                  <p>
return a new transaction sample that can be sent to the RPM service. this
involves potentially one or more of the following options
</p>
<pre>
  :explain_sql : run EXPLAIN on all queries whose response times equal the value for this key
      (for example :explain_sql =&gt; 2.0 would explain everything over 2 seconds.  0.0 would explain everything.)
  :keep_backtraces : keep backtraces, significantly increasing size of trace (off by default)
  :record_sql =&gt; [ :raw | :obfuscated] : copy over the sql, obfuscating if necessary
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000790_source')" id="l_M000790_source">show</a>
                        
                    </p>
                    <div id="M000790_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 453</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_to_send</span>(<span class="ruby-identifier">options</span>={})
      <span class="ruby-identifier">sample</span> = <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@start_time</span>, <span class="ruby-identifier">sample_id</span>)

      <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">params</span>

      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-identifier">build_segment_for_transfer</span>(<span class="ruby-identifier">sample</span>, <span class="ruby-ivar">@root_segment</span>, <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>, <span class="ruby-identifier">options</span>)
      <span class="ruby-keyword kw">ensure</span>
        <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">close_connections</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">exit_timestamp</span>)
      <span class="ruby-identifier">sample</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000781">
                    
                    <a name="M000781"></a><b>start_time</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000781_source')" id="l_M000781_source">show</a>
                        
                    </p>
                    <div id="M000781_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 378</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_time</span>
      <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-ivar">@start_time</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000779">
                    
                    <a name="M000779"></a><b>timestamp</b>()
                    
                </div>
                
                <div class="description">
                  <p>
offset from start of app
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000779_source')" id="l_M000779_source">show</a>
                        
                    </p>
                    <div id="M000779_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 361</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">timestamp</span>
      <span class="ruby-ivar">@start_time</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@@start_time</span>.<span class="ruby-identifier">to_f</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000788">
                    
                    <a name="M000788"></a><b>to_s</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000788_source')" id="l_M000788_source">show</a>
                        
                    </p>
                    <div id="M000788_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 407</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">s</span> = <span class="ruby-node">&quot;Transaction Sample collected at #{start_time}\n&quot;</span>
      <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  {\n&quot;</span>
      <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  Path: #{params[:path]} \n&quot;</span>

      <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:path</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  #{k}: &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
        <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">v</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Enumerable</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_s</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;; &quot;</span>)
          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">v</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Float</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'%6.3s'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">v</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">''</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unexpected value type for #{k}: '#{v}' (#{v.class})&quot;</span>
        <span class="ruby-keyword kw">end</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  }\n\n&quot;</span>
      <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span>  <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">to_debug_str</span>(<span class="ruby-value">0</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000786">
                    
                    <a name="M000786"></a><b>to_s_compact</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000786_source')" id="l_M000786_source">show</a>
                        
                    </p>
                    <div id="M000786_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 399</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s_compact</span>
      <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">to_s_compact</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000777">
                    
                    <a name="M000777"></a><b>truncate</b>(max)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000777_source')" id="l_M000777_source">show</a>
                        
                    </p>
                    <div id="M000777_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 348</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span>)
      <span class="ruby-identifier">original_count</span> = <span class="ruby-identifier">count_segments</span>

      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">original_count</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">max</span>

      <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">max</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)

      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:segment_count</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:segment_count</span>] = <span class="ruby-identifier">original_count</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    