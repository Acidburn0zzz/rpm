<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: NewRelic::TransactionSample</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">NewRelic::TransactionSample</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/new_relic/transaction_sample_rb.html">
                lib/new_relic/transaction_sample.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000394">analyze</a>&nbsp;&nbsp;
      <a href="#M000378">close_connections</a>&nbsp;&nbsp;
      <a href="#M000385">create_segment</a>&nbsp;&nbsp;
      <a href="#M000387">duration</a>&nbsp;&nbsp;
      <a href="#M000388">each_segment</a>&nbsp;&nbsp;
      <a href="#M000390">find_segment</a>&nbsp;&nbsp;
      <a href="#M000386">freeze</a>&nbsp;&nbsp;
      <a href="#M000382">from_json</a>&nbsp;&nbsp;
      <a href="#M000377">get_connection</a>&nbsp;&nbsp;
      <a href="#M000379">new</a>&nbsp;&nbsp;
      <a href="#M000376">obfuscate_sql</a>&nbsp;&nbsp;
      <a href="#M000392">omit_segments_with</a>&nbsp;&nbsp;
      <a href="#M000396">params=</a>&nbsp;&nbsp;
      <a href="#M000384">path_string</a>&nbsp;&nbsp;
      <a href="#M000393">prepare_to_send</a>&nbsp;&nbsp;
      <a href="#M000395">root_segment=</a>&nbsp;&nbsp;
      <a href="#M000383">start_time</a>&nbsp;&nbsp;
      <a href="#M000380">timestamp</a>&nbsp;&nbsp;
      <a href="#M000381">to_json</a>&nbsp;&nbsp;
      <a href="#M000391">to_s</a>&nbsp;&nbsp;
      <a href="#M000389">to_s_compact</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="TransactionAnalysis.html">TransactionAnalysis</a></span>
      </div>
    </div>

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="TransactionSample/CompositeSegment.html" class="link">NewRelic::TransactionSample::CompositeSegment</a><br />
Class <a href="TransactionSample/Segment.html" class="link">NewRelic::TransactionSample::Segment</a><br />
Class <a href="TransactionSample/SummarySegment.html" class="link">NewRelic::TransactionSample::SummarySegment</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">EMPTY_ARRAY</td>
          <td>=</td>
          <td class="context-item-value">[].freeze</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">params</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">root_segment</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">sample_id</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000378" class="method-detail">
        <a name="M000378"></a>

        <div class="method-heading">
          <a href="#M000378" class="method-signature">
          <span class="method-name">close_connections</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000378-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000378-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 314</span>
314:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close_connections</span>
315:         <span class="ruby-ivar">@@connections</span> <span class="ruby-operator">||=</span> {}
316:         <span class="ruby-ivar">@@connections</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
317:           <span class="ruby-keyword kw">begin</span>
318:             <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">disconnect!</span>
319:           <span class="ruby-keyword kw">rescue</span>
320:           <span class="ruby-keyword kw">end</span>
321:         <span class="ruby-keyword kw">end</span>
322:         
323:         <span class="ruby-ivar">@@connections</span> = {}
324:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000382" class="method-detail">
        <a name="M000382"></a>

        <div class="method-heading">
          <a href="#M000382" class="method-signature">
          <span class="method-name">from_json</span><span class="method-args">(json)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000382-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000382-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 355</span>
355:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">json</span>)
356:       <span class="ruby-identifier">json</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>.<span class="ruby-identifier">decode</span>(<span class="ruby-identifier">json</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">json</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
357:       <span class="ruby-identifier">sample</span> = <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;start_time&quot;</span>].<span class="ruby-identifier">to_f</span>, <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;sample_id&quot;</span>].<span class="ruby-identifier">to_i</span>)
358:       <span class="ruby-identifier">params</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;params&quot;</span>]
359:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>
360:         <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:params=</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>)
361:       <span class="ruby-keyword kw">end</span>
362:       <span class="ruby-identifier">root</span> = <span class="ruby-identifier">json</span>[<span class="ruby-value str">&quot;root_segment&quot;</span>]
363:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root</span>
364:         <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:root_segment=</span>, <span class="ruby-constant">Segment</span>.<span class="ruby-identifier">from_json</span>(<span class="ruby-identifier">root</span>)
365:       <span class="ruby-keyword kw">end</span>
366:       <span class="ruby-identifier">sample</span>
367:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000377" class="method-detail">
        <a name="M000377"></a>

        <div class="method-heading">
          <a href="#M000377" class="method-signature">
          <span class="method-name">get_connection</span><span class="method-args">(config)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000377-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000377-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 297</span>
297:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">config</span>)
298:         <span class="ruby-ivar">@@connections</span> <span class="ruby-operator">||=</span> {}
299:         
300:         <span class="ruby-identifier">connection</span> = <span class="ruby-ivar">@@connections</span>[<span class="ruby-identifier">config</span>]
301:         
302:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">connection</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">connection</span>
303:         
304:         <span class="ruby-keyword kw">begin</span>
305:           <span class="ruby-identifier">connection</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{config[:adapter]}_connection&quot;</span>, <span class="ruby-identifier">config</span>)
306:           <span class="ruby-ivar">@@connections</span>[<span class="ruby-identifier">config</span>] = <span class="ruby-identifier">connection</span>
307:         <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
308:           <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Caught exception #{e} trying to get connection to DB for explain. Control: #{config}&quot;</span>)
309:           <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
310:           <span class="ruby-keyword kw">nil</span>
311:         <span class="ruby-keyword kw">end</span>
312:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000379" class="method-detail">
        <a name="M000379"></a>

        <div class="method-heading">
          <a href="#M000379" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(time = Time.now.to_f, sample_id = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000379-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000379-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 332</span>
332:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_f</span>, <span class="ruby-identifier">sample_id</span> = <span class="ruby-keyword kw">nil</span>)
333:       <span class="ruby-ivar">@sample_id</span> = <span class="ruby-identifier">sample_id</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">object_id</span>
334:       <span class="ruby-ivar">@start_time</span> = <span class="ruby-identifier">time</span>
335:       <span class="ruby-ivar">@root_segment</span> = <span class="ruby-identifier">create_segment</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-value str">&quot;ROOT&quot;</span>
336:       <span class="ruby-ivar">@params</span> = {}
337:       <span class="ruby-ivar">@params</span>[<span class="ruby-identifier">:request_params</span>] = {}
338:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000376" class="method-detail">
        <a name="M000376"></a>

        <div class="method-heading">
          <a href="#M000376" class="method-signature">
          <span class="method-name">obfuscate_sql</span><span class="method-args">(sql)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000376-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000376-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 292</span>
292:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">obfuscate_sql</span>(<span class="ruby-identifier">sql</span>)
293:         <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">obfuscator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">sql</span>) 
294:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000394" class="method-detail">
        <a name="M000394"></a>

        <div class="method-heading">
          <a href="#M000394" class="method-signature">
          <span class="method-name">analyze</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000394-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000394-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 460</span>
460:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">analyze</span>
461:       <span class="ruby-identifier">sample</span> = <span class="ruby-keyword kw">self</span>
462:       <span class="ruby-identifier">original_path_string</span> = <span class="ruby-keyword kw">nil</span>
463:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
464:         <span class="ruby-identifier">original_path_string</span> = <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">path_string</span>.<span class="ruby-identifier">to_s</span>
465:         <span class="ruby-identifier">new_sample</span> = <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">dup</span>
466:         <span class="ruby-identifier">new_sample</span>.<span class="ruby-identifier">root_segment</span> = <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">dup</span>
467:         <span class="ruby-identifier">new_sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">called_segments</span> = <span class="ruby-identifier">analyze_called_segments</span>(<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">called_segments</span>)
468:         <span class="ruby-identifier">sample</span> = <span class="ruby-identifier">new_sample</span>
469:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sample</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">path_string</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">original_path_string</span>
470:       <span class="ruby-keyword kw">end</span>
471:       
472:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000385" class="method-detail">
        <a name="M000385"></a>

        <div class="method-heading">
          <a href="#M000385" class="method-signature">
          <span class="method-name">create_segment</span><span class="method-args">(relative_timestamp, metric_name, segment_id = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000385-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000385-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 377</span>
377:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_segment</span> (<span class="ruby-identifier">relative_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span> = <span class="ruby-keyword kw">nil</span>)
378:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Frozen Transaction Sample&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frozen?</span>
379:       <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">TransactionSample</span><span class="ruby-operator">::</span><span class="ruby-constant">Segment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">relative_timestamp</span>, <span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">segment_id</span>)    
380:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000387" class="method-detail">
        <a name="M000387"></a>

        <div class="method-heading">
          <a href="#M000387" class="method-signature">
          <span class="method-name">duration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000387-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000387-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 388</span>
388:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">duration</span>
389:       <span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">duration</span>
390:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000388" class="method-detail">
        <a name="M000388"></a>

        <div class="method-heading">
          <a href="#M000388" class="method-signature">
          <span class="method-name">each_segment</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000388-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000388-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 392</span>
392:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
393:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">each_segment</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
394:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000390" class="method-detail">
        <a name="M000390"></a>

        <div class="method-heading">
          <a href="#M000390" class="method-signature">
          <span class="method-name">find_segment</span><span class="method-args">(id)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000390-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000390-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 400</span>
400:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
401:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">find_segment</span>(<span class="ruby-identifier">id</span>)
402:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000386" class="method-detail">
        <a name="M000386"></a>

        <div class="method-heading">
          <a href="#M000386" class="method-signature">
          <span class="method-name">freeze</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000386-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000386-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 382</span>
382:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">freeze</span>
383:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">freeze</span>
384:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">freeze</span>
385:       <span class="ruby-keyword kw">super</span>
386:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000392" class="method-detail">
        <a name="M000392"></a>

        <div class="method-heading">
          <a href="#M000392" class="method-signature">
          <span class="method-name">omit_segments_with</span><span class="method-args">(regex)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return a <a href="TransactionSample.html#M000379">new</a> transaction
sample that treats segments with the given regular expression in their name
as if they were never called at all. This allows us to strip out segments
from traces captured in development environment that would not normally
show up in production (like Rails/Application Code Loading)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000392-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000392-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 427</span>
427:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">omit_segments_with</span>(<span class="ruby-identifier">regex</span>)
428:       <span class="ruby-identifier">regex</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">regex</span>)
429:       
430:       <span class="ruby-identifier">sample</span> = <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@start_time</span>, <span class="ruby-identifier">sample_id</span>)
431:       
432:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>}
433:         
434:       <span class="ruby-identifier">delta</span> = <span class="ruby-identifier">build_segment_with_omissions</span>(<span class="ruby-identifier">sample</span>, <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-ivar">@root_segment</span>, <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>, <span class="ruby-identifier">regex</span>)
435:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">exit_timestamp</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">delta</span>) 
436:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">freeze</span>
437:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000384" class="method-detail">
        <a name="M000384"></a>

        <div class="method-heading">
          <a href="#M000384" class="method-signature">
          <span class="method-name">path_string</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000384-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000384-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 373</span>
373:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path_string</span>
374:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">path_string</span>
375:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000393" class="method-detail">
        <a name="M000393"></a>

        <div class="method-heading">
          <a href="#M000393" class="method-signature">
          <span class="method-name">prepare_to_send</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
return a <a href="TransactionSample.html#M000379">new</a> transaction
sample that can be sent to the RPM service. this involves potentially one
or more of the following options
</p>
<pre>
  :explain_sql : run EXPLAIN on all queries whose response times equal the value for this key
      (for example :explain_sql =&gt; 2.0 would explain everything over 2 seconds.  0.0 would explain everything.)
  :keep_backtraces : keep backtraces, significantly increasing size of trace (off by default)
  :obfuscate_sql : clear sql fields of potentially sensitive values (higher overhead, better security)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000393-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000393-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 445</span>
445:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_to_send</span>(<span class="ruby-identifier">options</span>={})
446:       <span class="ruby-identifier">sample</span> = <span class="ruby-constant">TransactionSample</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@start_time</span>, <span class="ruby-identifier">sample_id</span>)
447:       
448:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">params</span>
449:       
450:       <span class="ruby-keyword kw">begin</span>
451:         <span class="ruby-identifier">build_segment_for_transfer</span>(<span class="ruby-identifier">sample</span>, <span class="ruby-ivar">@root_segment</span>, <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>, <span class="ruby-identifier">options</span>)
452:       <span class="ruby-keyword kw">ensure</span>
453:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">close_connections</span>
454:       <span class="ruby-keyword kw">end</span>
455:       
456:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">root_segment</span>.<span class="ruby-identifier">end_trace</span>(<span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">exit_timestamp</span>) 
457:       <span class="ruby-identifier">sample</span>.<span class="ruby-identifier">freeze</span>
458:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000383" class="method-detail">
        <a name="M000383"></a>

        <div class="method-heading">
          <a href="#M000383" class="method-signature">
          <span class="method-name">start_time</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000383-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000383-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 369</span>
369:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_time</span>
370:       <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-ivar">@start_time</span>)
371:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000380" class="method-detail">
        <a name="M000380"></a>

        <div class="method-heading">
          <a href="#M000380" class="method-signature">
          <span class="method-name">timestamp</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
offset from start of app
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000380-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000380-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 341</span>
341:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">timestamp</span>
342:       <span class="ruby-ivar">@start_time</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@@start_time</span>.<span class="ruby-identifier">to_f</span>
343:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000381" class="method-detail">
        <a name="M000381"></a>

        <div class="method-heading">
          <a href="#M000381" class="method-signature">
          <span class="method-name">to_json</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000381-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000381-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 345</span>
345:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_json</span>(<span class="ruby-identifier">options</span> = {})
346:       <span class="ruby-identifier">map</span> = {<span class="ruby-identifier">:sample_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sample_id</span>,
347:         <span class="ruby-identifier">:start_time</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@start_time</span>,
348:         <span class="ruby-identifier">:root_segment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@root_segment</span>}
349:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@params</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@params</span>.<span class="ruby-identifier">empty?</span>
350:         <span class="ruby-identifier">map</span>[<span class="ruby-identifier">:params</span>] = <span class="ruby-ivar">@params</span>  
351:       <span class="ruby-keyword kw">end</span>
352:       <span class="ruby-identifier">map</span>.<span class="ruby-identifier">to_json</span>
353:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000391" class="method-detail">
        <a name="M000391"></a>

        <div class="method-heading">
          <a href="#M000391" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000391-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000391-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 404</span>
404:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
405:       <span class="ruby-identifier">s</span> = <span class="ruby-node">&quot;Transaction Sample collected at #{start_time}\n&quot;</span>
406:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  {\n&quot;</span>
407:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  Path: #{params[:path]} \n&quot;</span>
408:       
409:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
410:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:path</span>
411:         <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  #{k}: &quot;</span> <span class="ruby-operator">&lt;&lt;</span>
412:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">v</span>
413:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Enumerable</span>; <span class="ruby-identifier">v</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_s</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;; &quot;</span>)
414:         <span class="ruby-keyword kw">else</span>
415:           <span class="ruby-identifier">v</span>
416:         <span class="ruby-keyword kw">end</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
417:       <span class="ruby-keyword kw">end</span>
418:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  }\n\n&quot;</span>
419:       <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span>  <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">to_debug_str</span>(<span class="ruby-value">0</span>)
420:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000389" class="method-detail">
        <a name="M000389"></a>

        <div class="method-heading">
          <a href="#M000389" class="method-signature">
          <span class="method-name">to_s_compact</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000389-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000389-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 396</span>
396:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s_compact</span>
397:       <span class="ruby-ivar">@root_segment</span>.<span class="ruby-identifier">to_s_compact</span>
398:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000396" class="method-detail">
        <a name="M000396"></a>

        <div class="method-heading">
          <a href="#M000396" class="method-signature">
          <span class="method-name">params=</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000396-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000396-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 478</span>
478:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">params=</span>(<span class="ruby-identifier">params</span>)
479:       <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">params</span>
480:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000395" class="method-detail">
        <a name="M000395"></a>

        <div class="method-heading">
          <a href="#M000395" class="method-signature">
          <span class="method-name">root_segment=</span><span class="method-args">(segment)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000395-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000395-source">
<pre>
     <span class="ruby-comment cmt"># File lib/new_relic/transaction_sample.rb, line 475</span>
475:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root_segment=</span>(<span class="ruby-identifier">segment</span>)
476:       <span class="ruby-ivar">@root_segment</span> = <span class="ruby-identifier">segment</span>
477:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>