<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: NewRelic::Control</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">NewRelic::Control</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/new_relic/control_rb.html">
                lib/new_relic/control.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="Control.html">Control</a> is a singleton responsible for the
startup and initialization sequence. The initializer uses a <a
href="LocalEnvironment.html">LocalEnvironment</a> to detect the <a
href="Control.html#M000424">framework</a> and instantiates the <a
href="Control.html#M000424">framework</a> specific subclass.
</p>
<p>
The <a href="Control.html">Control</a> also implements some of the public
API for the agent.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000409">[]</a>&nbsp;&nbsp;
      <a href="#M000411">[]=</a>&nbsp;&nbsp;
      <a href="#M000441">add_instrumentation</a>&nbsp;&nbsp;
      <a href="#M000422">agent_enabled?</a>&nbsp;&nbsp;
      <a href="#M000414">apdex_t</a>&nbsp;&nbsp;
      <a href="#M000433">api_server</a>&nbsp;&nbsp;
      <a href="#M000423">app</a>&nbsp;&nbsp;
      <a href="#M000427">app_names</a>&nbsp;&nbsp;
      <a href="#M000413">append_environment_info</a>&nbsp;&nbsp;
      <a href="#M000444">append_environment_info</a>&nbsp;&nbsp;
      <a href="#M000416">capture_params</a>&nbsp;&nbsp;
      <a href="#M000449">config_file</a>&nbsp;&nbsp;
      <a href="#M000445">convert_to_ip_address</a>&nbsp;&nbsp;
      <a href="#M000418">developer_mode?</a>&nbsp;&nbsp;
      <a href="#M000426">dispatcher</a>&nbsp;&nbsp;
      <a href="#M000425">dispatcher_instance_id</a>&nbsp;&nbsp;
      <a href="#M000412">fetch</a>&nbsp;&nbsp;
      <a href="#M000424">framework</a>&nbsp;&nbsp;
      <a href="#M000436">http_connection</a>&nbsp;&nbsp;
      <a href="#M000407">init_plugin</a>&nbsp;&nbsp;
      <a href="#M000442">install_instrumentation</a>&nbsp;&nbsp;
      <a href="#M000440">install_shim</a>&nbsp;&nbsp;
      <a href="#M000406">instance</a>&nbsp;&nbsp;
      <a href="#M000415">license_key</a>&nbsp;&nbsp;
      <a href="#M000455">load_instrumentation_files</a>&nbsp;&nbsp;
      <a href="#M000443">load_samplers</a>&nbsp;&nbsp;
      <a href="#M000438">log</a>&nbsp;&nbsp;
      <a href="#M000439">log!</a>&nbsp;&nbsp;
      <a href="#M000450">log_path</a>&nbsp;&nbsp;
      <a href="#M000446">merge_defaults</a>&nbsp;&nbsp;
      <a href="#M000417">monitor_mode?</a>&nbsp;&nbsp;
      <a href="#M000419">multi_threaded?</a>&nbsp;&nbsp;
      <a href="#M000452">new</a>&nbsp;&nbsp;
      <a href="#M000451">new_instance</a>&nbsp;&nbsp;
      <a href="#M000454">newrelic_root</a>&nbsp;&nbsp;
      <a href="#M000453">newrelic_root</a>&nbsp;&nbsp;
      <a href="#M000421">post_size_limit</a>&nbsp;&nbsp;
      <a href="#M000405">profiling=</a>&nbsp;&nbsp;
      <a href="#M000403">profiling?</a>&nbsp;&nbsp;
      <a href="#M000404">profiling_available?</a>&nbsp;&nbsp;
      <a href="#M000434">proxy_server</a>&nbsp;&nbsp;
      <a href="#M000432">server</a>&nbsp;&nbsp;
      <a href="#M000435">server_from_host</a>&nbsp;&nbsp;
      <a href="#M000410">settings</a>&nbsp;&nbsp;
      <a href="#M000447">setup_log</a>&nbsp;&nbsp;
      <a href="#M000408">start_agent</a>&nbsp;&nbsp;
      <a href="#M000437">to_s</a>&nbsp;&nbsp;
      <a href="#M000448">to_stdout</a>&nbsp;&nbsp;
      <a href="#M000430">use_ssl?</a>&nbsp;&nbsp;
      <a href="#M000420">use_textmate?</a>&nbsp;&nbsp;
      <a href="#M000428">validate_seed</a>&nbsp;&nbsp;
      <a href="#M000429">validate_token</a>&nbsp;&nbsp;
      <a href="#M000431">verify_certificate?</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">env</td>
          <td class="context-item-value">&nbsp;[W]&nbsp;</td>
          <td class="context-item-desc">
The env is the setting used to identify which section of the newrelic.yml
to load. This defaults to a <a href="Control.html#M000424">framework</a>
specific value, such as ENV[&#8216;RAILS_ENV&#8217;] but can be overridden
as long as you set it before calling <a
href="Control.html#M000407">init_plugin</a>

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">local_env</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">log_file</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000406" class="method-detail">
        <a name="M000406"></a>

        <div class="method-heading">
          <a href="#M000406" class="method-signature">
          <span class="method-name">instance</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Access the <a href="Control.html">Control</a> singleton, lazy initialized
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000406-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000406-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 53</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>
      <span class="ruby-ivar">@instance</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">new_instance</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000452" class="method-detail">
        <a name="M000452"></a>

        <div class="method-heading">
          <a href="#M000452" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(local_env)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000452-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000452-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 457</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">local_env</span>
      <span class="ruby-ivar">@local_env</span> = <span class="ruby-identifier">local_env</span>
      <span class="ruby-ivar">@instrumentation_files</span> = []
      <span class="ruby-identifier">newrelic_file</span> = <span class="ruby-identifier">config_file</span>
      <span class="ruby-comment cmt"># Next two are for populating the newrelic.yml via erb binding, necessary</span>
      <span class="ruby-comment cmt"># when using the default newrelic.yml file</span>
      <span class="ruby-identifier">generated_for_user</span> = <span class="ruby-value str">''</span>
      <span class="ruby-identifier">license_key</span>=<span class="ruby-value str">''</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">config_file</span>)
        <span class="ruby-identifier">log!</span> <span class="ruby-node">&quot;Cannot find newrelic.yml file at #{config_file}.&quot;</span>
        <span class="ruby-ivar">@yaml</span> = {}
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-ivar">@yaml</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load</span>(<span class="ruby-constant">ERB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">config_file</span>)).<span class="ruby-identifier">result</span>(<span class="ruby-identifier">binding</span>))
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ScriptError</span>, <span class="ruby-constant">StandardError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error reading newrelic.yml file: #{e}&quot;</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Class methods</h3>

      <div id="method-M000451" class="method-detail">
        <a name="M000451"></a>

        <div class="method-heading">
          <a href="#M000451" class="method-signature">
          <span class="method-name">new_instance</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create the concrete class for environment specific behavior:
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000451-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000451-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 443</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_instance</span>
      <span class="ruby-ivar">@local_env</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">LocalEnvironment</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">framework</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:test</span>
        <span class="ruby-identifier">require</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">newrelic_root</span>, <span class="ruby-value str">&quot;test&quot;</span>, <span class="ruby-value str">&quot;config&quot;</span>, <span class="ruby-value str">&quot;test_control.rb&quot;</span>)
        <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@local_env</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-identifier">require</span> <span class="ruby-node">&quot;new_relic/control/#{@local_env.framework}.rb&quot;</span>
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">LoadError</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">framework</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">capitalize</span>).<span class="ruby-identifier">new</span> <span class="ruby-ivar">@local_env</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000453" class="method-detail">
        <a name="M000453"></a>

        <div class="method-heading">
          <a href="#M000453" class="method-signature">
          <span class="method-name">newrelic_root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The root directory for the plugin or gem
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000453-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000453-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 478</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">newrelic_root</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>),<span class="ruby-value str">&quot;..&quot;</span>,<span class="ruby-value str">&quot;..&quot;</span>))
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000409" class="method-detail">
        <a name="M000409"></a>

        <div class="method-heading">
          <a href="#M000409" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000409-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000409-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 121</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)
      <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000411" class="method-detail">
        <a name="M000411"></a>

        <div class="method-heading">
          <a href="#M000411" class="method-signature">
          <span class="method-name">[]=</span><span class="method-args">(key, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000411-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000411-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 142</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
      <span class="ruby-identifier">settings</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000441" class="method-detail">
        <a name="M000441"></a>

        <div class="method-heading">
          <a href="#M000441" class="method-signature">
          <span class="method-name">add_instrumentation</span><span class="method-args">(pattern)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add instrumentation. Don&#8216;t call this directly. Use <a
href="Agent.html#M000112">NewRelic::Agent#add_instrumentation</a>. This
will load the file synchronously if we&#8216;ve already loaded the default
instrumentation.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000441-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000441-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 319</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_instrumentation</span> <span class="ruby-identifier">pattern</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@instrumented</span>
        <span class="ruby-identifier">load_instrumentation_files</span> <span class="ruby-identifier">pattern</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-ivar">@instrumentation_files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">pattern</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000422" class="method-detail">
        <a name="M000422"></a>

        <div class="method-heading">
          <a href="#M000422" class="method-signature">
          <span class="method-name">agent_enabled?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if dev mode or monitor mode are enabled, and we are running inside a
valid <a href="Control.html#M000426">dispatcher</a> like mongrel or
passenger. Can be overridden by NEWRELIC_ENABLE env variable,
monitor_daemons config option when true, or agent_enabled config option
when true or false.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000422-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000422-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 192</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_enabled?</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">developer_mode?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">monitor_mode?</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'agent_enabled'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true|on|yes/i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'agent_enabled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'agent_enabled'</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">'auto'</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NEWRELIC_ENABLE'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/false|off|no/i</span> 
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'monitor_daemons'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true|on|yes/i</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NEWRELIC_ENABLE'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/true|on|yes/i</span>
      <span class="ruby-comment cmt"># When in 'auto' mode the agent is enabled if there is a known</span>
      <span class="ruby-comment cmt"># dispatcher running</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000414" class="method-detail">
        <a name="M000414"></a>

        <div class="method-heading">
          <a href="#M000414" class="method-signature">
          <span class="method-name">apdex_t</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Agent.html">Agent</a> config conveniences
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000414-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000414-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 159</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">apdex_t</span>
      <span class="ruby-comment cmt"># Always initialized with a default</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'apdex_t'</span>).<span class="ruby-identifier">to_f</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000433" class="method-detail">
        <a name="M000433"></a>

        <div class="method-heading">
          <a href="#M000433" class="method-signature">
          <span class="method-name">api_server</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000433-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000433-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 237</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">api_server</span>
      <span class="ruby-identifier">api_host</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'api_host'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'rpm.newrelic.com'</span> 
      <span class="ruby-ivar">@api_server</span> <span class="ruby-operator">||=</span> 
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Server</span>.<span class="ruby-identifier">new</span> \
      <span class="ruby-identifier">api_host</span>, 
       (<span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'api_port'</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'port'</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">use_ssl?</span> <span class="ruby-value">? </span><span class="ruby-value">443</span> <span class="ruby-operator">:</span> <span class="ruby-value">80</span>)).<span class="ruby-identifier">to_i</span>, 
      <span class="ruby-keyword kw">nil</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000423" class="method-detail">
        <a name="M000423"></a>

        <div class="method-heading">
          <a href="#M000423" class="method-signature">
          <span class="method-name">app</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000423-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000423-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 203</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">app</span>
      <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">framework</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000427" class="method-detail">
        <a name="M000427"></a>

        <div class="method-heading">
          <a href="#M000427" class="method-signature">
          <span class="method-name">app_names</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000427-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000427-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 214</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">app_names</span>
      <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'app_name'</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'app_name'</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">';'</span>) <span class="ruby-operator">:</span> []
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000413" class="method-detail">
        <a name="M000413"></a>

        <div class="method-heading">
          <a href="#M000413" class="method-signature">
          <span class="method-name">append_environment_info</span><span class="method-args">(name, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add your own environment value to track for change detection. The name and
value should be stable and not vary across <a
href="Control.html#M000423">app</a> processes on the same host.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000413-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000413-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 152</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_environment_info</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
      <span class="ruby-identifier">local_env</span>.<span class="ruby-identifier">record_environment_info</span>(<span class="ruby-identifier">name</span>,<span class="ruby-identifier">value</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000416" class="method-detail">
        <a name="M000416"></a>

        <div class="method-heading">
          <a href="#M000416" class="method-signature">
          <span class="method-name">capture_params</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000416-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000416-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 166</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">capture_params</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'capture_params'</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000418" class="method-detail">
        <a name="M000418"></a>

        <div class="method-heading">
          <a href="#M000418" class="method-signature">
          <span class="method-name">developer_mode?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if we are capturing data and displaying in /newrelic
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000418-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000418-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 174</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">developer_mode?</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'developer_mode'</span>, <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'developer'</span>))
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000426" class="method-detail">
        <a name="M000426"></a>

        <div class="method-heading">
          <a href="#M000426" class="method-signature">
          <span class="method-name">dispatcher</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000426-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000426-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 211</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dispatcher</span>
      (<span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'dispatcher'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'dispatcher'</span>].<span class="ruby-identifier">to_sym</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000425" class="method-detail">
        <a name="M000425"></a>

        <div class="method-heading">
          <a href="#M000425" class="method-signature">
          <span class="method-name">dispatcher_instance_id</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000425-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000425-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 208</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dispatcher_instance_id</span>
      <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'dispatcher_instance_id'</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher_instance_id</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000412" class="method-detail">
        <a name="M000412"></a>

        <div class="method-heading">
          <a href="#M000412" class="method-signature">
          <span class="method-name">fetch</span><span class="method-args">(key, default=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000412-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000412-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 146</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>=<span class="ruby-keyword kw">nil</span>)
      <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000424" class="method-detail">
        <a name="M000424"></a>

        <div class="method-heading">
          <span class="method-name">framework</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Control.html#M000423">app</a>
</p>
        </div>
      </div>

      <div id="method-M000436" class="method-detail">
        <a name="M000436"></a>

        <div class="method-heading">
          <a href="#M000436" class="method-signature">
          <span class="method-name">http_connection</span><span class="method-args">(host = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return the Net::HTTP with proxy configuration given the
NewRelic::Control::Server object. Default is the collector but for api
calls you need to pass <a href="Control.html#M000433">api_server</a>
</p>
<p>
Experimental support for SSL verification: swap &#8216;VERIFY_NONE&#8217;
for &#8216;VERIFY_PEER&#8217; line to try it out If verification fails,
uncomment the &#8216;http.ca_file&#8217; line and it will use the included
certificate.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000436-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000436-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 265</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">http_connection</span>(<span class="ruby-identifier">host</span> = <span class="ruby-keyword kw">nil</span>)
      <span class="ruby-identifier">host</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">server</span>
      <span class="ruby-comment cmt"># Proxy returns regular HTTP if @proxy_host is nil (the default)</span>
      <span class="ruby-identifier">http_class</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Proxy</span>(<span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">port</span>, 
                                    <span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">user</span>, <span class="ruby-identifier">proxy_server</span>.<span class="ruby-identifier">password</span>)
      <span class="ruby-identifier">http</span> = <span class="ruby-identifier">http_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">host</span>.<span class="ruby-identifier">ip</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">host</span>.<span class="ruby-identifier">port</span>)
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Http Connection opened to #{host.ip||host.name}:#{host.port}&quot;</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">use_ssl?</span>
        <span class="ruby-identifier">http</span>.<span class="ruby-identifier">use_ssl</span> = <span class="ruby-keyword kw">true</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">verify_certificate?</span>
          <span class="ruby-identifier">http</span>.<span class="ruby-identifier">verify_mode</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_PEER</span>
          <span class="ruby-identifier">http</span>.<span class="ruby-identifier">ca_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>), <span class="ruby-value str">'..'</span>, <span class="ruby-value str">'..'</span>, <span class="ruby-value str">'cert'</span>, <span class="ruby-value str">'cacert.pem'</span>)
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">http</span>.<span class="ruby-identifier">verify_mode</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_NONE</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">http</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000407" class="method-detail">
        <a name="M000407"></a>

        <div class="method-heading">
          <a href="#M000407" class="method-signature">
          <span class="method-name">init_plugin</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initialize the plugin/gem and start the agent. This does the necessary
configuration based on the <a href="Control.html#M000424">framework</a>
environment and determines whether or not to start the agent. If the agent
is not going to be started then it loads the agent shim which has stubs for
all the external api.
</p>
<p>
This may be invoked multiple times, as long as you don&#8216;t attempt to
uninstall the agent after it has been started.
</p>
<p>
If the plugin is initialized and it determines that the agent is not
enabled, it will skip starting it and install the shim. But if you later
call this with <tt>:agent_enabled =&gt; true</tt>, then it will install the
real agent and start it.
</p>
<p>
What determines whether the agent is launched is the result of calling <a
href="Control.html#M000422">agent_enabled?</a> This will indicate whether
the instrumentation should/will be installed. If we&#8216;re in a mode
where tracers are not installed then we should not start the agent.
</p>
<p>
Subclasses are not allowed to override, but must implement init_config({})
which is called at most once.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000407-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000407-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 76</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_plugin</span>(<span class="ruby-identifier">options</span>={})
      <span class="ruby-identifier">options</span>[<span class="ruby-value str">'app_name'</span>] = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NEWRELIC_APP_NAME'</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NEWRELIC_APP_NAME'</span>]
 
      <span class="ruby-identifier">require</span> <span class="ruby-value str">'new_relic/agent'</span>
      <span class="ruby-comment cmt"># Merge the stringified options into the config as overrides:</span>
      <span class="ruby-identifier">logger_override</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:log</span>)
      <span class="ruby-identifier">environment_name</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:env</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">env</span> = <span class="ruby-identifier">environment_name</span>
      <span class="ruby-identifier">dispatcher</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:dispatcher</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher</span> = <span class="ruby-identifier">dispatcher</span> 
      <span class="ruby-identifier">dispatcher_instance_id</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:dispatcher_instance_id</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher_instance_id</span> = <span class="ruby-identifier">dispatcher_instance_id</span>

      <span class="ruby-comment cmt"># Clear out the settings, if they've already been loaded.  It may be that</span>
      <span class="ruby-comment cmt"># between calling init_plugin the first time and the second time, the env</span>
      <span class="ruby-comment cmt"># has been overridden</span>
      <span class="ruby-ivar">@settings</span> = <span class="ruby-keyword kw">nil</span>
      
      <span class="ruby-identifier">options</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>, <span class="ruby-identifier">val</span> <span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">sym</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">val</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:config</span> }
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger_override</span>
        <span class="ruby-ivar">@log</span> = <span class="ruby-identifier">logger_override</span>
        <span class="ruby-comment cmt"># Try to grab the log filename</span>
        <span class="ruby-ivar">@log_file</span> = <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-ivar">@logdev</span>.<span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span> }
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-comment cmt"># An artifact of earlier implementation, we put both #add_method_tracer and #trace_execution</span>
      <span class="ruby-comment cmt"># methods in the module methods.</span>
      <span class="ruby-constant">Module</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:include</span>, <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">MethodTracer</span><span class="ruby-operator">::</span><span class="ruby-constant">ClassMethods</span>
      <span class="ruby-constant">Module</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">:include</span>, <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">MethodTracer</span><span class="ruby-operator">::</span><span class="ruby-constant">InstanceMethods</span>
      <span class="ruby-identifier">init_config</span>(<span class="ruby-identifier">options</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agent_enabled?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@started</span>
        <span class="ruby-identifier">setup_log</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">logger_override</span>
        <span class="ruby-identifier">start_agent</span>
        <span class="ruby-identifier">install_instrumentation</span>
        <span class="ruby-identifier">load_samplers</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'disable_samplers'</span>]
        <span class="ruby-identifier">local_env</span>.<span class="ruby-identifier">gather_environment_info</span>
        <span class="ruby-identifier">append_environment_info</span>
        <span class="ruby-ivar">@started</span> = <span class="ruby-keyword kw">true</span>
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">agent_enabled?</span>
        <span class="ruby-identifier">install_shim</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000442" class="method-detail">
        <a name="M000442"></a>

        <div class="method-heading">
          <a href="#M000442" class="method-signature">
          <span class="method-name">install_instrumentation</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000442-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000442-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 326</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_instrumentation</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@instrumented</span>
      
      <span class="ruby-ivar">@instrumented</span> = <span class="ruby-keyword kw">true</span>
      
      <span class="ruby-comment cmt"># Instrumentation for the key code points inside rails for monitoring by NewRelic.</span>
      <span class="ruby-comment cmt"># note this file is loaded only if the newrelic agent is enabled (through config/newrelic.yml)</span>
      <span class="ruby-identifier">instrumentation_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>), <span class="ruby-value str">'agent'</span>,<span class="ruby-value str">'instrumentation'</span>)
      <span class="ruby-ivar">@instrumentation_files</span> <span class="ruby-operator">&lt;&lt;</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">instrumentation_path</span>, <span class="ruby-value str">'*.rb'</span>) <span class="ruby-operator">&lt;&lt;</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">instrumentation_path</span>, <span class="ruby-identifier">app</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-value str">'*.rb'</span>)
      <span class="ruby-ivar">@instrumentation_files</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">pattern</span> <span class="ruby-operator">|</span>  <span class="ruby-identifier">load_instrumentation_files</span> <span class="ruby-identifier">pattern</span> }
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Finished instrumentation&quot;</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000440" class="method-detail">
        <a name="M000440"></a>

        <div class="method-heading">
          <a href="#M000440" class="method-signature">
          <span class="method-name">install_shim</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Install stubs to the proper location so the <a
href="Control.html#M000423">app</a> code will not fail if the agent is not
running.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000440-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000440-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 309</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">install_shim</span>
      <span class="ruby-comment cmt"># Once we install instrumentation, you can't undo that by installing the shim.</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Cannot install the Agent shim after instrumentation has already been installed!&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@instrumented</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">ShimAgent</span>.<span class="ruby-identifier">instance</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000415" class="method-detail">
        <a name="M000415"></a>

        <div class="method-heading">
          <a href="#M000415" class="method-signature">
          <span class="method-name">license_key</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000415-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000415-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 163</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">license_key</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'license_key'</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000443" class="method-detail">
        <a name="M000443"></a>

        <div class="method-heading">
          <a href="#M000443" class="method-signature">
          <span class="method-name">load_samplers</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000443-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000443-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 341</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_samplers</span>
      <span class="ruby-identifier">agent</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Sampler</span>.<span class="ruby-identifier">sampler_classes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">subclass</span> <span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;#{subclass.name} not supported on this platform.&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">supported_on_this_platform?</span>
          <span class="ruby-identifier">sampler</span> = <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">new</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">use_harvest_sampler?</span>
            <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">add_harvest_sampler</span> <span class="ruby-identifier">sampler</span>
            <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Registered #{subclass.name} for harvest time sampling&quot;</span>
          <span class="ruby-keyword kw">else</span>            
            <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">add_sampler</span> <span class="ruby-identifier">sampler</span>
            <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Registered #{subclass.name} for periodic sampling&quot;</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Sampler</span><span class="ruby-operator">::</span><span class="ruby-constant">Unsupported</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;#{subclass} sampler not available: #{e}&quot;</span>
        <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error registering sampler: #{e}, #{e.backtrace.join(&quot;\n&quot;)}&quot;</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000438" class="method-detail">
        <a name="M000438"></a>

        <div class="method-heading">
          <a href="#M000438" class="method-signature">
          <span class="method-name">log</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000438-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000438-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 287</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log</span>
      <span class="ruby-comment cmt"># If we try to get a log before one has been set up, return a stdout log</span>
      <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@log</span>
        <span class="ruby-identifier">l</span> = <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">STDOUT</span>)
        <span class="ruby-identifier">l</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">INFO</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">l</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-ivar">@log</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000439" class="method-detail">
        <a name="M000439"></a>

        <div class="method-heading">
          <a href="#M000439" class="method-signature">
          <span class="method-name">log!</span><span class="method-args">(msg, level=:info)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
send the given message to STDOUT so that it shows up in the console. This
should be used for important informational messages at boot. The <a
href="Control.html#M000448">to_stdout</a> may be implemented differently by
different config subclasses. This will NOT print anything if tracers are
not enabled
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000439-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000439-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 301</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log!</span>(<span class="ruby-identifier">msg</span>, <span class="ruby-identifier">level</span>=<span class="ruby-identifier">:info</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@settings</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">agent_enabled?</span>
      <span class="ruby-identifier">to_stdout</span> <span class="ruby-identifier">msg</span>
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">level</span>, <span class="ruby-identifier">msg</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@log</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000417" class="method-detail">
        <a name="M000417"></a>

        <div class="method-heading">
          <a href="#M000417" class="method-signature">
          <span class="method-name">monitor_mode?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if we are sending data to the <a
href="Control.html#M000432">server</a>, monitoring production
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000417-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000417-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 170</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">monitor_mode?</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'monitor_mode'</span>, <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'enabled'</span>))
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000419" class="method-detail">
        <a name="M000419"></a>

        <div class="method-heading">
          <a href="#M000419" class="method-signature">
          <span class="method-name">multi_threaded?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if the <a href="Control.html#M000423">app</a> runs in multi-threaded
mode
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000419-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000419-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 178</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">multi_threaded?</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'multi_threaded'</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000421" class="method-detail">
        <a name="M000421"></a>

        <div class="method-heading">
          <a href="#M000421" class="method-signature">
          <span class="method-name">post_size_limit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000421-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000421-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 185</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_size_limit</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'post_size_limit'</span>, <span class="ruby-value">2</span> <span class="ruby-operator">*</span> <span class="ruby-value">1024</span> <span class="ruby-operator">*</span> <span class="ruby-value">1024</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000405" class="method-detail">
        <a name="M000405"></a>

        <div class="method-heading">
          <a href="#M000405" class="method-signature">
          <span class="method-name">profiling=</span><span class="method-args">(val)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set the flag for capturing profiles in dev mode. If RubyProf is not loaded
a true value is ignored.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000405-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000405-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 34</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">profiling=</span>(<span class="ruby-identifier">val</span>)
      <span class="ruby-ivar">@profiling</span> = <span class="ruby-identifier">profiling_available?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">RubyProf</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000403" class="method-detail">
        <a name="M000403"></a>

        <div class="method-heading">
          <a href="#M000403" class="method-signature">
          <span class="method-name">profiling?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A flag used in dev mode to indicate if profiling is available
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000403-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000403-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 21</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">profiling?</span>
      <span class="ruby-ivar">@profiling</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000404" class="method-detail">
        <a name="M000404"></a>

        <div class="method-heading">
          <a href="#M000404" class="method-signature">
          <span class="method-name">profiling_available?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000404-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000404-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 25</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">profiling_available?</span>
      <span class="ruby-ivar">@profiling_available</span> <span class="ruby-operator">||=</span> 
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-identifier">require</span> <span class="ruby-value str">'ruby-prof'</span>
        <span class="ruby-keyword kw">true</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">LoadError</span>; <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000434" class="method-detail">
        <a name="M000434"></a>

        <div class="method-heading">
          <a href="#M000434" class="method-signature">
          <span class="method-name">proxy_server</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000434-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000434-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 246</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">proxy_server</span>
      <span class="ruby-ivar">@proxy_server</span> <span class="ruby-operator">||=</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">ProxyServer</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_host'</span>], <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_port'</span>], <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_user'</span>], <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'proxy_pass'</span>] 
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000432" class="method-detail">
        <a name="M000432"></a>

        <div class="method-heading">
          <a href="#M000432" class="method-signature">
          <span class="method-name">server</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000432-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000432-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 233</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">server</span>
      <span class="ruby-ivar">@remote_server</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">server_from_host</span>(<span class="ruby-keyword kw">nil</span>)  
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000435" class="method-detail">
        <a name="M000435"></a>

        <div class="method-heading">
          <a href="#M000435" class="method-signature">
          <span class="method-name">server_from_host</span><span class="method-args">(hostname=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000435-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000435-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 251</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">server_from_host</span>(<span class="ruby-identifier">hostname</span>=<span class="ruby-keyword kw">nil</span>)
      <span class="ruby-identifier">host</span> = <span class="ruby-identifier">hostname</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'host'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'collector.newrelic.com'</span>
      
      <span class="ruby-comment cmt"># if the host is not an IP address, turn it into one</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span><span class="ruby-operator">::</span><span class="ruby-constant">Server</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">host</span>, (<span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'port'</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">use_ssl?</span> <span class="ruby-value">? </span><span class="ruby-value">443</span> <span class="ruby-operator">:</span> <span class="ruby-value">80</span>)).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">convert_to_ip_address</span>(<span class="ruby-identifier">host</span>) 
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000410" class="method-detail">
        <a name="M000410"></a>

        <div class="method-heading">
          <a href="#M000410" class="method-signature">
          <span class="method-name">settings</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000410-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000410-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 125</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">settings</span>
      <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@settings</span>
        <span class="ruby-ivar">@settings</span> = (<span class="ruby-ivar">@yaml</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">merge_defaults</span>(<span class="ruby-ivar">@yaml</span>[<span class="ruby-identifier">env</span>])) <span class="ruby-operator">||</span> {}
        <span class="ruby-comment cmt"># At the time we bind the settings, we also need to run this little piece</span>
        <span class="ruby-comment cmt"># of magic which allows someone to augment the id with the app name, necessary</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'multi_homed'</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">app_names</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher_instance_id</span>
            <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher_instance_id</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;:#{app_names.first}&quot;</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-ivar">@local_env</span>.<span class="ruby-identifier">dispatcher_instance_id</span> = <span class="ruby-identifier">app_names</span>.<span class="ruby-identifier">first</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-ivar">@settings</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000408" class="method-detail">
        <a name="M000408"></a>

        <div class="method-heading">
          <a href="#M000408" class="method-signature">
          <span class="method-name">start_agent</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Install the real agent into the <a href="Agent.html">Agent</a> module, and
issue the start command.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000408-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000408-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 116</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_agent</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">instance</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span>.<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">start</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000437" class="method-detail">
        <a name="M000437"></a>

        <div class="method-heading">
          <a href="#M000437" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000437-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000437-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 283</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
      <span class="ruby-node">&quot;Control[#{self.app}]&quot;</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000430" class="method-detail">
        <a name="M000430"></a>

        <div class="method-heading">
          <a href="#M000430" class="method-signature">
          <span class="method-name">use_ssl?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000430-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000430-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 224</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use_ssl?</span>
      <span class="ruby-ivar">@use_ssl</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'ssl'</span>, <span class="ruby-keyword kw">false</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000420" class="method-detail">
        <a name="M000420"></a>

        <div class="method-heading">
          <a href="#M000420" class="method-signature">
          <span class="method-name">use_textmate?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
True if we should view files in textmate
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000420-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000420-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 182</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">use_textmate?</span>
      <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'textmate'</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000428" class="method-detail">
        <a name="M000428"></a>

        <div class="method-heading">
          <a href="#M000428" class="method-signature">
          <span class="method-name">validate_seed</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000428-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000428-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 217</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate_seed</span>
      <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'validate_seed'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NR_VALIDATE_SEED'</span>]   
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000429" class="method-detail">
        <a name="M000429"></a>

        <div class="method-heading">
          <a href="#M000429" class="method-signature">
          <span class="method-name">validate_token</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000429-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000429-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 220</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate_token</span>
      <span class="ruby-keyword kw">self</span>[<span class="ruby-value str">'validate_token'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'NR_VALIDATE_TOKEN'</span>]
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000431" class="method-detail">
        <a name="M000431"></a>

        <div class="method-heading">
          <a href="#M000431" class="method-signature">
          <span class="method-name">verify_certificate?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000431-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000431-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 228</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verify_certificate?</span>
      <span class="ruby-comment cmt">#this can only be on when SSL is enabled</span>
      <span class="ruby-ivar">@verify_certificate</span> <span class="ruby-operator">||=</span> ( <span class="ruby-identifier">use_ssl?</span> <span class="ruby-value">? </span><span class="ruby-identifier">fetch</span>(<span class="ruby-value str">'verify_certificate'</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000444" class="method-detail">
        <a name="M000444"></a>

        <div class="method-heading">
          <a href="#M000444" class="method-signature">
          <span class="method-name">append_environment_info</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Append <a href="Control.html#M000424">framework</a> specific environment
information for uploading to the <a href="Control.html#M000432">server</a>
for change detection. Override in subclasses
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000444-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000444-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 366</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_environment_info</span>; <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000449" class="method-detail">
        <a name="M000449"></a>

        <div class="method-heading">
          <a href="#M000449" class="method-signature">
          <span class="method-name">config_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000449-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000449-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 430</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">config_file</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">&quot;config&quot;</span>,<span class="ruby-value str">&quot;newrelic.yml&quot;</span>))
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000445" class="method-detail">
        <a name="M000445"></a>

        <div class="method-heading">
          <a href="#M000445" class="method-signature">
          <span class="method-name">convert_to_ip_address</span><span class="method-args">(host)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Look up the ip address of the host using the pure ruby lookup to prevent
blocking. If that fails, fall back to the regular IPSocket library. Return
nil if we can&#8216;t find the host ip address and don&#8216;t have a good
default.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000445-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000445-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 372</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert_to_ip_address</span>(<span class="ruby-identifier">host</span>)
      <span class="ruby-comment cmt"># here we leave it as a host name since the cert verification</span>
      <span class="ruby-comment cmt"># needs it in host form</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">host</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">verify_certificate?</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;localhost&quot;</span>
      <span class="ruby-comment cmt"># Fall back to known ip address in the common case</span>
      <span class="ruby-identifier">ip_address</span> = <span class="ruby-value str">'65.74.177.195'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">host</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'collector.newrelic.com'</span>
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-identifier">ip_address</span> = <span class="ruby-constant">Resolv</span>.<span class="ruby-identifier">getaddress</span>(<span class="ruby-identifier">host</span>)
        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Resolved #{host} to #{ip_address}&quot;</span>
      <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;DNS Error caching IP address: #{e}&quot;</span>
        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n   &quot;</span>)
        <span class="ruby-identifier">ip_address</span> = <span class="ruby-constant">IPSocket</span><span class="ruby-operator">::</span><span class="ruby-identifier">getaddress</span> <span class="ruby-identifier">host</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">ip_address</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">ip_address</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000455" class="method-detail">
        <a name="M000455"></a>

        <div class="method-heading">
          <a href="#M000455" class="method-signature">
          <span class="method-name">load_instrumentation_files</span><span class="method-args">(pattern)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000455-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000455-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 485</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_instrumentation_files</span> <span class="ruby-identifier">pattern</span>
      <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">pattern</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Processing instrumentation file '#{file}'&quot;</span>
          <span class="ruby-identifier">require</span> <span class="ruby-identifier">file</span>
        <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;Error loading instrumentation file '#{file}': #{e}&quot;</span>
          <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000450" class="method-detail">
        <a name="M000450"></a>

        <div class="method-heading">
          <a href="#M000450" class="method-signature">
          <span class="method-name">log_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000450-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000450-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 434</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log_path</span>
      <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">root</span>,<span class="ruby-value str">'log'</span>)
      <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">path</span>
        <span class="ruby-identifier">path</span> = <span class="ruby-value str">'.'</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000446" class="method-detail">
        <a name="M000446"></a>

        <div class="method-heading">
          <a href="#M000446" class="method-signature">
          <span class="method-name">merge_defaults</span><span class="method-args">(settings_hash)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000446-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000446-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 390</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">merge_defaults</span>(<span class="ruby-identifier">settings_hash</span>)
      <span class="ruby-identifier">s</span> = {
        <span class="ruby-value str">'host'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'collector.newrelic.com'</span>,
        <span class="ruby-value str">'ssl'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
        <span class="ruby-value str">'log_level'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'info'</span>,
        <span class="ruby-value str">'apdex_t'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1.0</span>
      }
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">settings_hash</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">settings_hash</span>
      <span class="ruby-comment cmt"># monitor_daemons replaced with agent_enabled</span>
      <span class="ruby-identifier">s</span>[<span class="ruby-value str">'agent_enabled'</span>] = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'monitor_daemons'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span>[<span class="ruby-value str">'agent_enabled'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'monitor_daemons'</span>)
      <span class="ruby-identifier">s</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000454" class="method-detail">
        <a name="M000454"></a>

        <div class="method-heading">
          <a href="#M000454" class="method-signature">
          <span class="method-name">newrelic_root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000454-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000454-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 481</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">newrelic_root</span>
      <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">newrelic_root</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000447" class="method-detail">
        <a name="M000447"></a>

        <div class="method-heading">
          <a href="#M000447" class="method-signature">
          <span class="method-name">setup_log</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Control.html">Control</a> subclasses may override this, but it can
be called multiple times.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000447-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000447-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 404</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_log</span>
      <span class="ruby-ivar">@log_file</span> = <span class="ruby-node">&quot;#{log_path}/newrelic_agent.log&quot;</span>
      <span class="ruby-ivar">@log</span> = <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@log_file</span>
      
      <span class="ruby-comment cmt"># change the format just for our logger</span>
      
      <span class="ruby-keyword kw">def</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">format_message</span>(<span class="ruby-identifier">severity</span>, <span class="ruby-identifier">timestamp</span>, <span class="ruby-identifier">progname</span>, <span class="ruby-identifier">msg</span>)
        <span class="ruby-node">&quot;[#{timestamp.strftime(&quot;%m/%d/%y %H:%M:%S %z&quot;)} #{Socket.gethostname} (#{$$})] #{severity} : #{msg}\n&quot;</span> 
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-comment cmt"># set the log level as specified in the config file</span>
      <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-value str">&quot;log_level&quot;</span>,<span class="ruby-value str">&quot;info&quot;</span>).<span class="ruby-identifier">downcase</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;debug&quot;</span> <span class="ruby-keyword kw">then</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">DEBUG</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;info&quot;</span> <span class="ruby-keyword kw">then</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">INFO</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;warn&quot;</span> <span class="ruby-keyword kw">then</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">WARN</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;error&quot;</span> <span class="ruby-keyword kw">then</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">ERROR</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;fatal&quot;</span> <span class="ruby-keyword kw">then</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">FATAL</span>
      <span class="ruby-keyword kw">else</span> <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">level</span> = <span class="ruby-constant">Logger</span><span class="ruby-operator">::</span><span class="ruby-constant">INFO</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-ivar">@log</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000448" class="method-detail">
        <a name="M000448"></a>

        <div class="method-heading">
          <a href="#M000448" class="method-signature">
          <span class="method-name">to_stdout</span><span class="method-args">(msg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000448-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000448-source">
<pre>
<span class="ruby-comment cmt"># File lib/new_relic/control.rb, line 426</span>
    <span class="ruby-keyword kw">def</span>  <span class="ruby-identifier">to_stdout</span><span class="ruby-identifier">to_stdout</span>(<span class="ruby-identifier">msg</span>)
      <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;** [NewRelic] &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">msg</span> 
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>