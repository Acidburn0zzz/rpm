<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>Module: NewRelic::Agent::Database</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/new_relic/agent/database.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-close_connections">#close_connections</a>
    
    <li><a href="#method-i-config">#config</a>
    
    <li><a href="#method-i-config-3D">#config=</a>
    
    <li><a href="#method-i-explain_sql">#explain_sql</a>
    
    <li><a href="#method-i-explain_statement">#explain_statement</a>
    
    <li><a href="#method-i-get_connection">#get_connection</a>
    
    <li><a href="#method-i-handle_exception_in_explain">#handle_exception_in_explain</a>
    
    <li><a href="#method-i-is_select-3F">#is_select?</a>
    
    <li><a href="#method-i-obfuscate_sql">#obfuscate_sql</a>
    
    <li><a href="#method-i-process_resultset">#process_resultset</a>
    
    <li><a href="#method-i-set_sql_obfuscator">#set_sql_obfuscator</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../../CHANGELOG.html">CHANGELOG</a>
  
    <li class="file"><a href="../../LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../../README_rdoc.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../NewRelic.html">NewRelic</a>
  
    <li><a href="../../NewRelic/Agent.html">NewRelic::Agent</a>
  
    <li><a href="../../NewRelic/Agent/Agent.html">NewRelic::Agent::Agent</a>
  
    <li><a href="../../NewRelic/Agent/Agent/ClassMethods.html">NewRelic::Agent::Agent::ClassMethods</a>
  
    <li><a href="../../NewRelic/Agent/Agent/InstanceMethods.html">NewRelic::Agent::Agent::InstanceMethods</a>
  
    <li><a href="../../NewRelic/Agent/Agent/InstanceMethods/Connect.html">NewRelic::Agent::Agent::InstanceMethods::Connect</a>
  
    <li><a href="../../NewRelic/Agent/Agent/InstanceMethods/Start.html">NewRelic::Agent::Agent::InstanceMethods::Start</a>
  
    <li><a href="../../NewRelic/Agent/Agent/InstanceMethods/StartWorkerThread.html">NewRelic::Agent::Agent::InstanceMethods::StartWorkerThread</a>
  
    <li><a href="../../NewRelic/Agent/BackgroundLoadingError.html">NewRelic::Agent::BackgroundLoadingError</a>
  
    <li><a href="../../NewRelic/Agent/BeaconConfiguration.html">NewRelic::Agent::BeaconConfiguration</a>
  
    <li><a href="../../NewRelic/Agent/BrowserMonitoring.html">NewRelic::Agent::BrowserMonitoring</a>
  
    <li><a href="../../NewRelic/Agent/BrowserMonitoring/DummyMetricFrame.html">NewRelic::Agent::BrowserMonitoring::DummyMetricFrame</a>
  
    <li><a href="../../NewRelic/Agent/BusyCalculator.html">NewRelic::Agent::BusyCalculator</a>
  
    <li><a href="../../NewRelic/Agent/Database.html">NewRelic::Agent::Database</a>
  
    <li><a href="../../NewRelic/Agent/Database/ConnectionManager.html">NewRelic::Agent::Database::ConnectionManager</a>
  
    <li><a href="../../NewRelic/Agent/Database/Obfuscator.html">NewRelic::Agent::Database::Obfuscator</a>
  
    <li><a href="../../NewRelic/Agent/ErrorCollector.html">NewRelic::Agent::ErrorCollector</a>
  
    <li><a href="../../NewRelic/Agent/ErrorCollector/NoticeError.html">NewRelic::Agent::ErrorCollector::NoticeError</a>
  
    <li><a href="../../NewRelic/Agent/ForceDisconnectException.html">NewRelic::Agent::ForceDisconnectException</a>
  
    <li><a href="../../NewRelic/Agent/ForceRestartException.html">NewRelic::Agent::ForceRestartException</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation.html">NewRelic::Agent::Instrumentation</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/ActiveRecordInstrumentation.html">NewRelic::Agent::Instrumentation::ActiveRecordInstrumentation</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/ControllerInstrumentation.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/ControllerInstrumentation/ClassMethods.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation::ClassMethods</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/DataMapperInstrumentation.html">NewRelic::Agent::Instrumentation::DataMapperInstrumentation</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Memcache.html">NewRelic::Agent::Instrumentation::Memcache</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/MetricFrame.html">NewRelic::Agent::Instrumentation::MetricFrame</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/MetricFrame/Pop.html">NewRelic::Agent::Instrumentation::MetricFrame::Pop</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/QueueTime.html">NewRelic::Agent::Instrumentation::QueueTime</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Rack.html">NewRelic::Agent::Instrumentation::Rack</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Rails3.html">NewRelic::Agent::Instrumentation::Rails3</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Rails3/ActionController.html">NewRelic::Agent::Instrumentation::Rails3::ActionController</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Rails3/ActionView.html">NewRelic::Agent::Instrumentation::Rails3::ActionView</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Rails3/ActionView/PartialRenderer.html">NewRelic::Agent::Instrumentation::Rails3::ActionView::PartialRenderer</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Rails3/Errors.html">NewRelic::Agent::Instrumentation::Rails3::Errors</a>
  
    <li><a href="../../NewRelic/Agent/Instrumentation/Sinatra.html">NewRelic::Agent::Instrumentation::Sinatra</a>
  
    <li><a href="../../NewRelic/Agent/LicenseException.html">NewRelic::Agent::LicenseException</a>
  
    <li><a href="../../NewRelic/Agent/MethodTracer.html">NewRelic::Agent::MethodTracer</a>
  
    <li><a href="../../NewRelic/Agent/MethodTracer/ClassMethods.html">NewRelic::Agent::MethodTracer::ClassMethods</a>
  
    <li><a href="../../NewRelic/Agent/MethodTracer/ClassMethods/AddMethodTracer.html">NewRelic::Agent::MethodTracer::ClassMethods::AddMethodTracer</a>
  
    <li><a href="../../NewRelic/Agent/MethodTracer/InstanceMethods.html">NewRelic::Agent::MethodTracer::InstanceMethods</a>
  
    <li><a href="../../NewRelic/Agent/MethodTracer/InstanceMethods/TraceExecutionScoped.html">NewRelic::Agent::MethodTracer::InstanceMethods::TraceExecutionScoped</a>
  
    <li><a href="../../NewRelic/Agent/PostTooBigException.html">NewRelic::Agent::PostTooBigException</a>
  
    <li><a href="../../NewRelic/Agent/Sampler.html">NewRelic::Agent::Sampler</a>
  
    <li><a href="../../NewRelic/Agent/Sampler/Unsupported.html">NewRelic::Agent::Sampler::Unsupported</a>
  
    <li><a href="../../NewRelic/Agent/Samplers.html">NewRelic::Agent::Samplers</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/CpuSampler.html">NewRelic::Agent::Samplers::CpuSampler</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/DelayedJobLockSampler.html">NewRelic::Agent::Samplers::DelayedJobLockSampler</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/MemorySampler.html">NewRelic::Agent::Samplers::MemorySampler</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/MemorySampler/Base.html">NewRelic::Agent::Samplers::MemorySampler::Base</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/MemorySampler/JavaHeapSampler.html">NewRelic::Agent::Samplers::MemorySampler::JavaHeapSampler</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/MemorySampler/ProcStatus.html">NewRelic::Agent::Samplers::MemorySampler::ProcStatus</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/MemorySampler/ShellPS.html">NewRelic::Agent::Samplers::MemorySampler::ShellPS</a>
  
    <li><a href="../../NewRelic/Agent/Samplers/ObjectSampler.html">NewRelic::Agent::Samplers::ObjectSampler</a>
  
    <li><a href="../../NewRelic/Agent/ServerConnectionException.html">NewRelic::Agent::ServerConnectionException</a>
  
    <li><a href="../../NewRelic/Agent/ServerError.html">NewRelic::Agent::ServerError</a>
  
    <li><a href="../../NewRelic/Agent/ShimAgent.html">NewRelic::Agent::ShimAgent</a>
  
    <li><a href="../../NewRelic/Agent/SlowSql.html">NewRelic::Agent::SlowSql</a>
  
    <li><a href="../../NewRelic/Agent/SqlSampler.html">NewRelic::Agent::SqlSampler</a>
  
    <li><a href="../../NewRelic/Agent/SqlTrace.html">NewRelic::Agent::SqlTrace</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine.html">NewRelic::Agent::StatsEngine</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/GCProfiler.html">NewRelic::Agent::StatsEngine::GCProfiler</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/GCProfiler/Profiler.html">NewRelic::Agent::StatsEngine::GCProfiler::Profiler</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/GCProfiler/RailsBench.html">NewRelic::Agent::StatsEngine::GCProfiler::RailsBench</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/GCProfiler/Rubinius.html">NewRelic::Agent::StatsEngine::GCProfiler::Rubinius</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/GCProfiler/Ruby19.html">NewRelic::Agent::StatsEngine::GCProfiler::Ruby19</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/MetricStats.html">NewRelic::Agent::StatsEngine::MetricStats</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/MetricStats/Harvest.html">NewRelic::Agent::StatsEngine::MetricStats::Harvest</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/MetricStats/SynchronizedHash.html">NewRelic::Agent::StatsEngine::MetricStats::SynchronizedHash</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/Samplers.html">NewRelic::Agent::StatsEngine::Samplers</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/ScopeStackElement.html">NewRelic::Agent::StatsEngine::ScopeStackElement</a>
  
    <li><a href="../../NewRelic/Agent/StatsEngine/Transactions.html">NewRelic::Agent::StatsEngine::Transactions</a>
  
    <li><a href="../../NewRelic/Agent/TransactionInfo.html">NewRelic::Agent::TransactionInfo</a>
  
    <li><a href="../../NewRelic/Agent/TransactionSampleBuilder.html">NewRelic::Agent::TransactionSampleBuilder</a>
  
    <li><a href="../../NewRelic/Agent/TransactionSampler.html">NewRelic::Agent::TransactionSampler</a>
  
    <li><a href="../../NewRelic/Agent/TransactionSqlData.html">NewRelic::Agent::TransactionSqlData</a>
  
    <li><a href="../../NewRelic/Agent/WorkerLoop.html">NewRelic::Agent::WorkerLoop</a>
  
    <li><a href="../../NewRelic/ApdexStats.html">NewRelic::ApdexStats</a>
  
    <li><a href="../../NewRelic/BasicStats.html">NewRelic::BasicStats</a>
  
    <li><a href="../../NewRelic/ChainedCall.html">NewRelic::ChainedCall</a>
  
    <li><a href="../../NewRelic/CollectionHelper.html">NewRelic::CollectionHelper</a>
  
    <li><a href="../../NewRelic/Command.html">NewRelic::Command</a>
  
    <li><a href="../../NewRelic/Command/CommandFailure.html">NewRelic::Command::CommandFailure</a>
  
    <li><a href="../../NewRelic/Command/Deployments.html">NewRelic::Command::Deployments</a>
  
    <li><a href="../../NewRelic/Command/Install.html">NewRelic::Command::Install</a>
  
    <li><a href="../../NewRelic/Control.html">NewRelic::Control</a>
  
    <li><a href="../../NewRelic/Control/ClassMethods.html">NewRelic::Control::ClassMethods</a>
  
    <li><a href="../../NewRelic/Control/Configuration.html">NewRelic::Control::Configuration</a>
  
    <li><a href="../../NewRelic/Control/Frameworks.html">NewRelic::Control::Frameworks</a>
  
    <li><a href="../../NewRelic/Control/Frameworks/External.html">NewRelic::Control::Frameworks::External</a>
  
    <li><a href="../../NewRelic/Control/Frameworks/Merb.html">NewRelic::Control::Frameworks::Merb</a>
  
    <li><a href="../../NewRelic/Control/Frameworks/Rails.html">NewRelic::Control::Frameworks::Rails</a>
  
    <li><a href="../../NewRelic/Control/Frameworks/Rails3.html">NewRelic::Control::Frameworks::Rails3</a>
  
    <li><a href="../../NewRelic/Control/Frameworks/Ruby.html">NewRelic::Control::Frameworks::Ruby</a>
  
    <li><a href="../../NewRelic/Control/Frameworks/Sinatra.html">NewRelic::Control::Frameworks::Sinatra</a>
  
    <li><a href="../../NewRelic/Control/InstanceMethods.html">NewRelic::Control::InstanceMethods</a>
  
    <li><a href="../../NewRelic/Control/Instrumentation.html">NewRelic::Control::Instrumentation</a>
  
    <li><a href="../../NewRelic/Control/LoggingMethods.html">NewRelic::Control::LoggingMethods</a>
  
    <li><a href="../../NewRelic/Control/Profiling.html">NewRelic::Control::Profiling</a>
  
    <li><a href="../../NewRelic/Control/ServerMethods.html">NewRelic::Control::ServerMethods</a>
  
    <li><a href="../../NewRelic/DataSerialization.html">NewRelic::DataSerialization</a>
  
    <li><a href="../../NewRelic/DataSerialization/ClassMethods.html">NewRelic::DataSerialization::ClassMethods</a>
  
    <li><a href="../../NewRelic/DelayedJobInjection.html">NewRelic::DelayedJobInjection</a>
  
    <li><a href="../../NewRelic/Instrumentation.html">NewRelic::Instrumentation</a>
  
    <li><a href="../../NewRelic/Instrumentation/ActsAsSolrInstrumentation.html">NewRelic::Instrumentation::ActsAsSolrInstrumentation</a>
  
    <li><a href="../../NewRelic/Instrumentation/ActsAsSolrInstrumentation/ParserMethodsInstrumentation.html">NewRelic::Instrumentation::ActsAsSolrInstrumentation::ParserMethodsInstrumentation</a>
  
    <li><a href="../../NewRelic/LanguageSupport.html">NewRelic::LanguageSupport</a>
  
    <li><a href="../../NewRelic/LanguageSupport/Control.html">NewRelic::LanguageSupport::Control</a>
  
    <li><a href="../../NewRelic/LanguageSupport/DataSerialization.html">NewRelic::LanguageSupport::DataSerialization</a>
  
    <li><a href="../../NewRelic/LanguageSupport/SynchronizedHash.html">NewRelic::LanguageSupport::SynchronizedHash</a>
  
    <li><a href="../../NewRelic/LocalEnvironment.html">NewRelic::LocalEnvironment</a>
  
    <li><a href="../../NewRelic/MerbBootLoader.html">NewRelic::MerbBootLoader</a>
  
    <li><a href="../../NewRelic/MethodTraceStats.html">NewRelic::MethodTraceStats</a>
  
    <li><a href="../../NewRelic/MetricData.html">NewRelic::MetricData</a>
  
    <li><a href="../../NewRelic/MetricSpec.html">NewRelic::MetricSpec</a>
  
    <li><a href="../../NewRelic/Metrics.html">NewRelic::Metrics</a>
  
    <li><a href="../../NewRelic/NoticedError.html">NewRelic::NoticedError</a>
  
    <li><a href="../../NewRelic/Rack.html">NewRelic::Rack</a>
  
    <li><a href="../../NewRelic/Rack/BrowserMonitoring.html">NewRelic::Rack::BrowserMonitoring</a>
  
    <li><a href="../../NewRelic/Rack/DeveloperMode.html">NewRelic::Rack::DeveloperMode</a>
  
    <li><a href="../../NewRelic/Railtie.html">NewRelic::Railtie</a>
  
    <li><a href="../../NewRelic/ScopedMethodTraceStats.html">NewRelic::ScopedMethodTraceStats</a>
  
    <li><a href="../../NewRelic/Stats.html">NewRelic::Stats</a>
  
    <li><a href="../../NewRelic/StatsBase.html">NewRelic::StatsBase</a>
  
    <li><a href="../../NewRelic/TransactionAnalysis.html">NewRelic::TransactionAnalysis</a>
  
    <li><a href="../../NewRelic/TransactionAnalysis/SegmentSummary.html">NewRelic::TransactionAnalysis::SegmentSummary</a>
  
    <li><a href="../../NewRelic/TransactionSample.html">NewRelic::TransactionSample</a>
  
    <li><a href="../../NewRelic/TransactionSample/CompositeSegment.html">NewRelic::TransactionSample::CompositeSegment</a>
  
    <li><a href="../../NewRelic/TransactionSample/FakeSegment.html">NewRelic::TransactionSample::FakeSegment</a>
  
    <li><a href="../../NewRelic/TransactionSample/Segment.html">NewRelic::TransactionSample::Segment</a>
  
    <li><a href="../../NewRelic/TransactionSample/SummarySegment.html">NewRelic::TransactionSample::SummarySegment</a>
  
    <li><a href="../../NewRelic/UrlRule.html">NewRelic::UrlRule</a>
  
    <li><a href="../../NewRelic/UrlRule/RuleSet.html">NewRelic::UrlRule::RuleSet</a>
  
    <li><a href="../../NewRelic/VersionNumber.html">NewRelic::VersionNumber</a>
  
    <li><a href="../../ActionView.html">ActionView</a>
  
    <li><a href="../../ActionView/Base.html">ActionView::Base</a>
  
    <li><a href="../../ActionView/Partials.html">ActionView::Partials</a>
  
    <li><a href="../../ActionView/Partials/PartialRenderer.html">ActionView::Partials::PartialRenderer</a>
  
    <li><a href="../../ActionController.html">ActionController</a>
  
    <li><a href="../../ActionController/Base.html">ActionController::Base</a>
  
    <li><a href="../../Object.html">Object</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module NewRelic::Agent::Database</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-close_connections" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">close_connections</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="close_connections-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 34</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">close_connections</span>
  <span class="ruby-constant">ConnectionManager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">close_connections</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- close_connections-source -->
          
        </div>

        

        
      </div><!-- close_connections-method -->

    
      <div id="method-i-config" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">config</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="config-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">config</span>
  <span class="ruby-constant">ConnectionManager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">config</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- config-source -->
          
        </div>

        

        
      </div><!-- config-method -->

    
      <div id="method-i-config-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">config=</span><span
            class="method-args">(other)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="config-3D-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 42</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">config=</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-constant">ConnectionManager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">config</span> = <span class="ruby-identifier">other</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- config-3D-source -->
          
        </div>

        

        
      </div><!-- config-3D-method -->

    
      <div id="method-i-explain_sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">explain_sql</span><span
            class="method-args">(sql, connection_config)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Perform this in the runtime environment of a managed application, to
explain the sql statement executed within a segment of a transaction
sample. Returns an array of explanations (which is an array rows consisting
of an array of strings for each column returned by the the explain query)
Note this happens only for statements whose execution time exceeds a
threshold (e.g. 500ms) and only within the slowest transaction in a report
period, selected for shipment to New Relic</p>
          

          
          <div class="method-source-code" id="explain_sql-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">explain_sql</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">connection_config</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sql</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">connection_config</span>
  <span class="ruby-identifier">statement</span> = <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;;\n&quot;</span>)[<span class="ruby-value">0</span>] <span class="ruby-comment"># only explain the first</span>
  <span class="ruby-identifier">explain_sql</span> = <span class="ruby-identifier">explain_statement</span>(<span class="ruby-identifier">statement</span>, <span class="ruby-identifier">connection_config</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">explain_sql</span> <span class="ruby-operator">||</span> []
<span class="ruby-keyword">end</span></pre>
          </div><!-- explain_sql-source -->
          
        </div>

        

        
      </div><!-- explain_sql-method -->

    
      <div id="method-i-explain_statement" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">explain_statement</span><span
            class="method-args">(statement, config)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="explain_statement-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">explain_statement</span>(<span class="ruby-identifier">statement</span>, <span class="ruby-identifier">config</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_select?</span>(<span class="ruby-identifier">statement</span>)
    <span class="ruby-identifier">handle_exception_in_explain</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">connection</span> = <span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">config</span>)
      <span class="ruby-identifier">plan</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">connection</span>
        <span class="ruby-identifier">plan</span> = <span class="ruby-identifier">process_resultset</span>(<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;EXPLAIN #{statement}&quot;</span>))
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">plan</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- explain_statement-source -->
          
        </div>

        

        
      </div><!-- explain_statement-method -->

    
      <div id="method-i-get_connection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_connection</span><span
            class="method-args">(config)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_connection-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">config</span>)
  <span class="ruby-constant">ConnectionManager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_connection</span>(<span class="ruby-identifier">config</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_connection-source -->
          
        </div>

        

        
      </div><!-- get_connection-method -->

    
      <div id="method-i-handle_exception_in_explain" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">handle_exception_in_explain</span><span
            class="method-args">() { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="handle_exception_in_explain-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">handle_exception_in_explain</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># guarantees no throw from explain_sql</span>
    <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Error getting query plan: #{e.message}&quot;</span>)
    <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>))
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>
    <span class="ruby-comment"># double exception. throw up your hands</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- handle_exception_in_explain-source -->
          
        </div>

        

        
      </div><!-- handle_exception_in_explain-method -->

    
      <div id="method-i-is_select-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_select?</span><span
            class="method-args">(statement)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="is_select-3F-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_select?</span>(<span class="ruby-identifier">statement</span>)
  <span class="ruby-comment"># split the string into at most two segments on the</span>
  <span class="ruby-comment"># system-defined field separator character</span>
  <span class="ruby-identifier">first_word</span>, <span class="ruby-identifier">rest_of_statement</span> = <span class="ruby-identifier">statement</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">$;</span>, <span class="ruby-value">2</span>)
  (<span class="ruby-identifier">first_word</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'SELECT'</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_select-3F-source -->
          
        </div>

        

        
      </div><!-- is_select-3F-method -->

    
      <div id="method-i-obfuscate_sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">obfuscate_sql</span><span
            class="method-args">(sql)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="obfuscate_sql-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">obfuscate_sql</span>(<span class="ruby-identifier">sql</span>)
  <span class="ruby-constant">Obfuscator</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">obfuscator</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">sql</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- obfuscate_sql-source -->
          
        </div>

        

        
      </div><!-- obfuscate_sql-method -->

    
      <div id="method-i-process_resultset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_resultset</span><span
            class="method-args">(items)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="process_resultset-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 75</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_resultset</span>(<span class="ruby-identifier">items</span>)
  <span class="ruby-comment"># The resultset type varies for different drivers.  Only thing you can count on is</span>
  <span class="ruby-comment"># that it implements each.  Also: can't use select_rows because the native postgres</span>
  <span class="ruby-comment"># driver doesn't know that method.</span>
  
  <span class="ruby-identifier">headers</span> = []
  <span class="ruby-identifier">values</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:each_hash</span>)
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each_hash</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">keys</span>
      <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row</span>[<span class="ruby-identifier">h</span>] }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:each</span>)
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
        <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">keys</span>
        <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row</span>[<span class="ruby-identifier">h</span>] }
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">values</span> = [<span class="ruby-identifier">items</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">headers</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">empty?</span>
  [<span class="ruby-identifier">headers</span>, <span class="ruby-identifier">values</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- process_resultset-source -->
          
        </div>

        

        
      </div><!-- process_resultset-method -->

    
      <div id="method-i-set_sql_obfuscator" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_sql_obfuscator</span><span
            class="method-args">(type, &block)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="set_sql_obfuscator-source">
            <pre><span class="ruby-comment"># File lib/new_relic/agent/database.rb, line 26</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">type</span>, &amp;<span class="ruby-identifier">block</span>)
  <span class="ruby-constant">Obfuscator</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">type</span>, &amp;<span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_sql_obfuscator-source -->
          
        </div>

        

        
      </div><!-- set_sql_obfuscator-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

