<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NewRelic::Agent</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            NewRelic::Agent 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/new_relic/agent/beacon_configuration_rb.html">lib/new_relic/agent/beacon_configuration.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/agent_rb.html">lib/new_relic/agent/agent.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/browser_monitoring_rb.html">lib/new_relic/agent/browser_monitoring.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/busy_calculator_rb.html">lib/new_relic/agent/busy_calculator.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/error_collector_rb.html">lib/new_relic/agent/error_collector.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/controller_instrumentation_rb.html">lib/new_relic/agent/instrumentation/controller_instrumentation.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/data_mapper_rb.html">lib/new_relic/agent/instrumentation/data_mapper.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/memcache_rb.html">lib/new_relic/agent/instrumentation/memcache.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/metric_frame_rb.html">lib/new_relic/agent/instrumentation/metric_frame.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/rack_rb.html">lib/new_relic/agent/instrumentation/rack.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/queue_time_rb.html">lib/new_relic/agent/instrumentation/queue_time.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/rails/active_record_instrumentation_rb.html">lib/new_relic/agent/instrumentation/rails/active_record_instrumentation.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/rails3/action_controller_rb.html">lib/new_relic/agent/instrumentation/rails3/action_controller.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/rails3/active_record_instrumentation_rb.html">lib/new_relic/agent/instrumentation/rails3/active_record_instrumentation.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/rails3/errors_rb.html">lib/new_relic/agent/instrumentation/rails3/errors.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/instrumentation/sinatra_rb.html">lib/new_relic/agent/instrumentation/sinatra.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/sampler_rb.html">lib/new_relic/agent/sampler.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/method_tracer_rb.html">lib/new_relic/agent/method_tracer.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/samplers/cpu_sampler_rb.html">lib/new_relic/agent/samplers/cpu_sampler.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/samplers/delayed_job_lock_sampler_rb.html">lib/new_relic/agent/samplers/delayed_job_lock_sampler.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/samplers/object_sampler_rb.html">lib/new_relic/agent/samplers/object_sampler.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/samplers/memory_sampler_rb.html">lib/new_relic/agent/samplers/memory_sampler.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/shim_agent_rb.html">lib/new_relic/agent/shim_agent.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/stats_engine/samplers_rb.html">lib/new_relic/agent/stats_engine/samplers.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/stats_engine/metric_stats_rb.html">lib/new_relic/agent/stats_engine/metric_stats.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/stats_engine/transactions_rb.html">lib/new_relic/agent/stats_engine/transactions.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/stats_engine_rb.html">lib/new_relic/agent/stats_engine.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/transaction_sample_builder_rb.html">lib/new_relic/agent/transaction_sample_builder.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/transaction_sampler_rb.html">lib/new_relic/agent/transaction_sampler.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent/worker_loop_rb.html">lib/new_relic/agent/worker_loop.rb</a></li>
            
            <li><a href="../../files/lib/new_relic/agent_rb.html">lib/new_relic/agent.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <h2><a href="Agent/Agent.html">Agent</a> APIs</h2>
<p>
This module contains the public API methods for the <a
href="Agent/Agent.html">Agent</a>.
</p>
<p>
For adding custom instrumentation to method invocations, refer to the docs
in the class <a
href="Agent/MethodTracer.html">NewRelic::Agent::MethodTracer</a>.
</p>
<p>
For information on how to customize the controller instrumentation, or to
instrument something other than Rails so that high level dispatcher actions
or background tasks show up as first class operations in RPM, refer to <a
href="Agent/Instrumentation/ControllerInstrumentation.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation</a>
and <a
href="Agent/Instrumentation/ControllerInstrumentation/ClassMethods.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation::ClassMethods</a>.
</p>
<p>
Methods in this module as well as documented methods in <a
href="Agent/MethodTracer.html">NewRelic::Agent::MethodTracer</a> and <a
href="Agent/Instrumentation/ControllerInstrumentation.html">NewRelic::Agent::Instrumentation::ControllerInstrumentation</a>
are available to applications. When the agent is not enabled the method
implementations are stubbed into no-ops to reduce overhead.
</p>
<p>
Methods and classes in other parts of the agent are not guaranteed to be
available between releases.
</p>
<p>
Refer to the online docs at support.newrelic.com to see how to access the
data collected by custom instrumentation, or e-mail support at New Relic
for help.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M000450">abort_transaction!</a>,</li>
                
                <li><a href="#M000457">add_custom_parameters</a>,</li>
                
                <li><a href="#M000446">add_instrumentation</a>,</li>
                
                <li><a href="#M000458">add_request_parameters</a>,</li>
                
                <li><a href="#M000442">after_fork</a></li>
                
            </ul>
        </dd>
    
        <dt>B</dt>
        <dd>
            <ul>
                
                <li><a href="#M000466">browser_timing_footer</a>,</li>
                
                <li><a href="#M000461">browser_timing_header</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000451">disable_all_tracing</a>,</li>
                
                <li><a href="#M000448">disable_sql_recording</a>,</li>
                
                <li><a href="#M000449">disable_transaction_tracing</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M000436">get_stats</a>,</li>
                
                <li><a href="#M000437">get_stats_no_scope</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M000455">ignore_error_filter</a>,</li>
                
                <li><a href="#M000452">is_execution_traced?</a>,</li>
                
                <li><a href="#M000454">is_sql_recorded?</a>,</li>
                
                <li><a href="#M000453">is_transaction_traced?</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M000438">logger</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M000439">manual_start</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000456">notice_error</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000460">record_transaction</a>,</li>
                
                <li><a href="#M000443">reset_stats</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M000447">set_sql_obfuscator</a>,</li>
                
                <li><a href="#M000445">shutdown</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M000459">with_database_metric_name</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">MODULE</span> <a href="Agent/BrowserMonitoring.html">NewRelic::Agent::BrowserMonitoring</a></li>
        
        <li><span class="type">MODULE</span> <a href="Agent/BusyCalculator.html">NewRelic::Agent::BusyCalculator</a></li>
        
        <li><span class="type">MODULE</span> <a href="Agent/Instrumentation.html">NewRelic::Agent::Instrumentation</a></li>
        
        <li><span class="type">MODULE</span> <a href="Agent/MethodTracer.html">NewRelic::Agent::MethodTracer</a></li>
        
        <li><span class="type">MODULE</span> <a href="Agent/Samplers.html">NewRelic::Agent::Samplers</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/Agent.html">NewRelic::Agent::Agent</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/BackgroundLoadingError.html">NewRelic::Agent::BackgroundLoadingError</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/BeaconConfiguration.html">NewRelic::Agent::BeaconConfiguration</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/ErrorCollector.html">NewRelic::Agent::ErrorCollector</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/ForceDisconnectException.html">NewRelic::Agent::ForceDisconnectException</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/ForceRestartException.html">NewRelic::Agent::ForceRestartException</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/LicenseException.html">NewRelic::Agent::LicenseException</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/PostTooBigException.html">NewRelic::Agent::PostTooBigException</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/Sampler.html">NewRelic::Agent::Sampler</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/ServerConnectionException.html">NewRelic::Agent::ServerConnectionException</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/ServerError.html">NewRelic::Agent::ServerError</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/ShimAgent.html">NewRelic::Agent::ShimAgent</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/StatsEngine.html">NewRelic::Agent::StatsEngine</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/TransactionSampleBuilder.html">NewRelic::Agent::TransactionSampleBuilder</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/TransactionSampler.html">NewRelic::Agent::TransactionSampler</a></li>
        
        <li><span class="type">CLASS</span> <a href="Agent/WorkerLoop.html">NewRelic::Agent::WorkerLoop</a></li>
        
    </ul>
    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000450">
                    
                    <a name="M000450"></a><b>abort_transaction!</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Cancel the collection of the current transaction in progress, if any. Only
affects the transaction started on this thread once it has started and
before it has completed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000450_source')" id="l_M000450_source">show</a>
                        
                    </p>
                    <div id="M000450_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 272</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">abort_transaction!</span>
      <span class="ruby-comment cmt"># The class may not be loaded if the agent is disabled</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>
        <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">abort_transaction!</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000457">
                    
                    <a name="M000457"></a><b>add_custom_parameters</b>(params)
                    
                </div>
                
                <div class="description">
                  <p>
Add parameters to the current transaction trace (and traced error if any)
on the call stack.
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Agent.html#M000458">add_request_parameters</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000457_source')" id="l_M000457_source">show</a>
                        
                    </p>
                    <div id="M000457_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 338</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_custom_parameters</span>(<span class="ruby-identifier">params</span>)
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">add_custom_parameters</span>(<span class="ruby-identifier">params</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000446">
                    
                    <a name="M000446"></a><b>add_instrumentation</b>(file_pattern)
                    
                </div>
                
                <div class="description">
                  <p>
Add instrumentation files to the agent. The argument should be a glob
matching ruby scripts which will be executed at the time instrumentation is
loaded. Since instrumentation is not loaded when the agent is not running
it&#8217;s better to use this method to register instrumentation than just
loading the files directly, although that probably also works.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000446_source')" id="l_M000446_source">show</a>
                        
                    </p>
                    <div id="M000446_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 217</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_instrumentation</span> <span class="ruby-identifier">file_pattern</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">add_instrumentation</span> <span class="ruby-identifier">file_pattern</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000458">
                    
                    <a name="M000458"></a><b>add_request_parameters</b>(params)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Agent.html#M000457">add_custom_parameters</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000442">
                    
                    <a name="M000442"></a><b>after_fork</b>(options={})
                    
                </div>
                
                <div class="description">
                  <p>
Register this method as a callback for processes that fork jobs.
</p>
<p>
If the master/parent connects to the agent prior to forking the agent in
the forked process will use that agent_run. Otherwise the forked process
will establish a new connection with the server.
</p>
<p>
Use this especially when you fork the process to run background jobs or
other work. If you are doing this with a web dispatcher that forks worker
processes then you will need to force the agent to reconnect, which it
won&#8217;t do by default. Passenger and Unicorn are already handled,
nothing special needed for them.
</p>
<p>
Options:
</p>
<ul>
<li><tt>:force_reconnect =&gt; true</tt> to force the spawned process to
establish a new connection, such as when forking a long running process.
The default is false&#8212;it will only connect to the server if the parent
had not connected.

</li>
<li><tt>:keep_retrying =&gt; false</tt> if we try to initiate a new connection,
this tells me to only try it once so this method returns quickly if there
is some kind of latency with the server.

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000442_source')" id="l_M000442_source">show</a>
                        
                    </p>
                    <div id="M000442_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 196</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_fork</span>(<span class="ruby-identifier">options</span>={})
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">after_fork</span>(<span class="ruby-identifier">options</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000466">
                    
                    <a name="M000466"></a><b>browser_timing_footer</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a Javascript string which should be injected into the very bottom
of the response body
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000466_source')" id="l_M000466_source">show</a>
                        
                    </p>
                    <div id="M000466_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 400</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">browser_timing_footer</span>
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">browser_timing_footer</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000461">
                    
                    <a name="M000461"></a><b>browser_timing_header</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Returns a Javascript string which should be injected into the very top of
the response body
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000461_source')" id="l_M000461_source">show</a>
                        
                    </p>
                    <div id="M000461_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 394</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">browser_timing_header</span>
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">browser_timing_header</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000451">
                    
                    <a name="M000451"></a><b>disable_all_tracing</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Yield to the block without collecting any metrics or traces in any of the
subsequent calls. If executed recursively, will keep track of the first
entry point and turn on tracing again after leaving that block. This uses
the thread local <tt>newrelic_untrace</tt>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000451_source')" id="l_M000451_source">show</a>
                        
                    </p>
                    <div id="M000451_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 284</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disable_all_tracing</span>
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">push_trace_execution_flag</span>(<span class="ruby-keyword kw">false</span>)
      <span class="ruby-keyword kw">yield</span>
    <span class="ruby-keyword kw">ensure</span>
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">pop_trace_execution_flag</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000448">
                    
                    <a name="M000448"></a><b>disable_sql_recording</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This method sets the state of sql recording in the transaction sampler
feature. Within the given block, no sql will be recorded
</p>
<p>
usage:
</p>
<pre>
  NewRelic::Agent.disable_sql_recording do
    ...
  end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000448_source')" id="l_M000448_source">show</a>
                        
                    </p>
                    <div id="M000448_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 249</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disable_sql_recording</span>
      <span class="ruby-identifier">state</span> = <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_sql</span>(<span class="ruby-keyword kw">false</span>)
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-keyword kw">yield</span>
      <span class="ruby-keyword kw">ensure</span>
        <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_sql</span>(<span class="ruby-identifier">state</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000449">
                    
                    <a name="M000449"></a><b>disable_transaction_tracing</b>()
                    
                </div>
                
                <div class="description">
                  <p>
This method disables the recording of transaction traces in the given
block. See also <a href="Agent.html#M000451">disable_all_tracing</a>
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000449_source')" id="l_M000449_source">show</a>
                        
                    </p>
                    <div id="M000449_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 260</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disable_transaction_tracing</span>
      <span class="ruby-identifier">state</span> = <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_tt</span>(<span class="ruby-keyword kw">false</span>)
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-keyword kw">yield</span>
      <span class="ruby-keyword kw">ensure</span>
        <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_record_tt</span>(<span class="ruby-identifier">state</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000436">
                    
                    <a name="M000436"></a><b>get_stats</b>(metric_name, use_scope=false)
                    
                </div>
                
                <div class="description">
                  <p>
Get or create a statistics gatherer that will aggregate numerical data
under a metric name.
</p>
<p>
<tt>metric_name</tt> should follow a slash separated path convention.
Application specific metrics should begin with &#8220;Custom/&#8221;.
</p>
<p>
Return a <a href="Stats.html">NewRelic::Stats</a> that accepts data via
calls to add_data_point(value).
</p>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Agent.html#M000437">get_stats_no_scope</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000436_source')" id="l_M000436_source">show</a>
                        
                    </p>
                    <div id="M000436_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 142</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_stats</span>(<span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">use_scope</span>=<span class="ruby-keyword kw">false</span>)
      <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">stats_engine</span>.<span class="ruby-identifier">get_stats</span>(<span class="ruby-identifier">metric_name</span>, <span class="ruby-identifier">use_scope</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000437">
                    
                    <a name="M000437"></a><b>get_stats_no_scope</b>(metric_name, use_scope=false)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Agent.html#M000436">get_stats</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000455">
                    
                    <a name="M000455"></a><b>ignore_error_filter</b>(&amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Set a filter to be applied to errors that RPM will track. The block should
evalute to the exception to track (which could be different from the
original exception) or nil to ignore this exception.
</p>
<p>
The block is yielded to with the exception to filter.
</p>
<p>
Return the new block or the existing filter Proc if no block is passed.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000455_source')" id="l_M000455_source">show</a>
                        
                    </p>
                    <div id="M000455_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 313</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ignore_error_filter</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">error_collector</span>.<span class="ruby-identifier">ignore_error_filter</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000452">
                    
                    <a name="M000452"></a><b>is_execution_traced?</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Check to see if we are capturing metrics currently on this thread.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000452_source')" id="l_M000452_source">show</a>
                        
                    </p>
                    <div id="M000452_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 292</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_execution_traced?</span>
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:newrelic_untraced</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-identifier">:newrelic_untraced</span>].<span class="ruby-identifier">last</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000454">
                    
                    <a name="M000454"></a><b>is_sql_recorded?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000454_source')" id="l_M000454_source">show</a>
                        
                    </p>
                    <div id="M000454_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 300</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_sql_recorded?</span>
      <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-identifier">current</span>[<span class="ruby-identifier">:record_sql</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000453">
                    
                    <a name="M000453"></a><b>is_transaction_traced?</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000453_source')" id="l_M000453_source">show</a>
                        
                    </p>
                    <div id="M000453_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 296</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_transaction_traced?</span>
      <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-identifier">current</span>[<span class="ruby-identifier">:record_tt</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000438">
                    
                    <a name="M000438"></a><b>logger</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Get the logger for the agent. Available after the agent has initialized.
This sends output to the agent log file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000438_source')" id="l_M000438_source">show</a>
                        
                    </p>
                    <div id="M000438_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 150</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">logger</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">log</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000439">
                    
                    <a name="M000439"></a><b>manual_start</b>(options={})
                    
                </div>
                
                <div class="description">
                  <p>
Call this to manually start the <a href="Agent/Agent.html">Agent</a> in
situations where the <a href="Agent/Agent.html">Agent</a> does not
auto-start.
</p>
<p>
When the app environment loads, so does the <a
href="Agent/Agent.html">Agent</a>. However, the <a
href="Agent/Agent.html">Agent</a> will only connect to RPM if a web
front-end is found. If you want to selectively monitor ruby processes that
don&#8217;t use web plugins, then call this method in your code and the <a
href="Agent/Agent.html">Agent</a> will fire up and start reporting to RPM.
</p>
<p>
Options are passed in as overrides for values in the <a
href="../../files/newrelic_yml.html">newrelic.yml</a>, such as app_name. In
addition, the option <tt>log</tt> will take a logger that will be used
instead of the standard file logger. The setting for the <a
href="../../files/newrelic_yml.html">newrelic.yml</a> section to use (ie,
RAILS_ENV) can be overridden with an :env argument.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000439_source')" id="l_M000439_source">show</a>
                        
                    </p>
                    <div id="M000439_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 169</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">manual_start</span>(<span class="ruby-identifier">options</span>={})
      <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">options</span>
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Control</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">init_plugin</span>({ <span class="ruby-identifier">:agent_enabled</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:sync_startup</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>))
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000456">
                    
                    <a name="M000456"></a><b>notice_error</b>(exception, options={})
                    
                </div>
                
                <div class="description">
                  <p>
Record the given error in RPM. It will be passed through the <a
href="Agent.html#M000455">ignore_error_filter</a> if there is one.
</p>
<ul>
<li><tt>exception</tt> is the exception which will be recorded. May also be an
error message.

</li>
</ul>
<p>
Options:
</p>
<ul>
<li><tt>:uri</tt> => The request path, minus any request params or query
string.

</li>
<li><tt>:referer</tt> => The URI of the referer

</li>
<li><tt>:metric</tt> => The metric name associated with the transaction

</li>
<li><tt>:request_params</tt> => Request parameters, already filtered if
necessary

</li>
<li><tt>:custom_params</tt> => Custom parameters

</li>
</ul>
<p>
Anything left over is treated as custom params.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000456_source')" id="l_M000456_source">show</a>
                        
                    </p>
                    <div id="M000456_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 331</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">notice_error</span>(<span class="ruby-identifier">exception</span>, <span class="ruby-identifier">options</span>={})
      <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">notice_error</span>(<span class="ruby-identifier">exception</span>, <span class="ruby-identifier">options</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000460">
                    
                    <a name="M000460"></a><b>record_transaction</b>(response_sec, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Record a web transaction from an external source. This will process the
response time, error, and score an apdex value.
</p>
<p>
First argument is a float value, time in seconds. Option keys are strings.
</p>
<h2>Identifying the transaction</h2>
<ul>
<li><tt>'uri' =&gt; uri</tt> to record the value for a given web request. If
not provided, just record the aggregate dispatcher and apdex scores.

</li>
<li><tt>'metric' =&gt; metric_name</tt> to record with a general metric name
like <tt>OtherTransaction/Background/Class/method</tt>. Ignored if
<tt>uri</tt> is provided.

</li>
</ul>
<h2>Error options</h2>
<p>
Provide one of the following:
</p>
<ul>
<li><tt>'is_error' =&gt; true</tt> if an unknown error occurred

</li>
<li><tt>'error_message' =&gt; msg</tt> if an error message is available

</li>
<li><tt>'exception' =&gt; exception</tt> if a ruby exception is recorded

</li>
</ul>
<h2>Misc options</h2>
<p>
Additional information captured in errors
</p>
<ul>
<li><tt>'referer' =&gt; referer_url</tt>

</li>
<li><tt>'request_params' =&gt; hash</tt> to record a set of name/value pairs as
the request parameters.

</li>
<li><tt>'custom_params' =&gt; hash</tt> to record extra information in traced
errors

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000460_source')" id="l_M000460_source">show</a>
                        
                    </p>
                    <div id="M000460_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 388</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">record_transaction</span>(<span class="ruby-identifier">response_sec</span>, <span class="ruby-identifier">options</span> = {})
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">record_transaction</span>(<span class="ruby-identifier">response_sec</span>, <span class="ruby-identifier">options</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000443">
                    
                    <a name="M000443"></a><b>reset_stats</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Clear out any unsent metric data.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000443_source')" id="l_M000443_source">show</a>
                        
                    </p>
                    <div id="M000443_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 201</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_stats</span>
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">reset_stats</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000447">
                    
                    <a name="M000447"></a><b>set_sql_obfuscator</b>(type = :replace, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
This method sets the block sent to this method as a sql obfuscator. The
block will be called with a single String SQL statement to obfuscate. The
method must return the obfuscated String SQL. If chaining of obfuscators is
required, use type = :before or :after
</p>
<p>
type = :before, :replace, :after
</p>
<p>
Example:
</p>
<pre>
   NewRelic::Agent.set_sql_obfuscator(:replace) do |sql|
      my_obfuscator(sql)
   end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000447_source')" id="l_M000447_source">show</a>
                        
                    </p>
                    <div id="M000447_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 235</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_sql_obfuscator</span>(<span class="ruby-identifier">type</span> = <span class="ruby-identifier">:replace</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">set_sql_obfuscator</span> <span class="ruby-identifier">type</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000445">
                    
                    <a name="M000445"></a><b>shutdown</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Shutdown the agent. Call this before exiting. Sends any queued data and
kills the background thread.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000445_source')" id="l_M000445_source">show</a>
                        
                    </p>
                    <div id="M000445_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 207</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shutdown</span>
      <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">shutdown</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000459">
                    
                    <a name="M000459"></a><b>with_database_metric_name</b>(model, method, &amp;block)
                    
                </div>
                
                <div class="description">
                  <p>
Yield to a block that is run with a database metric name context. This
means the Database instrumentation will use this for the metric name if it
does not otherwise know about a model. This is re-entrant.
</p>
<ul>
<li><tt>model</tt> is the DB model class

</li>
<li><tt>method</tt> is the name of the finder method or other method to
identify the operation with.

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000459_source')" id="l_M000459_source">show</a>
                        
                    </p>
                    <div id="M000459_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/new_relic/agent.rb, line 354</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_database_metric_name</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">method</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frame</span> = <span class="ruby-constant">NewRelic</span><span class="ruby-operator">::</span><span class="ruby-constant">Agent</span><span class="ruby-operator">::</span><span class="ruby-constant">Instrumentation</span><span class="ruby-operator">::</span><span class="ruby-constant">MetricFrame</span>.<span class="ruby-identifier">current</span>
        <span class="ruby-identifier">frame</span>.<span class="ruby-identifier">with_database_metric_name</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">method</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-keyword kw">yield</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    